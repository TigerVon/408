<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>计组</title><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; tab-size: 4; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 40px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
.typora-export .task-list-item input { pointer-events: none; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }
button, input, select, textarea { color: inherit; font: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror-linenumber { user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  html.blink-to-pdf { font-size: 13px; }
  .typora-export #write { break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.html-for-mac .inline-math-svg .MathJax_SVG { vertical-align: 0.2px; }
.md-math-block .MathJax_SVG_Display { text-align: center; margin: 0px; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; overflow-y: hidden; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: var(--monospace); }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: 400; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; overflow-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none 0s ease 0s; }
.MathJax_SVG_Display svg { vertical-align: middle !important; margin-bottom: 0px !important; margin-top: 0px !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
svg[id^="mermaidChart"] { line-height: 1em; }
mark { background: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
mark .md-meta { color: rgb(0, 0, 0); opacity: 0.3 !important; }
@media print {
  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }
  .typora-export h1::after, .typora-export h2::after, .typora-export h3::after, .typora-export h4::after, .typora-export h5::after, .typora-export h6::after { content: ""; display: block; height: 100px; margin-bottom: -100px; }
}


:root {
  /* dark color for background*/
  /* default color */
  --bg-color1: rgb(40, 44, 52);
  /* for most panel, context, header, etc */
  --bg-color2: rgb(33, 37, 43);
  /* for toc and table edit panel */
  --bg-color3: rgba(16, 17, 20, 0.5);
  /* for tips */
  --bg-color4: black;
  /* for blockquote, codeblock, input, etc */
  --bg-color5: rgb(29, 31, 35);
  /* light color for text and icon*/
  /* default color */
  --text-color1: rgb(170, 178, 180);
  /* for text on panel */
  --text-color2: rgb(220, 220, 220);
  /* for checkbox and radio */
  --text-color3: hsl(192, 6%, 40%);
  /* for tips */
  --text-color4: white;
  /* for focus mode */
  --text-color5: rgba(170, 178, 180, 0.5);
  /* link color */
  --link-color: rgb(197, 202, 210);
  /* table color */
  --table-border-color: rgb(100, 104, 116);
  --table-thead-color: rgb(31, 35, 40);
  --table-bg-color: rgb(40, 45, 52);
  --table-bg-darker-color: rgb(35, 40, 46);
  /* hover color */
  /* default hover background color */
  --hover-bg-color1: rgb(62, 66, 73);
  /* for input item */
  --hover-bg-color2: hsl(220, 9%, 14%);
  /* for button on toc and table edit panel */
  --hover-bg-color3: rgba(62, 66, 73, 0.8);
  /* default hover text color */
  --hover-text-color: white;
  /* active color */
  --active-color: var(--hover-bg-color1);
  /* input color */
  --input-color: rgb(29, 31, 35);
  /* menu divider color */
  --menu-divider-color: rgb(95, 97, 101);
  /* scrollbar color */
  --scrollbar-thumb-color: var(--menu-divider-color);
  --scrollbar-track-color: rgba(95, 97, 101, 0.3);
  /* theme select color */
  --theme-select-color: rgba(255, 255, 255, 0.5);
  --button-color: rgb(62, 66, 73);
  --select-color: rgb(33, 37, 43);
  /* focus color */
  --focus-color: rgba(100, 100, 100, 0.8);
  --focus-ring-color: var(--focus-color);
  /* codeblock color */
  --code-red-color: rgb(221, 110, 115);
  --code-yellow-color: rgb(218, 192, 123);
  --code-cyan-color: rgb(86, 182, 194);
  --code-blue-color: rgb(94, 174, 237);
  --code-purple-color: rgb(195, 115, 215);
  --code-orange-color: rgb(221, 153, 103);
  --code-grey-color: rgb(127, 132, 142);
  --code-green-color: rgb(152, 195, 123);
  --code-select-bg-color: rgb(64, 72, 89);
  --code-cursor-color: rgb(82, 139, 255);
  /* implicit selecttion text bg color */
  --select-text-bg-color: rgb(150, 156, 170);
  /* implicit button color */
  --primary-color: var(--button-color);
  --primary-btn-border-color: transparent;
  --primary-btn-text-color: var(--text-color2);
  /* implicit sidebar color */
  --side-bar-bg-color: var(--bg-color2);
  --control-text-color: var(--text-color2);
  /* implicit text color */
  --text-color: var(--text-color1);
  /* implicit background color for setting menu */
  --bg-color: var(--bg-color1);
  /* implicit hover color */
  --item-hover-bg-color: var(--hover-bg-color1);
  --item-hover-text-color: var(--hover-text-color);
  /* implicit active color */
  --active-file-bg-color: var(--hover-bg-color);
  /* implicit mathjax edit panel background color */
  --rawblock-edit-panel-bd: var(--bg-color5);
  /* implicit focus mode color */
  --blur-text-color: var(--text-color5);
  /* implicit search result select color */
  --search-select-bg-color: var(--select-text-bg-color);
  --search-select-bg-color: rgb(56, 71, 95);

  --control-text-hover-color: var(--hover-text-color);
  /* implicit active file color in sidebar file menu treeview */
  --active-file-text-color: var(--hover-text-color);
  --active-file-border-color: var(--hover-text-color);

  --node-border: var(--menu-divider-color);
  --node-fill: var(--bg-color2);
}

/* font */
/* basic style */
html {
  font-size: 16px;
}

body {
  font-family: "Open Sans", "Clear Sans", "Helvetica Neue", Helvetica, Arial,
    sans-serif;
  color: var(--text-color1);
  background: var(--bg-color1);
  line-height: 1.6;
}

/* text selection background color */
.in-text-selection {
  background-color: rgb(64, 72, 89);
}

/* link */
#write a:not([role="menuitem"]) {
  color: var(--link-color) !important;
}

#write a:not([role="menuitem"]):hover {
  color: var(--hover-text-color) !important;
}

/* h1-h6 */
#write h1,
#write h2,
#write h3,
#write h4,
#write h5,
#write h6 {
  margin-top: 0.5em;
  margin-bottom: 0em;
  line-height: 1em;
}

#write h1 {
  font-size: 2.5em;
  padding-bottom: 0.5em;
  border-bottom: 5px double var(--text-color1);
}

#write h1:before {
  content: "\00A7  ";
}

#write h2 {
  font-size: 2em;
  padding-bottom: 0.5em;
  border-bottom: 3px double var(--text-color1);
}

#write h2:before {
  content: "\00A7  ";
}

#write h3 {
  font-size: 1.75em;
  padding-bottom: 0.5em;
  border-bottom: 1px solid var(--text-color1);
}

#write h4 {
  font-size: 1.55em;
}

#write h5 {
  font-size: 1.35em;
}

#write h6 {
  font-size: 1.2em;
}

/* horizontal divider */
hr {
  height: 2px;
  background-color: var(--text-color1);
  border: 0px;
}

/* list */
ul,
ol {
  padding-left: 30px;
}

/* blockquote */
blockquote {
  border-left: 4px solid var(--text-color1);
  padding: 4px 15px;
  color: var(--text-color1);
  background-color: var(--bg-color5);
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
}

blockquote blockquote {
  padding-right: 0em;
}

/* table */
.md-table-fig,
.md-table-fig:active {
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
}

.md-table thead tr {
  background-color: var(--table-thead-color);
}

.md-table tr th {
  font-weight: bold;
  border-left: 1px solid var(--table-border-color);
  border-right: 1px solid var(--table-border-color);
  text-align: left;
  margin: 0;
  padding: 6px 13px;
}

.md-table tbody tr {
  border-top: 1px solid var(--table-border-color);
  margin: 0;
  padding: 0;
}

.md-table tbody tr:nth-child(2n) {
  background-color: var(--table-bg-darker-color);
}

.md-table tbody tr:nth-child(2n + 1) {
  background-color: var(--table-bg-color);
}

.md-table tr td {
  border-left: 1px solid var(--table-border-color);
  border-right: 1px solid var(--table-border-color);
  text-align: left;
  margin: 0;
  padding: 6px 13px;
}

.md-table tr th:first-child,
.md-table tr td:first-child {
  border-left-width: 0px;
}

.md-table tr th:last-child,
.md-table tr td:last-child {
  border-right-width: 0px;
}

/* table edit panel */
.ty-table-edit {
  background-color: var(--bg-color3);
  border: 0px;
  border-radius: 6px;
  padding-top: 2px;
  padding-bottom: 2px;
  padding-left: 6px;
  padding-right: 6px;
  margin-top: -29px !important;
}

/* button on table edit panel */
.ty-table-edit button {
  background-color: transparent;
  color: var(--text-color2);
  border: 0px;
  margin-left: 0px !important;
}

/* button hover on table edit panel */
.ty-table-edit button:hover {
  background-color: var(--hover-bg-color3);
  color: var(--hover-text-color);
}

/* adjusting table panel */
.popover {
  background-color: var(--bg-color2);
  box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.5);
}

/* arrow of adjusting table panel */
.popover.bottom > .arrow:after {
  border-bottom-color: var(--bg-color2);
}

/* divider in adjust table panel */
.md-grid-board-wrap .popover-title {
  border-top-color: var(--menu-divider-color);
}

/* grid size */
.md-grid-board a {
  width: 15px;
  height: 15px;
}

/* existing thread grid */
.md-grid-board tr[row="1"] .md-grid-ext {
  background-color: rgb(60, 60, 60);
}

/* not existing thread grid */
.md-grid-board tr[row="1"] {
  background-color: rgb(220, 220, 220);
}

/* existing grid */
.md-grid-board .md-grid-ext {
  background-color: rgb(120, 120, 120);
}

/* selected thread grid */
.md-grid-board tr[row="1"] a.md-active,
.md-grid-board tr[row="1"] a:hover {
  background-color: rgb(60, 60, 60);
}

/* selected grid */
.md-grid-board a.md-active,
.md-grid-board a:hover {
  border-color: var(--menu-divider-color);
  background-color: rgb(120, 120, 120);
}

/* task */
.md-task-list-item > input {
  margin-left: -1.3em;
}

/* footnote */
sup.md-footnote {
  color: var(--text-color1);
  background-color: var(--bg-color2);
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
}

/* mathjax */
/* .mathjax-block>.code-tooltip {
    bottom: .375rem;
}
.md-mathjax-midline {
    background: #fafafa;
} */
.md-inline-math script {
  color: var(--text-color1);
}

.md-rawblock > .md-rawblock-container {
  transition: 0.5s;
}

.md-rawblock > .md-rawblock-tooltip {
  transition: 0.5s;
  display: block;
  visibility: hidden;
  opacity: 0;
}

.md-rawblock:hover > .md-rawblock-tooltip {
  transition: 0.5s;
  visibility: visible;
  opacity: 1;
  animation: none;
}

/* meta information of image */
.md-image > .md-meta {
  border: 0px;
  padding: 2px 0px 0px 4px;
  font-size: 0.9em;
  color: var(--text-color1);
}

/* input */
input {
  background-color: var(--input-color) !important;
  border: 0px !important;
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
}

/* input hover */
/* input:hover {
    background-color: var(--hover-bg-color2) !important;
} */
/* checkbox */
input[type="checkbox"]:before {
  content: "";
  display: inline-block;
  width: 1.1rem;
  height: 1.1rem;
  vertical-align: middle;
  text-align: center;
  border: 0px;
  border-radius: 3px;
  background-color: var(--input-color);
  margin-top: -0.5rem;
  margin-left: -0.1rem;
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
}

/* checkbox hover */
input[type="checkbox"]:not([disabled]):not(:checked):hover:before {
  content: "\2713";
  font-size: 0.9rem;
  line-height: 1.2rem;
  color: var(--text-color3);
}

/* checkbox checked*/
input[type="checkbox"]:checked:before {
  content: "\2713";
  font-size: 0.9rem;
  line-height: 1.2rem;
  color: var(--text-color2);
}

/* checkbox checked hover*/
input[type="checkbox"]:checked:hover:before {
  content: "\2713";
  font-size: 0.9rem;
  line-height: 1.2rem;
  color: var(--hover-text-color);
}

/* radio */
input[type="radio"]:before {
  content: "";
  display: inline-block;
  width: 1.1rem;
  height: 1.1rem;
  vertical-align: middle;
  text-align: center;
  border: 0px;
  border-radius: 0.55rem;
  background-color: var(--input-color);
  margin-top: -0.4rem;
  margin-left: -0.1rem;
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
}

/* radio hover */
input[type="radio"]:not([disabled]):not(:checked):hover:before {
  content: "\25CF";
  font-size: 1rem;
  line-height: 1rem;
  color: var(--text-color3);
}

/* radio checked */
input[type="radio"]:checked:before {
  content: "\25CF";
  font-size: 1rem;
  line-height: 1rem;
  color: var(--text-color2);
}

/* radio checked hover*/
input[type="radio"]:checked:before {
  content: "\25CF";
  font-size: 1rem;
  line-height: 1rem;
  color: var(--hover-text-color);
}

/* default focus style */
:focus {
  outline-color: var(--focus-color);
}

/* exit source view button */
.typora-sourceview-on #toggle-sourceview-btn {
  background-color: var(--bg-color2);
}

.typora-sourceview-on #toggle-sourceview-btn:hover {
  background-color: var(--hover-bg-color1);
}

/* shadow for image item*/
.md-image img {
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
}

/* toc */
.md-toc {
  background-color: var(--bg-color3);
  border-radius: 6px;
  padding: 0px 0px 0px 0px;
  margin: 0px 0px 0px 0px;
  border: 0px;
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
}

/* toc content */
.md-toc-content {
  padding-top: 5px;
  padding-bottom: 8px;
  margin-top: 15px;
  margin-bottom: 0px;
}

/* remove outline when toc is selected */
.md-toc:focus .md-toc-content {
  border: 0px;
  margin: 0px;
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
}

/* toc item */
.md-toc-item {
  margin: 2px;
}

/* toc edit panel */
#write div.md-toc-tooltip {
  border: 0px;
  padding-left: 10px;
  padding-right: 10px;
  background-color: var(--bg-color3);
  border-top-left-radius: 6px;
  border-top-right-radius: 6px;
  opacity: 0;
  visibility: hidden;
  display: block !important;
  transition: 0.3s;
}

#write .md-toc:focus div.md-toc-tooltip {
  visibility: visible;
  opacity: 1;
}

#write .md-toc:focus {
  border-top-left-radius: 0px;
  border-top-right-radius: 0px;
}

/* toc delete button */
.md-delete-toc {
  background-color: transparent;
}

/* html block */
.md-htmlblock:hover .md-htmlblock-container {
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
  border-radius: 6px;
  border-top-right-radius: 0px;
}

/* search panel */
#md-searchpanel {
  background-color: var(--bg-color2);
  color: var(--text-color2);
  box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.5);
}

/* ignore case button and find whole word button */
.searchpanel-search-option-btn {
  border: 0px;
}

/* button on search panel */
#md-searchpanel .btn:hover {
  color: var(--hover-text-color);
  background-color: var(--hover-bg-color1) !important;
}

/* remove shadow around input in search panel*/
#md-searchpanel input {
  box-shadow: none;
}

/* search option button hover */
.searchpanel-search-option-btn:not(.active):hover {
  color: var(--hover-text-color);
  background-color: var(--hover-bg-color1);
}

/* close button in search panel */
#md-searchpanel .input-group-addon.close-btn {
  padding-left: 16px;
  padding-right: 16px;
}

/* replaceall button */
.ty-replace-panel-row #search-panel-replaceall-btn {
  padding-left: 8px;
  padding-right: 6px !important;
}

/* replace button */
.ty-replace-panel-row #search-panel-replace-btn {
  padding-left: 16px;
  padding-right: 16px;
}

/* sidebar */
.sidebar-menu {
  color: var(--text-color2);
}

/* sidebar shadow */
#typora-sidebar,
.typora-node #typora-sidebar {
  box-shadow: 3px 0px 10px rgba(0, 0, 0, 0.5);
}

/* divider between file item and search */
.ty-sidebar-search-panel {
  border-color: var(--menu-divider-color);
}

/* file item in sidebar */
#file-library .file-list-item {
  border-bottom: 0px;
  opacity: 1;
  border-left: 4px solid;
  border-color: var(--bg-color2);
}

/* file item hover */
#file-library .file-list-item:hover {
  background-color: var(--hover-bg-color1);
  color: var(--hover-text-color);
  border-color: var(--hover-bg-color1);
}

/* file item active */
#file-library .file-list-item.active {
  background-color: var(--hover-bg-color1);
  color: var(--hover-text-color);
  border-color: var(--hover-text-color);
}

/* suffix of file item*/
.file-list-item-file-ext-part {
  opacity: 0.8;
}

/* sidebar file menu */
#sidebar-files-menu {
  border: 0px;
  box-shadow: -2px -2px 10px rgba(0, 0, 0, 0.5);
}

/* sidebar file menu item */
.dropdown-menu > li > a {
  color: var(--text-color2);
}

.dropdown-menu > li > a:hover {
  color: var(--hover-text-color);
}

/* sidebar file menu close button */
#close-sidebar-menu-btn:hover {
  color: var(--hover-text-color);
}

/* sidebar file nemu divider */
#sidebar-files-menu > .show + .menuitem-group-label.show {
  border-color: var(--menu-divider-color);
}

/* sidebar osx tab */
.html-for-mac .sidebar-osx-tab > .sidebar-tabs {
  border: 0px;
  box-shadow: 0 4px 10px -5px rgba(0, 0, 0, 0.5);
}

.html-for-mac .sidebar-content {
  z-index: -1; /* so that the background doesn't overlap with the shadow */
}

/* sidebar footer */
.sidebar-footer {
  border: 0px;
  box-shadow: 0 -4px 10px -5px rgba(0, 0, 0, 0.5);
}

/* remove outline when file item in treeview is selected*/
.file-library-node:not(.file-node-root):focus > .file-node-content {
  outline: none;
}

/* sort button on sidebar file menu */
.ty-side-sort-btn.active,
.ty-side-sort-btn:hover {
  color: var(--hover-text-color);
}

/* setting */
/* header in setting */
.window-header {
  box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.5) !important;
}

/* sidebar in setting */
.sidebar {
  background-color: var(--bg-color2) !important;
  box-shadow: 3px 0px 10px rgba(0, 0, 0, 0.5);
}

.list-group-content {
  margin-left: 10px !important;
}

/* sidebar button in setting menu */
.nav-group-item {
  color: var(--text-color2) !important;
  border-top-left-radius: 6px !important;
  border-bottom-left-radius: 6px !important;
  border-top-right-radius: 0px !important;
  border-bottom-right-radius: 0px !important;
}

/* sidebar button hover in setting menu */
.nav-group-item:hover,
.nav-group-item:active,
.nav-group-item.active {
  background-color: var(--hover-bg-color1) !important;
  color: var(--hover-text-color) !important;
}

/* remove up and down button from number type input*/
input[type="number"]::-webkit-outer-spin-button,
input[type="number"]::-webkit-inner-spin-button {
  -webkit-appearance: none !important;
}

/* the indent example in setting.editor */
div.pane
  > div:nth-child(4)
  > div:nth-child(2)
  .label-input-group
  td:last-child
  div {
  border: 0px !important;
  border-radius: 6px;
  background-color: var(--bg-color5);
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
  margin: 10px !important;
}

/* button in setting menu */
.ty-preferences button.btn-default {
  border: 0px;
  background-color: var(--bg-color5);
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
  border-radius: 6px;
}

/* button hover in setting menu */
.ty-preferences .btn-default:not([disabled]):hover {
  background-color: var(--hover-bg-color1) !important;
}

/* return button in setting menu */
.window-header button:hover {
  color: var(--text-color2) !important;
}

/* search input in setting menu */
.search-input {
  border-top-left-radius: 6px !important;
  border-bottom-left-radius: 6px !important;
  border-top-right-radius: 0px !important;
  border-bottom-right-radius: 0px !important;
  margin-top: 10px !important;
  margin-bottom: 10px !important;
  margin-left: 10px !important;
}

.search-input:focus {
  border: none !important;
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2) !important;
}

/* select item (mostly in setting menu) */
select {
  border: 0px;
  border-radius: 6px;
  background-color: var(--input-color) !important;
  padding-top: 5px !important;
  padding-bottom: 5px !important;
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
}

/* enabled select item hover */
select:not([disabled]):hover {
  color: var(--text-color2);
  opacity: 1;
}

/* disabled select item hover */
select[disabled]:hover {
  opacity: 0.5;
}

/* mega menu */
.megamenu-content,
.megamenu-opened header {
  background: var(--bg-color1);
}

.megamenu-content {
  display: block;
  visibility: hidden;
  opacity: 0;
  transition: 0.3s;
}

.megamenu-opened .megamenu-content {
  visibility: visible;
  opacity: 1;
  animation: none;
}

/* mega menu sidebar*/
.megamenu-menu {
  background-color: var(--bg-color2);
  box-shadow: 3px 0px 10px rgba(0, 0, 0, 0.5);
}

/* return button in mega menu */
#megamenu-menu-sidebar .menu-style-btn {
  border: 0px;
}

/* remove divider in mega menu */
.megamenu-menu-header {
  border-color: var(--menu-divider-color);
}

/* return button color in mega menu */
.megamenu-menu-header #megamenu-menu-header-title {
  color: var(--text-color2);
}

/* return button hover in mega menu */
.megamenu-menu-header:hover {
  background-color: var(--hover-bg-color1);
}

/* return button hover in mega menu */
.megamenu-menu-header:hover #megamenu-menu-header-title {
  color: var(--hover-text-color);
}

/* long button in mega menu */
.long-btn {
  border: 0px;
  background-color: var(--bg-color5);
  color: var(--text-color1);
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
  margin-bottom: 10px;
  margin-left: 10px;
}

/* recent file in mega menu */
#recent-file-panel {
  padding: 10px;
}

#recent-document-table {
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
}

#recent-file-panel-action-btn {
  background: var(--bg-color5);
  border: 0px;
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
}

#recent-file-panel thead tr {
  background-color: var(--table-thead-color);
}

#recent-file-panel tbody tr:nth-child(2n) {
  background-color: var(--table-bg-darker-color);
}

#recent-file-panel tbody tr:nth-child(2n + 1) {
  background-color: var(--table-bg-color);
}

#recent-file-panel-action-btn:hover {
  background-color: var(--hover-bg-color1);
  color: var(--text-color2);
}

/* theme preview */
.theme-preview-div {
  box-shadow: 10px 0px 10px rgba(0, 0, 0, 0.8);
}

/* theme preview hover */
.theme-preview-div:hover {
  border-color: var(--theme-select-color);
}

/* context menu and spell check panel */
.dropdown-menu:not(.megamenu-menu-list) {
  background-color: var(--bg-color2);
  color: var(--text-color2);
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.5);
}

/* divider in context menu and spell check panel */
.dropdown-menu .divider {
  border-color: var(--menu-divider-color);
}

/* remove divider outline */
.dropdown-menu {
  border: 0px;
}

/* footer */
footer.ty-footer {
  border-top: 0px !important;
  background-color: var(--bg-color2) !important;
  /*     color: var(--text-color2); */
  box-shadow: 0px -2px 10px rgba(0, 0, 0, 0.5);
}

/* footer item */
.footer-item,
#outline-btn,
#footer-word-count {
  color: var(--text-color2);
  opacity: 1;
}

/* footer item hover */
.footer-item:hover,
#outline-btn:hover {
  background-color: var(--hover-bg-color1);
  color: var(--hover-text-color);
}

/* button on some panel */
.btn {
  border: 0px;
  outline-width: 0px !important;
}

.btn:hover {
  background-color: var(--hover-bg-color1);
  color: var(--hover-text-color);
}

/* traffic button hover */
#top-titlebar .toolbar-icon.btn:hover {
  color: var(--text-color2);
  background-color: var(--hover-bg-color1);
}

/* traffic button hover */
#top-titlebar #w-close:hover {
  background-color: #e81123 !important;
}

/* adjust maxmize restore button height */
.typora-maxmized #w-restore {
  height: 24px;
}

/* left upper button hover */
.ty-menu-btn-area:hover .ty-menu-btn-area-sub {
  color: var(--text-color2) !important;
}

/* scrollbar */
::-webkit-scrollbar {
  width: 8px;
  padding-right: 10px;
  background-color: rgba(0, 0, 0, 0);
}

/* scrollbar track */
::-webkit-scrollbar-track:hover {
  background-color: var(--scrollbar-track-color) !important;
  border-radius: 4px;
}

/* scrollbar thumb */
::-webkit-scrollbar-thumb,
::-webkit-scrollbar-thumb:active {
  background-color: var(--scrollbar-thumb-color) !important;
  border-radius: 4px;
}

/* tip when hover on a button */
#ty-tooltip {
  background-color: var(--bg-color4);
  color: var(--text-color4);
}

/* item container hover in context menu */
.menu-item-container:hover {
  background-color: var(--bg-color2);
}

/* item in context menu */
.menu-item-container .menu-style-btn {
  border-color: var(--menu-divider-color);
}

/* mathjax edit panel*/
.md-rawblock-before {
  border-top-left-radius: 6px;
}

.md-rawblock-after {
  border-bottom-left-radius: 6px;
  border-bottom-right-radius: 6px;
}

/* mathjax focus */
.MathJax_SVG:focus {
  outline: none;
  background-color: transparent;
}

/* notification panel */
#md-notification {
  background-color: var(--bg-color2) !important;
  color: var(--text-color2);
  box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.5);
}

#ty-surpress-mode-warning-close-btn {
  float: unset !important;
  margin: 0px !important;
}

.unibody-window #md-notification p {
  bottom: -4px !important;
}

/* inline codeblock */
code {
  font-size: 0.9em;
  background-color: var(--bg-color5);
  border-radius: 6px;
  padding: 4px 4px 4px 4px;
  margin: 0px 6px 0px 6px;
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
}

/* codeblock */
.md-fences,
.md-fences:active {
  background-color: var(--bg-color5);
  border-radius: 6px;
  padding: 8px 4px 8px 4px !important;
  margin-top: 15px;
  margin-bottom: 15px;
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
}

.md-fences .code-tooltip {
  display: block !important;
  visibility: hidden;
  opacity: 0;
  transition: 0.3s;
  background-color: var(--bg-color3);
}

.md-fences.md-focus .code-tooltip {
  opacity: 1;
  visibility: visible;
}

.CodeMirror-lines {
  padding-left: 4px;
}

/* selected text and cursor */
.CodeMirror-selected,
.CodeMirror-selectedtext {
  background: var(--code-select-bg-color) !important;
}

.CodeMirror div.CodeMirror-cursor {
  border-left: 2px solid var(--code-cursor-color);
  z-index: 3;
}

.CodeMirror.cm-s-typora-default div.CodeMirror-cursor {
  border-left: 3px solid var(--code-cursor-color);
}

/* highlight */
.cm-s-inner .cm-property {
  color: var(--code-blue-color) !important;
}

.cm-s-inner .cm-operator {
  color: var(--code-cyan-color) !important;
}

.cm-s-inner .cm-keyword {
  color: var(--code-purple-color) !important;
}

.cm-s-inner .cm-tag {
  color: var(--code-red-color) !important;
}

.cm-s-inner .cm-attribute {
  color: var(--code-orange-color) !important;
}

.cm-s-inner .cm-string {
  color: var(--code-green-color) !important;
}

.cm-s-inner .cm-comment,
.cm-s-inner.cm-comment {
  /*     color: var(--code-orange-color) !important; */
  color: var(--code-grey-color) !important;
  font-style: italic;
}

.cm-s-inner .cm-header,
.cm-s-inner .cm-def,
.cm-s-inner.cm-header,
.cm-s-inner.cm-def {
  /*     color: var(--code-red-color) !important; */
  color: var(--code-blue-color) !important;
}

.cm-s-inner .cm-meta,
.cm-s-inner .cm-qualifier {
  color: var(--code-red-color) !important;
}

.cm-s-inner .cm-builtin {
  /*     color: var(--code-blue-color) !important; */
  color: var(--code-cyan-color) !important;
}

.cm-s-inner .cm-bracket {
  color: var(--text-color1) !important;
}

.cm-s-inner .cm-number {
  color: var(--code-orange-color) !important;
}

.cm-s-inner .cm-variable {
  color: var(--text-color1) !important;
}

.cm-s-inner .cm-variable-2 {
  /*     color: var(--code-blue-color) !important; */
  color: var(--code-yellow-color) !important;
}

.cm-s-typora-default .cm-header,
.cm-s-typora-default .cm-property {
  color: var(--code-red-color) !important;
}

.cm-s-typora-default .cm-string {
  /*     color: var(--code-blue-color); */
  color: var(--code-purple-color);
}

.cm-s-typora-default .cm-atom {
  color: var(--code-grey-color);
  font-style: italic;
}

.cm-s-typora-default .cm-number {
  color: var(--code-orange-color);
  font-style: normal !important;
}

.cm-s-typora-default .cm-link {
  color: var(--code-blue-color);
}

.cm-s-typora-default .CodeMirror-activeline-background {
  background: var(--hover-bg-color1);
}

.cm-s-typora-default .cm-comment,
.cm-s-typora-default .cm-code {
  color: var(--code-purple-color);
}

.cm-s-typora-default .cm-tag {
  /*     color: var(--code-red-color); */
  color: var(--code-blue-color);
}

.cm-s-typora-default .cm-strong,
.cm-s-typora-default .cm-em,
.cm-s-typora-default .cm-del {
  /*     color: var(--code-green-color); */
  color: var(--code-orange-color);
}

.cm-s-typora-default .cm-block-start.cm-variable-2 {
  /*     color: var(--code-orange-color); */
  color: var(--code-red-color);
}

.cm-formatting-task .cm-formatting-task {
  color: var(--code-red-color);
}

/* math formula tag */
.cm-s-inner .cm-atom,
.cm-s-inner.cm-atom {
  color: var(--code-blue-color);
}

/* inline codeblock in source mode */
.cm-s-typora-default .cm-comment {
  color: var(--code-green-color);
}

/* horizontal divider when language is markdown */
.cm-s-inner .cm-hr {
  color: var(--text-color1);
}

/* variable type when language is c/cpp */
.cm-s-inner .cm-variable-3 {
  color: var(--code-purple-color);
}

/* unknown highlight keyword */
.cm-s-inner .cm-quote,
.cm-s-inner.cm-quote {
  color: #57ac57;
}

.cm-s-inner .cm-link {
  color: var(--code-blue-color);
}

.cm-s-inner .cm-negative {
  color: #d95050;
}

.cm-s-inner .cm-positive {
  color: #50e650;
}

.cm-s-inner .cm-string-2 {
  color: #f50;
}

.CodeMirror-gutters {
  border-right: none;
}

/* focus mode */
.on-focus-mode .md-end-block:not(.md-focus) .md-toc-item {
  opacity: 0.5;
}

.on-focus-mode #write h1:not(.md-focus):before {
  opacity: 0.5;
}

.on-focus-mode #write h2:not(.md-focus):before {
  opacity: 0.5;
}

.on-focus-mode #write h1:not(.md-focus) {
  border-color: var(--text-color5);
}

.on-focus-mode #write h2:not(.md-focus) {
  border-color: var(--text-color5);
}

.on-focus-mode #write h3:not(.md-focus) {
  border-color: var(--text-color5);
}

/* YAML block */
pre.md-meta-block,
pre.md-meta-block:active {
  background-color: var(--bg-color5);
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
  border-radius: 6px;
  padding: 10px;
  padding-left: 20px;
  padding-right: 20px;
}

/* switch between different mode */
#typora-source {
  display: block !important;
  visibility: hidden;
  opacity: 0;
  transition: 0.3s;
}

.typora-sourceview-on #typora-source {
  visibility: visible;
  opacity: 1;
}

#typora-source .CodeMirror-lines {
  max-width: 1200px;
  padding-left: 70px;
  padding-right: 70px;
}

#write {
  display: block !important;
  visibility: visible;
  opacity: 1;
  transition: 0.3s;
  max-width: 1200px;
  padding-left: 70px;
  padding-right: 70px;
}

.typora-sourceview-on #write {
  visibility: hidden;
  opacity: 0;
}

/* #md-searchpanel {
    visibility: hidden;
    opacity: 0;
    transition: 0.3s !important;
}

.on-search-panel-open #md-searchpanel {
    visibility: visible;
    opacity: 1;
} */

.uni-preference-panel {
  display: block;
  visibility: hidden;
  opacity: 0;
  transition: 0.3s;
}

.show-preference-panel .uni-preference-panel {
  visibility: visible;
  opacity: 1;
}

/* quick open menu */
.typora-quick-open-item:hover {
  background-color: var(--hover-bg-color1);
  color: var(--hover-text-color);
}

/* insert table panel */
.modal-content {
  border: 0px;
  border-radius: 6px;
}

.modal-content .btn-primary {
  background-color: var(--hover-bg-color1);
  color: var(--text-color1);
  outline-width: 0px;
}

.modal-content .btn-primary:hover {
  color: var(--hover-text-color);
}

.modal-content .form-control,
.modal-content .form-control:focus {
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
}

.modal-backdrop {
  background-color: black;
  opacity: 0.3 !important;
}

/* zoom  */
#zoom-hint #zoom-hint-reset {
  color: var(--text-color1);
}

#zoom-hint .zoom-hint-button:hover {
  color: var(--hover-text-color) !important;
}

/* word count */
#footer-word-count-info {
  display: block;
  visibility: hidden;
  opacity: 0;
  transition: 0.3s;
}

.ty-show-word-count #footer-word-count-info {
  visibility: visible;
  opacity: 1;
}

/* spell check */
#spell-check-panel {
  display: block;
  visibility: hidden;
  opacity: 0;
  transition: 0.3s;
}

.ty-show-spell-check #spell-check-panel {
  visibility: visible;
  opacity: 1;
}

/* search result */
.md-search-select {
  border: 2px solid rgb(69, 125, 255);
  box-sizing: content-box;
  color: var(--text-color1) !important;
}

.md-search-hit {
  background-color: var(--search-select-bg-color);
}

/* search panel message */
#searchpanel-msg {
  background-color: var(--bg-color2);
  color: var(--text-color2);
}

.searchpanel-msg-btn:hover {
  background-color: var(--hover-bg-color1);
  color: var(--hover-text-color);
}

/* language selection for codeblock */
.auto-suggest-container {
  border: 0px;
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
  background-color: var(--bg-color2);
}

/* sidebar outline item hover and active */
.outline-item:hover {
  color: var(--hover-text-color);
}

.outline-label:hover {
  text-decoration: none;
}

.pin-outline .outline-active {
  color: var(--hover-text-color);
}

/* sidebar title hover */
.info-panel-tab:hover {
  color: var(--hover-text-color) !important;
}

/* active file in sidebar file menu treeview */
.file-tree-node.active > .file-node-background {
  background-color: var(--hover-bg-color1);
}

/* hover file in sidebar file menu treeview */
.file-node-content:hover {
  cursor: pointer;
}

/* saved button in megamenu */
#m-saved:hover {
  background-color: var(--bg-color2);
  color: var(--text-color2);
  cursor: default;
}

/* mermaid sequence*/
text.actor {
  fill: var(--text-color1);
}

.labelText {
  fill: var(--text-color1);
}

.loopText {
  fill: var(--text-color1);
}

/* mermaid flowchart */
.node rect,
.node circle,
.node ellipse,
.node polygon {
  fill: var(--bg-color2);
  stroke: var(--text-color1);
  stroke: var(--menu-divider-color);
}

.edgePath .path {
  stroke: var(--menu-divider-color);
}

.label {
  color: var(--text-color1);
}

/* mermaid gantt */
.titleText {
  fill: var(--text-color1);
}

.section0,
.section2 {
  fill: var(--table-thread-color);
}

.section1,
.section3 {
  fill: var(--table-bg-color);
}

.task0,
.task1,
.task2,
.task3 {
  fill: rgb(80, 84, 90);
  stroke: rgb(80, 84, 90);
}

.taskText0,
.taskText1,
.taskText2,
.taskText3 {
  fill: var(--text-color2) !important;
}

.active0,
.active1,
.active2,
.active3 {
  fill: rgb(100, 104, 110);
  stroke: rgb(100, 104, 110);
}

.activeText0,
.activeText1,
.activeText2,
.activeText3 {
  fill: var(--text-color2) !important;
}

.done0,
.done1,
.done2,
.done3 {
  fill: rgb(48, 51, 58);
  stroke: rgb(48, 51, 58);
}

.crit0,
.crit1,
.crit2,
.crit3 {
  fill: rgb(150, 150, 150);
  stroke: var(--text-color1);
}

.activeCrit0,
.activeCrit1,
.activeCrit2,
.activeCrit3 {
  fill: rgb(100, 104, 110);
  stroke: var(--text-color1);
}

.doneCrit0,
.doneCrit1,
.doneCrit2,
.doneCrit3 {
  fill: rgb(48, 51, 58);
  stroke: var(--text-color1);
}

.taskTextOutside0,
.taskTextOutside2,
.taskTextOutside1,
.taskTextOutside3 {
  fill: var(--text-color1) !important;
}

.grid text {
  fill: white;
}

.today {
  stroke: var(--text-color1);
}

/* flow diagram */
.md-fences[lang="flow"] .md-diagram-panel-preview rect {
  fill: var(--bg-color2);
  stroke: var(--menu-divider-color);
  stroke-width: 1.2;
}

.md-fences[lang="flow"] .md-diagram-panel-preview path {
  stroke: var(--menu-divider-color);
  stroke-width: 1.2;
}

.md-fences[lang="flow"] #cond {
  fill: var(--bg-color2);
}

/* sequence diagram */
.md-fences[lang="sequence"] .md-diagram-panel-preview rect:not([fill="none"]) {
  fill: var(--bg-color2);
  stroke: var(--menu-divider-color);
  stroke-width: 1.2;
}

.md-fences[lang="sequence"] .md-diagram-panel-preview path {
  fill: var(--menu-divider-color);
  stroke: var(--menu-divider-color);
  stroke-width: 1.2;
}

.md-fences[lang="sequence"] text,
.md-fences[lang="flow"] text {
  font-family: "Consolas" !important;
}

/* remove box shadow when not edit graph */
.md-fences[lang="sequence"]:not(.md-focus),
.md-fences[lang="mermaid"]:not(.md-focus),
.md-fences[lang="flow"]:not(.md-focus) {
  box-shadow: none;
}

/* remove border when edit graph */
.md-diagram-panel {
  border: none !important;
}



</style>
</head>
<body class='typora-export os-windows'>
<div id='write'  class=''><h1><a name="计算机组成原理" class="md-header-anchor"></a><span>计算机组成原理</span></h1><p><span>【考查目标】</span>
<span>  1.理解单处理器计算机系统中各部件的内部工作原理、组成结构以及相互连接方式，具有完整的计算机系统的整机概念。</span>
<span>  2.理解计算机系统层次化结构概念，熟悉硬件与软件之间的界面，掌握指令集体系结构的基本知识和基本实现方法。</span>
<span>  3.能够综合运用计算机组成的基本原理和基本方法，对有关计算机硬件系统中的理论和实际问题进行计算、分析，对一些基本部件进行简单设计;并能对高级程序设计语言(如C语言)中的相关问题进行分析。</span></p><p><span>MD语法：上划线：</span><span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.718ex" height="2.928ex" viewBox="0 -1057.4 2461.9 1260.5" role="img" focusable="false" style="vertical-align: -0.472ex;"><defs><path stroke-width="0" id="E1-MJMAIN-AF" d="M69 544V590H430V544H69Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g transform="translate(24,0)"><text font-family="STIXGeneral, 'PingFang SC', serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">上</text><g transform="translate(804,0)"><text font-family="STIXGeneral, 'PingFang SC', serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">划</text></g><g transform="translate(1608,0)"><text font-family="STIXGeneral, 'PingFang SC', serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">线</text></g></g><g transform="translate(0,485)"><use transform="scale(0.707)" xlink:href="#E1-MJMAIN-AF" x="-69" y="0"></use><g transform="translate(-108.25771222141248,0) scale(7.450717751521813,1)"><use transform="scale(0.707)" xlink:href="#E1-MJMAIN-AF"></use></g><use transform="scale(0.707)" xlink:href="#E1-MJMAIN-AF" x="2981" y="0"></use></g></g></svg></span><script type="math/tex">\overline{\text{上划线}}</script><span> ；下划线：</span><u><span>下划线</span></u><span>；中划线</span><del><span>线</span></del><span>；下标</span><sub><span>1</span></sub><span>；上标</span><sup><span>3</span></sup></p><p><strong><span>加粗</span></strong><span>，</span><em><span>倾斜</span></em><span>，</span><strong><span>加粗</span></strong></p><p>&nbsp;</p><p>&nbsp;</p><h1><a name="一计算机系统概述" class="md-header-anchor"></a><span>一、计算机系统概述</span></h1><h2><a name="一计算机发展历程" class="md-header-anchor"></a><span>//(一)计算机发展历程</span></h2><h3><a name="四代硬件" class="md-header-anchor"></a><span>四代硬件：</span></h3><p><span>1946：ENIAC，1958年集成电路发明，1970年仙童半导体存储器。</span></p><p><span>第一代：1946-1957：电子管；主存用延迟线或磁鼓；机器语言；几千次到4万次每秒。</span></p><p><span>第二代：1958-1964：晶体管；主存使用磁心存储器；开始使用高级语言 FORTRAN；几万次到几十万次每秒，出现操作系统雏形。</span></p><p><span>第三代：1965-1971：中小规模集成电路；半导体存储器；高级语言发展；开始有分时操作系统。</span></p><p><span>第四代：1972-：超大规模集成电路；产生了微处理器；并行、流水线、高速缓存、虚拟存储等概念使用。</span></p><p><span>更新换代：摩尔定律；半导体11代：1KB~1GB；微处理器从8008(8位)、8080(16位)、80386(32位)、Pentium(32位)、Pentium Pro(64位机器字长）。</span></p><p><span>程序语言：科学&amp;工程计算语言FORTRAN，结构化PASCAL，对象C++，网络Java。</span></p><p><span>操作系统：Windows，Linux，UNIX等。</span></p><p><span>分类&amp;发展方向：电子计算机可分为模拟和数字。数字计算机可按用途分为专用&amp;通用。通用分为巨型机、大型机、中型机、微型机、单片机。按指令和数据流可分为：SISD（单指令流单数据流）冯诺依曼；SIMD（单指令流多数据流）阵列处理器和向量处理器；MIMD（多指令流多数据流）多处理器和多计算机系统。</span></p><p><span>“两极”分化，微型计算机微型化、网络化、多用途化；巨型机巨型化、超高速、并行处理。</span></p><h2><a name="二计算机系统层次结构" class="md-header-anchor"></a><span>(二)计算机系统层次结构</span></h2><h3><a name="1计算机系统的基本组成" class="md-header-anchor"></a><span>1.计算机系统的基本组成</span></h3><p><span>软硬件共同组成了完整的计算机系统，某一功能用软硬件都能实现，则称为软硬件在逻辑上是等效的。频繁的用硬件实现成本比较理想，硬件提高效率，软件提高灵活。</span></p><h3><a name="2计算机硬件的基本组成" class="md-header-anchor"></a><span>2.计算机硬件的基本组成</span></h3><p><span>冯诺依曼在研究 EDVAC机时提出了“存储程序”的概念，奠定了现代计算机基本结构；</span></p><p><span>早期冯诺依曼机：运算器为核心，特点有：</span></p><ol start='' ><li><span>硬件由运算器、存储器、控制器、输入、输出，5部分组成</span></li><li><span>指令和数据同等地位存在存储器，可按地址寻访</span></li><li><span>指令和数据用二进制表示</span></li><li><span>指令由操作码和地址码组成，操作码表示操作性质，地址码表示操作数地址</span></li><li><span>指令在存储器顺序存取，通常指令是顺序的，特定条件下可跳转</span></li><li><span>以运算器为核心，输入输出通过运算器和存储器传送数据</span></li></ol><p><span>现代计算机：微处理器以前，运算器控制器分离，存储器容量小，所以运算为中心，微电子技术的进步、IO和CPU速度差异、信息量与日俱增使原有结构不能满足，出现了存储器为核心的结构，IO操作绕过CPU，提高效率。</span></p><h4><a name="功能部件" class="md-header-anchor"></a><span>功能部件：</span></h4><p><span>I/O……</span></p><p><span>存储器，分为主存和辅存（外存），cpu直接访问主存，存储单元包含若干存储元件，每个元件存储1位，存储单元可以存储一个存储字，存储字长可以是1B(8bit)的偶数倍。主存工作方式是按地址存取方式（相联存储器按内容访问）。主存包括存储体、时序控制逻辑、MDR、MAR，MAR是主存的一部分，但在现代CPU中。MAR位数对应存储单元个数，MDR位数对应存储字长。</span></p><p><span>运算器，用于算术和逻辑运算，核心是 ALU，包括若干通用寄存器如 ACC(累加器)、MQ(乘商)、X(操作数)、IX(变址寄存器)、BR(基址寄存器)，前三种必须。另有PSW(程序状态寄存器)存放标志信息如进位、负、溢出。</span></p><p><span>控制器，主要包括PC(程序计数器)、IR(指令寄存器)、CU(控制单元)组成。PC联通MAR，存放欲执行指令地址，可以自动加一。IR存放来自MDR的当前指令，分析指令并发出微操作命令，操作码OP(IR)送到CU，地址码Ad(IR)送到MAR取操作数。</span></p><p><span>运算器和控制器一般集成在同一芯片CPU上，与主存一同构成主机，其他硬件统称外设。</span></p><h3><a name="3计算机软件分类" class="md-header-anchor"></a><span>3.计算机软件分类</span></h3><p><span>系统软件：保证计算机系统高效正确运行的基础，主要有OS、DBMS(数据库管理)、语言处理程序、分布式软件系统、网络、标准库、服务型程序等。（DMS数据库系统=DBMS+DB+DBA）</span></p><p><span>应用软件：用户为了解决某种应用而编制的程序。</span></p><h4><a name="三级语言" class="md-header-anchor"></a><span>三级语言：</span></h4><p><span>机器语言：二进制代码语言，计算机唯一可以直接识别执行的语言。</span></p><p><span>汇编语言：助记码代替二进制的指令代码，需要通过汇编程序翻译为机器语言才能执行。</span></p><p><span>高级语言：方便程序设计人员的程序，需要编译程序编译为汇编语言程序，而后汇编得到机器语言程序；或者用解释程序变成机器语言一句一句执行，不生成目标程序。</span></p><p><span>翻译程序=解释程序+编译程序，汇编、编译区别。</span></p><h3><a name="4计算机的工作过程" class="md-header-anchor"></a><span>4.计算机的工作过程</span></h3><p><span>三个步骤：程序和数据装入主存；源程序转换为可执行文件；从可执行文件首地址开始执行指令</span></p><p><span>源代码1.c--&gt;CPP(预处理器)=1.i--&gt;CCL(编译器)=汇编代码1.s--&gt;AS(汇编器)=目标文件1.o--&gt;LD(链接器)=可执行二进制程序</span></p><p><span>指令执行过程：</span></p><p><span>取址：PC--&gt;MAR--&gt;M--&gt;MDR--&gt;IR</span></p><p><span>分析：OP(IR)--&gt;CU</span></p><p><span>执行：Ad(IR)--&gt;MAR--&gt;M--&gt;MDR--&gt;ACC</span></p><p><span>取下一条：(PC)+1--&gt;PC</span></p><h3><a name="5层次结构" class="md-header-anchor"></a><span>5.层次结构</span></h3><p><span>微程序M0，硬件层，直接执行微指令；</span></p><p><span>传统机器语言层M1，硬件层，由微程序解释机器指令；</span></p><p><span>虚拟机器M2，操作系统层，由机器指令和广义指令组成，扩展机器功能，是混合层；</span></p><p><span>虚拟机器M3，汇编语言层，由汇编程序提供支持和执行；</span></p><p><span>虚拟机器M4，高级语言。</span></p><p><span>第5层之上还可以有应用层，层次之间上层是下层的扩展，下层是上层的基础，但随着技术发展部分软件功能由硬件实现，软硬交界划分不绝对。</span></p><p>&nbsp;</p><h2><a name="三计算机性能指标" class="md-header-anchor"></a><span>(三)计算机性能指标</span></h2><p><span>吞吐量、响应时间;CPU时钟周期、主频、CPI、CPU执行时间;MIPS、MFLOPS 、GFLOPS、TFLOPS、PFLOPS。</span></p><p><span>主要性能指标：</span></p><p><span>机器字长：一次整数运算能处理的二进制数据的位数，一般等于内部寄存器字长，是8的整数倍。</span></p><p><span>数据通路带宽：数据总线一次能并行传送的数据位数，即数据字长，与CPU内部总线宽度不一定相同。</span></p><p><span>主存容量：一般用字节，也可以用字数x字长（512Kx16位）MAR位数反映存储单元个数，但不一定是存储器实际容量</span></p><p><span>吞吐量：取决于主存的存取周期，吞吐率是一个综合参数。</span></p><p><span>响应时间：通常包括CPU时间和等待时间（I/O、存储器、操作系统开销）</span></p><p><span>主频：CPU时钟频率。时钟周期：主频的倒数，CPU的最小时间单位，也叫T周期、CPU时钟周期。CPU周期=机器周期，包括多个时钟周期。指令周期包括若干个机器周期。</span></p><p><span>CPI执行一条指令所需的时钟周期数。</span></p><p><span>CPU执行时间：执行一个程序所需花费的时间=时钟周期数/主频=（指令条数xCPI）/主频。主频、CPI、指令条数相互制约</span></p><p><span>MIPS：百万条指令每秒；MFLOPS：百万次浮点操作每秒；GFLOPS：十亿次浮点操作每秒；TFLOPS：万亿次浮点操作每秒</span></p><p><span>通常容量KMGT用2的幂次表示；频率等用10的幂次，后者常用小写的k。</span></p><p><span>系统机：具有相同的体系结构，相同基本指令系统的系列。</span></p><p><span>固件：程序固定在ROM中，具有软件特点的硬件。</span></p><h1><a name="二数据的表示和运算" class="md-header-anchor"></a><span>二、数据的表示和运算</span></h1><h2><a name="一数制与编码" class="md-header-anchor"></a><span>(一)数制与编码</span></h2><h3><a name="1进位计数制及其相互转换" class="md-header-anchor"></a><span>1.进位计数制及其相互转换</span></h3><p><span>二进制？1.两种状态能用有两个稳态的物理器件表示，成本低；2.10与逻辑真假对应，方便逻辑运算和判断；3.编码运算简单，能用逻辑门电路实现算数运算。</span></p><p><span>一个进位数的大小就是各位数码按位权相加。</span></p><h3><a name="2真值和机器数" class="md-header-anchor"></a><span>2.真值和机器数</span></h3><p><span>真值即实际值，把符号数字化(0/1)成为机器数</span></p><h3><a name="3bcd码" class="md-header-anchor"></a><span>3.//BCD码</span></h3><p><span>4位2禁止表示1位十进制，有6种冗余。</span></p><p><span>常用8421，相加之和大于等于1010，则+6进位修正。</span></p><p><span>余3码：8421的基础上+0011.</span></p><p><span>2421码：大于等于5的最高位是1，小于5的首位是0.</span></p><h3><a name="4字符与字符串" class="md-header-anchor"></a><span>4.字符与字符串</span></h3><p><span>ASCII：128个，7位。0-31控制字符，32SP空格，32-126一共95个可印刷字符，127DEL，0-9是011+四位二进制即48~57，A65，a97.</span></p><p><span>GB2312-1980(1981年)一级汉字3755，二级汉字3008，符号682，共7445.最新的是GB18030(2000年)。</span></p><p><span>区位码：两字节一个汉字，每字节7位，区位码是4位二进制，前两位区码后两位位码。</span></p><p><span>国际码：区位码每字节加上20H，即国际码=(区位码)</span><sub><span>16</span></sub><span>+2020H；</span></p><p><span>汉字内码：为了区分ASCII和中文，两字节的最高位都是1，即内码=(国际码) </span><sub><span>16</span></sub><span>+8080H。</span></p><h3><a name="5校验码" class="md-header-anchor"></a><span>5.//校验码</span></h3><p><span>码距：任意两个合法码字之间最少变化的二进制位数。码距不小于2的数据校验码开始具有检错能力，检错大于纠错能力。</span></p><ol start='' ><li><span>奇偶校验：原编码加上1位奇偶校验位，可以检测出奇数位错误，但不能确定位置。局限性强，常用于存储器数据的检查或者传输数据的检查</span></li><li><span>汉明码（海明码）：多重奇偶校验码，在有效信息位中加入几个校验位，海明码的每个二进制分配到几个奇偶校验组，不仅能发现错位还能找出位置。检错1位则有 n+k&lt;=2</span><sup><span>k</span></sup><span> -1，检错两位则k+=1；校验位分布在2</span><sup><span>i-1</span></sup><span>位置上；分组形成校验关系；取⊕算出校验码；校验时用校验码和信息位列出方程，获得校验值，000则无错，否则数值就是错误的位数。</span></li><li><span>CRC（循环冗余）：K位信息码后拼接R位校验码，编码长度位N，又叫(N,K)码，基于线性编码理论，R=生成多项式最高幂次，产生过程：N左移R位，补0；对生成多项式模2取余（不借位异或，循环右移至余数小于除数）；将余数作为校验码，补在信息码后。接收后同样与生成多项式模2取余，得到的余数就是出错位数。</span></li></ol><h2><a name="二定点数的表示和运算" class="md-header-anchor"></a><span>(二)定点数的表示和运算</span></h2><h3><a name="1定点数的表示" class="md-header-anchor"></a><span>1.定点数的表示</span></h3><p><span>有符号数：通常约定最高位为符号位。</span></p><p><span>无符号数：全部二进制是数值位，没有符号位。</span></p><p><span>定点：约定小数点位置固定不变，将小数点固定在最高位之前--&gt;定点小数；固定在最低为之后--&gt;定点整数。</span></p><p><span>定点小数：纯小数，第一位符号位，后面是有效数值，符号位0，其他1，表示最大正数1-2</span><sup><span>-n</span></sup><span>，符号位1，其他1表示最小负数-(1-2</span><sup><span>-n</span></sup><span>).</span></p><p><span>定点整数：纯整数，表示范围是2</span><sup><span>n</span></sup><span>-1~-(2</span><sup><span>n</span></sup><span>-1).</span></p><p><span>原码：简单直观的机器数表示法，最高位表示符号，其他表示数的绝对值大小，同上述定点整数、小数一致，0有正0和负0两种。</span></p><p><span>反码：补码和原码之间的过渡，正数不变，负数取反。表示范围同原码一致，0有两个，全0和全1。</span></p><p><span>补码：方便加减法，正数和反码一致，负数比反码+1，0唯一全零，范围-2</span><sup><span>n</span></sup><span>~2</span><sup><span>n</span></sup><span>-1，比原码多表示一个2</span><sup><span>n</span></sup><span>，(或纯小数多一个-1)。</span></p><p><span>移码：真值加上一个常数X，通常取2</span><sup><span>n</span></sup><span>，相当于唯一了n个单位，特点有：0唯一，移码和补码只差一个符号位，保持数据原有顺序</span></p><h3><a name="2定点数的运算" class="md-header-anchor"></a><span>2.定点数的运算</span></h3><p><span>定点数的位移运算;原码定点数的加减运算;补码定点数的加/减运算;定点数的乘/除运算;溢出概念和判别方法。</span></p><ol start='' ><li><p><span>移位:左移相当于*2，右移相当于/2；</span></p><ol start='' ><li><span>逻辑移位：全添0</span></li><li><span>算术移位：正数全添0，负数原码0反码1，补码左0右1.</span></li><li><span>循环移位：根据是否有进位标志CF分为大小循环。</span></li></ol></li><li><p><span>加减法</span></p><ol start='' ><li><span>原码：加法，符号相同？绝对值相加：否则绝对值大减小，符号与绝对值大的相同；减法，减数符号取反，然后做加法。</span></li><li><span>补码：加法直接相加，modM去掉溢出，减法则将被减数和减数的机器负数相加，运算结果还是补码。</span></li></ol></li><li><p><span>乘法：由累加和右移实现，根据机器数不同分为原码一位乘法和补码一位乘法。</span></p><ol start='' ><li><p><span>原码一位乘法：符号位与数值分开求，符号位通过异或运算，数值位则是两个数值绝对值相乘。部分积取n+1位，初值为0。对乘数最低位开始判断，为1则部分积加上被乘数然后右移移位，0则加上0然后右移。重复n次。运算中可能出现绝对值大于1，但不一定溢出，所以采用双符号位。</span></p></li><li><p><span>补码一位乘法：（Booth算法）</span></p><p><span>符号位参与运算，运算的数都采用补码表示；被乘数双符号位参与，部分积双符号位，乘数可取单符号位；末尾附加y</span><sub><span>n+1</span></sub><span>，初值为0；根据y</span><sub><span>n</span></sub><span>和y</span><sub><span>n+1</span></sub><span>的取址确定操作：y</span><sub><span>n</span></sub><span>=0？y</span><sub><span>n+1</span></sub><span>=0？部分积右移：部分积+[X]</span><sub><span>补</span></sub><span>并右移：部分积加-[X]</span><sub><span>补</span></sub><span>并右移：部分积右移；重复n+1次操作，第n+1次不移位（n+1次累加和n次移位）。</span></p></li></ol></li><li><p><span>除法：累加左移</span></p><ol start='' ><li><p><span>原码除法（不恢复余数法）</span></p><p><span>符号由两数符号位异或得到；数值由绝对值相除|X|/|Y|；被除数剑去除数，余数为正？商上1，余数和商左移一位：商上0，余数和商左移一位；循环n+1步，当n+1步余数为负时加上 |Y|得到正确余数。</span></p></li><li><p><span>补码除法（加减交替法）</span></p><p><span>符号位参与运算，所有数用补码表示；被除数与除数同号？被除数减除数得部分余数：被除数加除数得部分余数；部分余数和除数同号？商上1：商上0；部分余数左移移位加上除数；重复上步n次，末位恒置1（有精度要求另算）。</span></p></li></ol></li><li><p><span>溢出：定点数加减法出现溢出则运算结果是错误的。</span></p><ol start='' ><li><span>1符号位：V=AB· </span><span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.406ex" height="2.811ex" viewBox="0 -1107.7 605.5 1210.2" role="img" focusable="false" style="vertical-align: -0.238ex;"><defs><path stroke-width="0" id="E2-MJMAIN-53" d="M55 507Q55 590 112 647T243 704H257Q342 704 405 641L426 672Q431 679 436 687T446 700L449 704Q450 704 453 704T459 705H463Q466 705 472 699V462L466 456H448Q437 456 435 459T430 479Q413 605 329 646Q292 662 254 662Q201 662 168 626T135 542Q135 508 152 480T200 435Q210 431 286 412T370 389Q427 367 463 314T500 191Q500 110 448 45T301 -21Q245 -21 201 -4T140 27L122 41Q118 36 107 21T87 -7T78 -21Q76 -22 68 -22H64Q61 -22 55 -16V101Q55 220 56 222Q58 227 76 227H89Q95 221 95 214Q95 182 105 151T139 90T205 42T305 24Q352 24 386 62T420 155Q420 198 398 233T340 281Q284 295 266 300Q261 301 239 306T206 314T174 325T141 343T112 367T85 402Q55 451 55 507Z"></path><path stroke-width="0" id="E2-MJMAIN-AF" d="M69 544V590H430V544H69Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#E2-MJMAIN-53" x="24" y="0"></use><g transform="translate(0,520)"><use transform="scale(0.707)" xlink:href="#E2-MJMAIN-AF" x="-69" y="0"></use><g transform="translate(246.5748156680429,0) scale(0.178123935400113,1)"><use transform="scale(0.707)" xlink:href="#E2-MJMAIN-AF"></use></g><use transform="scale(0.707)" xlink:href="#E2-MJMAIN-AF" x="356" y="0"></use></g></g></svg></span><script type="math/tex">\overline{\text{S}}</script><span> + </span><span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.147ex" height="2.694ex" viewBox="0 -1107.7 1785.5 1160" role="img" focusable="false" style="vertical-align: -0.121ex;"><defs><path stroke-width="0" id="E3-MJMAIN-41" d="M255 0Q240 3 140 3Q48 3 39 0H32V46H47Q119 49 139 88Q140 91 192 245T295 553T348 708Q351 716 366 716H376Q396 715 400 709Q402 707 508 390L617 67Q624 54 636 51T687 46H717V0H708Q699 3 581 3Q458 3 437 0H427V46H440Q510 46 510 64Q510 66 486 138L462 209H229L209 150Q189 91 189 85Q189 72 209 59T259 46H264V0H255ZM447 255L345 557L244 256Q244 255 345 255H447Z"></path><path stroke-width="0" id="E3-MJMAIN-22C5" d="M78 250Q78 274 95 292T138 310Q162 310 180 294T199 251Q199 226 182 208T139 190T96 207T78 250Z"></path><path stroke-width="0" id="E3-MJMAIN-42" d="M131 622Q124 629 120 631T104 634T61 637H28V683H229H267H346Q423 683 459 678T531 651Q574 627 599 590T624 512Q624 461 583 419T476 360L466 357Q539 348 595 302T651 187Q651 119 600 67T469 3Q456 1 242 0H28V46H61Q103 47 112 49T131 61V622ZM511 513Q511 560 485 594T416 636Q415 636 403 636T371 636T333 637Q266 637 251 636T232 628Q229 624 229 499V374H312L396 375L406 377Q410 378 417 380T442 393T474 417T499 456T511 513ZM537 188Q537 239 509 282T430 336L329 337H229V200V116Q229 57 234 52Q240 47 334 47H383Q425 47 443 53Q486 67 511 104T537 188Z"></path><path stroke-width="0" id="E3-MJMAIN-AF" d="M69 544V590H430V544H69Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g transform="translate(24,0)"><use xlink:href="#E3-MJMAIN-41"></use><use xlink:href="#E3-MJMAIN-22C5" x="750" y="0"></use><use xlink:href="#E3-MJMAIN-42" x="1028" y="0"></use></g><g transform="translate(0,531)"><use transform="scale(0.707)" xlink:href="#E3-MJMAIN-AF" x="-69" y="0"></use><g transform="translate(21.034649463056752,0) scale(4.800761064486684,1)"><use transform="scale(0.707)" xlink:href="#E3-MJMAIN-AF"></use></g><use transform="scale(0.707)" xlink:href="#E3-MJMAIN-AF" x="2025" y="0"></use></g></g></svg></span><script type="math/tex">\overline{\text{A·B}}</script><span>·S。AB为两数符号位，S为结果符号位。V=0无溢出，V=1溢出。</span></li><li><span>双符号位（模4补码）：S</span><sub><span>1</span></sub><span>S</span><sub><span>2</span></sub><span>，相同无溢出，相异溢出，00正数，11负数，01正溢，10负溢。</span></li><li><span>1符号位+进位：符号位的进位和最高数位的进位相同没有溢出，否则溢出。</span></li></ol></li><li><p><span>符号扩展：如8位--&gt;32位：正数将符号位移到符号位，数值位前添0；负数根据形式，原码添0，补码整数1小数0，反码添1。</span></p></li></ol><h3><a name="3强制类型转换" class="md-header-anchor"></a><span>3.强制类型转换</span></h3><p><span>有符号和无符号：位值不变。(unsigned short）61215=(short)-4321。16位表示到65535。</span></p><p><span>不同字长：大到小直接截断，小到大数值相等。</span></p><p><span>可能产生精度损失：float到int，小数点后丢失，int到float，精度位减少导致精度损失。</span></p><h3><a name="4数据存储" class="md-header-anchor"></a><span>4.数据存储</span></h3><p><span>大端：数据高位放在前面，对应地址低位</span></p><p><span>小端：数据高位放在后面，对应地址高位，阅读小端的机器代码时，字节相反顺序显示。</span></p><p><span>边界对齐（半字对齐：对齐提高指令效率，浪费存储空间。RISC必须对齐，CISC随意。</span></p><h2><a name="三浮点数的表示和运算" class="md-header-anchor"></a><span>(三)浮点数的表示和运算</span></h2><h3><a name="1浮点数的表示nrsupesup-m" class="md-header-anchor"></a><span>1.浮点数的表示：N=r</span><sup><span>E</span></sup><span> *M</span></h3><p><span>r是浮点数阶码的底，一般r=2；E阶码，M尾数。尾数位数反映浮点数精度，阶符J</span><sub><span>f</span></sub><span>和阶码位数m反映表示范围和小数点实际位置。</span></p><p><span>规格化：充分利用尾数的有效位数，通过规格化保证位数最高位数是一个有效值。</span></p><p><span>	</span><span>左规：左移一位，阶码减一，可能进行多次</span></p><p><span>	</span><span>右规：右移一位，阶码加一，在浮点数尾数溢出时使用，只进行一次。</span></p><h4><a name="ieee-754标准" class="md-header-anchor"></a><span>IEEE 754标准：</span></h4><p><span>短浮点数（单精度float）：阶码8，尾数23（24），偏置值127（7F），范围2</span><sup><span>-126</span></sup><span> ~2</span><sup><span>127</span></sup><span>*(2-2</span><sup><span>-23</span></sup><span>)；</span></p><p><span>长浮点数（双精度double）：阶码11，尾数52（53），偏置值1023（3FF），范围2</span><sup><span>-1023</span></sup><span>~2</span><sup><span>1023</span></sup><span>*(2-2</span><sup><span>-52</span></sup><span>)；</span></p><p><span>临时浮点数（扩展精度浮点数）阶码15，尾数64(无隐含位)，偏置值16383（3FFF）</span></p><p><span>float和double的首位1隐含，阶码用移码形式储存；</span></p><p><span>定点浮点区别：</span></p><ol start='' ><li><span>数值范围：浮点远大于定点</span></li><li><span>精度（有效数值位的位数），对于字长相同而言，浮点精度低</span></li><li><span>运算：浮点包括阶码和尾数，运算还要求规格化，所以复杂。</span></li><li><span>溢出：定点中，超过表示范围溢出；浮点中，结果超过尾数表示范围但不一定溢出，还能右规，规格化后阶码超出范围才发生溢出。</span></li></ol><h3><a name="2浮点数的加减运算补码）" class="md-header-anchor"></a><span>2.浮点数的加/减运算（补码）</span></h3><ol start='' ><li><p><span>对阶，小数点位置对齐，先求阶差，小阶向大阶看齐，右移小阶尾数直到两阶码相等。</span></p></li><li><p><span>尾数求和：尾数按定点加减法运算</span></p></li><li><p><span>规格化：</span></p></li><li><p><span>舍入：</span></p></li><li><p><span>溢出判断：</span></p></li><li><p><span>C语言的浮点数类型和转换：强制类型转换char-&gt;int-&gt;long-&gt;double，float-&gt;double；没有损失。</span></p><p><span>int-&gt;float：int32位，float24位尾数，可能有舍入</span></p><p><span>double-&gt;float：可能溢出，也可能舍入</span></p><p><span>float-&gt;int ；double-&gt;int：int没有小数，可能向0方向截取保留整数，也可能溢出</span></p></li></ol><h2><a name="四算术逻辑单元alu" class="md-header-anchor"></a><span>(四)算术逻辑单元ALU</span></h2><p><span>基本功能包括四则运算、逻辑运算、移位、求补等操作。</span></p><h3><a name="1串行加法器和并行加法器" class="md-header-anchor"></a><span>1.串行加法器和并行加法器</span></h3><p><span>加法器是由全加器和其他必要的逻辑电路组成的，根据全加器个数，能分成串行和并行加法器。</span></p><p><span>一位全加器：（FA）是最基本的加法单元，有加数A</span><sub><span>i</span></sub><span>，加数B</span><sub><span>i</span></sub><span>和低位传来的进位C</span><sub><span>i-1</span></sub><span>三个输入，有本位和S</span><sub><span>i</span></sub><span>和高位进位C</span><sub><span>i</span></sub><span>两个输出。</span></p><p><span>串行加法器：只有一个全加器，数据逐位串行送入加法器进行运算，操作数长n位则分成n次计算，每次产生一位和，串行逐位送回寄存器。优点有其减少成本低，但是运算速度慢，多用于低速专用运算器。</span></p><p><span>并行加法器由多位全加器组成，位数与机器字长相同，各位数据同时运算。可同时对数据的各位相加，但存在一个最长运算时间的问题，因为进位会影响高位结果，所以这一时间主要由进位信号的传递时间决定，全加器本身的求和延迟是次要因素，所以加法器速度提高的关键是要尽量加快进位的产生和传递的速度。通常把传递进位信号的逻辑线路连接起来构成的进位网络称为进位链。并行加法器的进位方式又分为串行进位和并行进位。</span></p><p><span>串行进位：又叫行波进位，每级进位直接依赖于前一级的进位，进位信号逐级产生。</span></p><p><span>并行进位：又叫先行进位、同时进位，特点是各级进位信号同时产生。进位信号的输入仅由G</span><sub><span>i</span></sub><span>、P</span><sub><span>i</span></sub><span>和最低位进位输入C</span><sub><span>0</span></sub><span>决定，而不依赖于低位进位。但是随着加法器位数的增加，这一进位逻辑表达式会复杂，电路结构过于复杂，所以完全并行进位是不现实的。</span></p><p><span>分组并行进位方式：通常将n位全加器分为若干个小组，小组内的各位之间采用并行快速进位，组件可以串行也可以并行。于是有：</span></p><p><span>单级先行进位方式：即组内并行，组间串行的进位方式，组内的进位通过先行进位电路（CLA）实现。</span></p><p><span>多级先行进位方式：即组内并行，组间也并行。使用多级先行进位电路（CLA），优点是字长对于加法时间的影响小，但缺点是造价高。</span></p><h3><a name="2算术逻辑单元alu的功能和结构" class="md-header-anchor"></a><span>2.算术逻辑单元ALU的功能和结构</span></h3><p><span>ALU的核心首先是一个并行加法器，同时也能执行与或非等逻辑运算。</span></p><p><span>基本结构：输入有A，B和若干控制信号、状态字信号，输出F</span><sub><span>i</span></sub><span>运算结果。</span></p><p><span>  </span></p><h1><a name="三存储器层次结构" class="md-header-anchor"></a><span>三、存储器层次结构</span></h1><p><span>重点！关注Cache和存储器扩展、容量计算、Cache原理和替换算法、虚拟存储器和快表、地址翻译和Cache映射、交叉存储器访问时间效率</span></p><h2><a name="一存储器的分类" class="md-header-anchor"></a><span>(一)存储器的分类</span></h2><p><span>按作用：主存（内存），cpu可以直接随机对其访问，可以和Cache和辅存交换数据，速度快价格贵容量小</span></p><p><span>			</span><span>辅存（外村），保存永久性保存信息，不能与CPU直接交换数据，容量大价格低</span></p><p><span>			</span><span>高速缓冲存储器Cache，主存和CPU之间，存取速度可以跟CPU匹配，但容量小价格非常高</span></p><p><span>按介质：磁表面存储器（磁盘、磁带）；磁心存储器；半导体存储器（MOS型、双极型）和光存储器（光盘）</span></p><p><span>按存取形式：随机存储器RAM：任何一个单元可以存期存取，存取时间与物理位置无关，一般做主存和缓存</span></p><p><span>					</span><span>只读存储器ROM：只能随机读出而不能写入，写入后固定不变，断电不丢失，现代“只读”可以电擦除，但是写入慢</span></p><p><span>					</span><span>串行访问存储器：需要按照物理位值先后顺序寻址，包括顺序存取存储器（磁带）和直接存取存储器（磁盘）</span></p><p><span>按信息的保存性质：易失性（RAM）断电丢失；非易失性（ROM)断电不丢失；读出后信息破坏，破坏性读出，读出后需要紧接一个再生的操作，以便恢复信息；非破坏性读出。</span></p><h4><a name="性能指标" class="md-header-anchor"></a><span>性能指标：</span></h4><ol start='' ><li><p><span>存储容量：存储字数X字长（如1M*8位）1B(Byte)=8b(bit)，存储字数表示地址空间大小，字长表示一次存取操作的数据量。</span></p></li><li><p><span>单位成本：每位价格=总价格/总容量</span></p></li><li><p><span>存储速度：数据宽度/存储周期</span></p><ol start='' ><li><span>存取时间(T</span><sub><span>a</span></sub><span>)：启动一次存储器操作到完成该操作的时间，分为读出时间和写入时间</span></li><li><span>存取周期(T</span><sub><span>m</span></sub><span>)：读写周期、访问周期，是完成一次读写操作所需的全部时间，即连续两次独立访问存储器之间所需的最小时间间隔</span></li><li><span>主存带宽(B</span><sub><span>m</span></sub><span>)：数据传输率，表示每秒从主存进出信息的最大数量，单位为字/秒，字节/秒，位/秒。</span></li></ol><p><span>存取时间不等于存储周期，通常存储周期&gt;存取时间，因为在写操作以后需要一段恢复内部状态的时间。</span></p></li></ol><h2><a name="二存储器的层次化结构" class="md-header-anchor"></a><span>(二)存储器的层次化结构</span></h2><p><span>大容量、高速度、低成本三者矛盾。</span></p><p><span>“Cache-主存”解决CPU和主存速度不匹配问题，对程序员完全透明，由硬件完成，</span></p><p><span>“主存-辅存”层次解决存储系统的容量问题，对应用程序员透明，由操作系统和硬件共同完成，形成了虚拟存储系统，编程的地址范围和存储器地址空间相对应，可用地址空间远大于主存空间。</span></p><h2><a name="三半导体随机存取存储器" class="md-header-anchor"></a><span>(三)半导体随机存取存储器</span></h2><h3><a name="1sram存储器" class="md-header-anchor"></a><span>1.SRAM存储器</span></h3><p><span>使用双稳态触发器（六晶体管MOS）来记忆信息，非破坏性读出，存取速度快、集成度低功耗大，组成高速缓冲存储器。</span></p><p><span>比较：</span></p><figure><table><thead><tr><th><span>SRAM</span></th><th><span>触发器存储</span></th><th><span>非破坏读出</span></th><th><span>无需刷新</span></th><th><span>同时送行列地址</span></th><th><span>速度快</span></th><th><span>集成度低</span></th><th><span>功耗大</span></th><th><span>成本高</span></th><th><span>高速缓存</span></th></tr></thead><tbody><tr><td><span>DRAM</span></td><td><span>电容存储</span></td><td><span>破坏性读出</span></td><td><span>需要刷新</span></td><td><span>分两次送行列地址</span></td><td><span>速度慢</span></td><td><span>集成度高</span></td><td><span>功效低</span></td><td><span>成本低</span></td><td><span>主机内存</span></td></tr></tbody></table></figure><h3><a name="2dram存储器" class="md-header-anchor"></a><span>2.DRAM存储器</span></h3><p><span>利用存储元电路栅极电容上的电荷来存储信息，通常只用一个晶体管，比SRAM密度高，采用地址复用技术，地址线是原来的1/2，地址信号分行列两次传送。相比SRAM容易集成价格低容量大功耗低，但存取速度慢，一般组成大容量主存系统。</span></p><p><span>DRAM上的电荷维持1~2ms，电源不断电信息也会自动消失，所以需要刷新，通常取2ms的刷新周期，方式有三种：</span></p><blockquote><p><span>1.集中刷新：在一个刷新周期内利用一段固定的时间“死时间”（访存“死区”）依次对存储器所有行进行逐一再生，优点是读写操作不受刷新工作影响，存取速度较高，但是在死区不能访问存储器。</span></p><p><span>2.分散刷新：把每行的刷新分散到工作周期中，一个系统工作周期分为两部分，前半部分正常读写、保持，后半部分用于刷新某一行，增加了系统存取周期，如芯片存储周期0.5us，则系统存器周期为1us，优点是没有死区，但降低了整机的速度。</span></p><p><span>3.异步刷新：将刷新周期除以行数，得到两次刷新操作之间的时间间隔t，利用逻辑电路每t时间产生一次刷新请求，避免CPU连续等待时间过长，并减少了刷新次数，从根本上提高了整机的工作效率。</span></p><p><span>将刷新安排在不需要访问存储器的译码阶段，既不会加长存取周期也不会产生死区，这是分散刷新的新发展，也叫“透明刷新”。</span></p></blockquote><p><span>刷新需要注意：对CPU透明，不依赖于外部访问；DRAM刷新的单位是行，所以刷新只需要行地址；刷新类似于读操作，仅给栅极电容补充电荷不需要信息输出；不需要选片，整个存储器中的芯片同时刷新。</span></p><h4><a name="读写周期" class="md-header-anchor"></a><span>读写周期</span></h4><p><span>从给出有效地址开始，到读出所选单元内容并在外部数据总线上稳定的出现所需的时间，称为读出时间（t</span><sub><span>a</span></sub><span>），地址片选 </span><span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.083ex" height="2.811ex" viewBox="0 -1107.7 1327.5 1210.2" role="img" focusable="false" style="vertical-align: -0.238ex;"><defs><path stroke-width="0" id="E6-MJMAIN-43" d="M56 342Q56 428 89 500T174 615T283 681T391 705Q394 705 400 705T408 704Q499 704 569 636L582 624L612 663Q639 700 643 704Q644 704 647 704T653 705H657Q660 705 666 699V419L660 413H626Q620 419 619 430Q610 512 571 572T476 651Q457 658 426 658Q322 658 252 588Q173 509 173 342Q173 221 211 151Q232 111 263 84T328 45T384 29T428 24Q517 24 571 93T626 244Q626 251 632 257H660L666 251V236Q661 133 590 56T403 -21Q262 -21 159 83T56 342Z"></path><path stroke-width="0" id="E6-MJMAIN-53" d="M55 507Q55 590 112 647T243 704H257Q342 704 405 641L426 672Q431 679 436 687T446 700L449 704Q450 704 453 704T459 705H463Q466 705 472 699V462L466 456H448Q437 456 435 459T430 479Q413 605 329 646Q292 662 254 662Q201 662 168 626T135 542Q135 508 152 480T200 435Q210 431 286 412T370 389Q427 367 463 314T500 191Q500 110 448 45T301 -21Q245 -21 201 -4T140 27L122 41Q118 36 107 21T87 -7T78 -21Q76 -22 68 -22H64Q61 -22 55 -16V101Q55 220 56 222Q58 227 76 227H89Q95 221 95 214Q95 182 105 151T139 90T205 42T305 24Q352 24 386 62T420 155Q420 198 398 233T340 281Q284 295 266 300Q261 301 239 306T206 314T174 325T141 343T112 367T85 402Q55 451 55 507Z"></path><path stroke-width="0" id="E6-MJMAIN-AF" d="M69 544V590H430V544H69Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g transform="translate(24,0)"><use xlink:href="#E6-MJMAIN-43"></use><use xlink:href="#E6-MJMAIN-53" x="722" y="0"></use></g><g transform="translate(0,520)"><use transform="scale(0.707)" xlink:href="#E6-MJMAIN-AF" x="-69" y="0"></use><g transform="translate(108.5748156680429,0) scale(3.006551060146303,1)"><use transform="scale(0.707)" xlink:href="#E6-MJMAIN-AF"></use></g><use transform="scale(0.707)" xlink:href="#E6-MJMAIN-AF" x="1377" y="0"></use></g></g></svg></span><script type="math/tex">\overline{\text{CS}}</script><span>必须保持到数据稳定输出，t</span><sub><span>co</span></sub><span>为片选的保持时间，在读周期中 </span><span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.084ex" height="2.811ex" viewBox="0 -1107.7 1758.5 1210.2" role="img" focusable="false" style="vertical-align: -0.238ex;"><defs><path stroke-width="0" id="E8-MJMAIN-57" d="M792 683Q810 680 914 680Q991 680 1003 683H1009V637H996Q931 633 915 598Q912 591 863 438T766 135T716 -17Q711 -22 694 -22Q676 -22 673 -15Q671 -13 593 231L514 477L435 234Q416 174 391 92T358 -6T341 -22H331Q314 -21 310 -15Q309 -14 208 302T104 622Q98 632 87 633Q73 637 35 637H18V683H27Q69 681 154 681Q164 681 181 681T216 681T249 682T276 683H287H298V637H285Q213 637 213 620Q213 616 289 381L364 144L427 339Q490 535 492 546Q487 560 482 578T475 602T468 618T461 628T449 633T433 636T408 637H380V683H388Q397 680 508 680Q629 680 650 683H660V637H647Q576 637 576 619L727 146Q869 580 869 600Q869 605 863 612T839 627T794 637H783V683H792Z"></path><path stroke-width="0" id="E8-MJMAIN-45" d="M128 619Q121 626 117 628T101 631T58 634H25V680H597V676Q599 670 611 560T625 444V440H585V444Q584 447 582 465Q578 500 570 526T553 571T528 601T498 619T457 629T411 633T353 634Q266 634 251 633T233 622Q233 622 233 621Q232 619 232 497V376H286Q359 378 377 385Q413 401 416 469Q416 471 416 473V493H456V213H416V233Q415 268 408 288T383 317T349 328T297 330Q290 330 286 330H232V196V114Q232 57 237 52Q243 47 289 47H340H391Q428 47 452 50T505 62T552 92T584 146Q594 172 599 200T607 247T612 270V273H652V270Q651 267 632 137T610 3V0H25V46H58Q100 47 109 49T128 61V619Z"></path><path stroke-width="0" id="E8-MJMAIN-AF" d="M69 544V590H430V544H69Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g transform="translate(24,0)"><use xlink:href="#E8-MJMAIN-57"></use><use xlink:href="#E8-MJMAIN-45" x="1028" y="0"></use></g><g transform="translate(0,498)"><use transform="scale(0.707)" xlink:href="#E8-MJMAIN-AF" x="-69" y="0"></use><g transform="translate(26.195314283001352,0) scale(4.6949888589906354,1)"><use transform="scale(0.707)" xlink:href="#E8-MJMAIN-AF"></use></g><use transform="scale(0.707)" xlink:href="#E8-MJMAIN-AF" x="1986" y="0"></use></g></g></svg></span><script type="math/tex">\overline{\text{WE}}</script><span> 是高电平，读周期（t</span><sub><span>RC</span></sub><span>）表示存储芯片两次连续读操作所间隔的时间，大于等于读出时间。</span></p><p><span>要实现写操作，片选信号</span><span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.083ex" height="2.811ex" viewBox="0 -1107.7 1327.5 1210.2" role="img" focusable="false" style="vertical-align: -0.238ex;"><defs><path stroke-width="0" id="E6-MJMAIN-43" d="M56 342Q56 428 89 500T174 615T283 681T391 705Q394 705 400 705T408 704Q499 704 569 636L582 624L612 663Q639 700 643 704Q644 704 647 704T653 705H657Q660 705 666 699V419L660 413H626Q620 419 619 430Q610 512 571 572T476 651Q457 658 426 658Q322 658 252 588Q173 509 173 342Q173 221 211 151Q232 111 263 84T328 45T384 29T428 24Q517 24 571 93T626 244Q626 251 632 257H660L666 251V236Q661 133 590 56T403 -21Q262 -21 159 83T56 342Z"></path><path stroke-width="0" id="E6-MJMAIN-53" d="M55 507Q55 590 112 647T243 704H257Q342 704 405 641L426 672Q431 679 436 687T446 700L449 704Q450 704 453 704T459 705H463Q466 705 472 699V462L466 456H448Q437 456 435 459T430 479Q413 605 329 646Q292 662 254 662Q201 662 168 626T135 542Q135 508 152 480T200 435Q210 431 286 412T370 389Q427 367 463 314T500 191Q500 110 448 45T301 -21Q245 -21 201 -4T140 27L122 41Q118 36 107 21T87 -7T78 -21Q76 -22 68 -22H64Q61 -22 55 -16V101Q55 220 56 222Q58 227 76 227H89Q95 221 95 214Q95 182 105 151T139 90T205 42T305 24Q352 24 386 62T420 155Q420 198 398 233T340 281Q284 295 266 300Q261 301 239 306T206 314T174 325T141 343T112 367T85 402Q55 451 55 507Z"></path><path stroke-width="0" id="E6-MJMAIN-AF" d="M69 544V590H430V544H69Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g transform="translate(24,0)"><use xlink:href="#E6-MJMAIN-43"></use><use xlink:href="#E6-MJMAIN-53" x="722" y="0"></use></g><g transform="translate(0,520)"><use transform="scale(0.707)" xlink:href="#E6-MJMAIN-AF" x="-69" y="0"></use><g transform="translate(108.5748156680429,0) scale(3.006551060146303,1)"><use transform="scale(0.707)" xlink:href="#E6-MJMAIN-AF"></use></g><use transform="scale(0.707)" xlink:href="#E6-MJMAIN-AF" x="1377" y="0"></use></g></g></svg></span><script type="math/tex">\overline{\text{CS}}</script><span>和 </span><span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.084ex" height="2.811ex" viewBox="0 -1107.7 1758.5 1210.2" role="img" focusable="false" style="vertical-align: -0.238ex;"><defs><path stroke-width="0" id="E8-MJMAIN-57" d="M792 683Q810 680 914 680Q991 680 1003 683H1009V637H996Q931 633 915 598Q912 591 863 438T766 135T716 -17Q711 -22 694 -22Q676 -22 673 -15Q671 -13 593 231L514 477L435 234Q416 174 391 92T358 -6T341 -22H331Q314 -21 310 -15Q309 -14 208 302T104 622Q98 632 87 633Q73 637 35 637H18V683H27Q69 681 154 681Q164 681 181 681T216 681T249 682T276 683H287H298V637H285Q213 637 213 620Q213 616 289 381L364 144L427 339Q490 535 492 546Q487 560 482 578T475 602T468 618T461 628T449 633T433 636T408 637H380V683H388Q397 680 508 680Q629 680 650 683H660V637H647Q576 637 576 619L727 146Q869 580 869 600Q869 605 863 612T839 627T794 637H783V683H792Z"></path><path stroke-width="0" id="E8-MJMAIN-45" d="M128 619Q121 626 117 628T101 631T58 634H25V680H597V676Q599 670 611 560T625 444V440H585V444Q584 447 582 465Q578 500 570 526T553 571T528 601T498 619T457 629T411 633T353 634Q266 634 251 633T233 622Q233 622 233 621Q232 619 232 497V376H286Q359 378 377 385Q413 401 416 469Q416 471 416 473V493H456V213H416V233Q415 268 408 288T383 317T349 328T297 330Q290 330 286 330H232V196V114Q232 57 237 52Q243 47 289 47H340H391Q428 47 452 50T505 62T552 92T584 146Q594 172 599 200T607 247T612 270V273H652V270Q651 267 632 137T610 3V0H25V46H58Q100 47 109 49T128 61V619Z"></path><path stroke-width="0" id="E8-MJMAIN-AF" d="M69 544V590H430V544H69Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g transform="translate(24,0)"><use xlink:href="#E8-MJMAIN-57"></use><use xlink:href="#E8-MJMAIN-45" x="1028" y="0"></use></g><g transform="translate(0,498)"><use transform="scale(0.707)" xlink:href="#E8-MJMAIN-AF" x="-69" y="0"></use><g transform="translate(26.195314283001352,0) scale(4.6949888589906354,1)"><use transform="scale(0.707)" xlink:href="#E8-MJMAIN-AF"></use></g><use transform="scale(0.707)" xlink:href="#E8-MJMAIN-AF" x="1986" y="0"></use></g></g></svg></span><script type="math/tex">\overline{\text{WE}}</script><span> 都必须是低电平，相与的宽度至少为 t</span><sub><span>w</span></sub><span>，为了保证地址变化时不会错误写入，</span><span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.084ex" height="2.811ex" viewBox="0 -1107.7 1758.5 1210.2" role="img" focusable="false" style="vertical-align: -0.238ex;"><defs><path stroke-width="0" id="E8-MJMAIN-57" d="M792 683Q810 680 914 680Q991 680 1003 683H1009V637H996Q931 633 915 598Q912 591 863 438T766 135T716 -17Q711 -22 694 -22Q676 -22 673 -15Q671 -13 593 231L514 477L435 234Q416 174 391 92T358 -6T341 -22H331Q314 -21 310 -15Q309 -14 208 302T104 622Q98 632 87 633Q73 637 35 637H18V683H27Q69 681 154 681Q164 681 181 681T216 681T249 682T276 683H287H298V637H285Q213 637 213 620Q213 616 289 381L364 144L427 339Q490 535 492 546Q487 560 482 578T475 602T468 618T461 628T449 633T433 636T408 637H380V683H388Q397 680 508 680Q629 680 650 683H660V637H647Q576 637 576 619L727 146Q869 580 869 600Q869 605 863 612T839 627T794 637H783V683H792Z"></path><path stroke-width="0" id="E8-MJMAIN-45" d="M128 619Q121 626 117 628T101 631T58 634H25V680H597V676Q599 670 611 560T625 444V440H585V444Q584 447 582 465Q578 500 570 526T553 571T528 601T498 619T457 629T411 633T353 634Q266 634 251 633T233 622Q233 622 233 621Q232 619 232 497V376H286Q359 378 377 385Q413 401 416 469Q416 471 416 473V493H456V213H416V233Q415 268 408 288T383 317T349 328T297 330Q290 330 286 330H232V196V114Q232 57 237 52Q243 47 289 47H340H391Q428 47 452 50T505 62T552 92T584 146Q594 172 599 200T607 247T612 270V273H652V270Q651 267 632 137T610 3V0H25V46H58Q100 47 109 49T128 61V619Z"></path><path stroke-width="0" id="E8-MJMAIN-AF" d="M69 544V590H430V544H69Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g transform="translate(24,0)"><use xlink:href="#E8-MJMAIN-57"></use><use xlink:href="#E8-MJMAIN-45" x="1028" y="0"></use></g><g transform="translate(0,498)"><use transform="scale(0.707)" xlink:href="#E8-MJMAIN-AF" x="-69" y="0"></use><g transform="translate(26.195314283001352,0) scale(4.6949888589906354,1)"><use transform="scale(0.707)" xlink:href="#E8-MJMAIN-AF"></use></g><use transform="scale(0.707)" xlink:href="#E8-MJMAIN-AF" x="1986" y="0"></use></g></g></svg></span><script type="math/tex">\overline{\text{WE}}</script><span>在地质变化期间是高电平，地址有效时间至少是 t</span><sub><span>wc</span></sub><span>=t</span><sub><span>AW</span></sub><span>+t</span><sub><span>w</span></sub><span>+t</span><sub><span>WR</span></sub><span>。</span></p><h3><a name="3只读存储器rom）" class="md-header-anchor"></a><span>3.只读存储器（ROM）</span></h3><p><span>特点：结构简单，位密度高于可读写存储器；非易失性，可靠性高；</span></p><p><span>类型：</span></p><ol start='' ><li><span>MROM掩模式只读存储器：写入后无法改变内容，可靠性高价格便宜，灵活性差</span></li><li><span>PROM一次可编程只读存储器：用户可以使用编程器写入程序，写入后无法改变</span></li><li><span>EPROM可擦除可编程只读存储器：分为紫外线UVEPROM和电擦除E</span><sup><span>2</span></sup><span>PROM两种，编程次数有限，且写入时间长，所以无法取代RAM。</span></li><li><span>FLASH闪速存储器：EEPROM的基础上发展来，不加电长期保存信息，在线快速擦除重写，兼有EPROM价格便宜集成度高和E</span><sup><span>2</span></sup><span>PROM的电可擦除重写的特点，重写速度快。</span></li><li><span>SSD固态硬盘：用Flash阵列组成的硬盘，由控制芯片和Flash存储单元组成，相比HDD读写速度快功耗低，但贵。</span></li></ol><p><span>组成：存储矩阵（存储体）是核心，另外还有地址寄存器、地址译码器、读写控制电路等。地址线和MAR宽度相同，数据线和MDR宽度相同。</span></p><h2><a name="四主存储器与cpu的连接" class="md-header-anchor"></a><span>(四)主存储器与CPU的连接</span></h2><h4><a name="连接原理" class="md-header-anchor"></a><span>连接原理</span></h4><ul><li><span>主存通过数据总线、地址总线、控制总线与CPU连接</span></li><li><span>数据总线的位数与工作频率的乘积正比于数据传输率</span></li><li><span>地址总线的位数决定可寻址的最大内存空间</span></li><li><span>控制总线（读/写）指出总线周期的类型和本次I/O操作完成的时刻。</span></li></ul><h4><a name="容量扩展" class="md-header-anchor"></a><span>容量扩展</span></h4><ol start='' ><li><span>位扩展：位扩展指用多个存储器件增加存储字长，每个存储器件的地址线、读写信号线、片选信号线并联，数据线则一一对应。</span></li><li><span>字扩展：增加存储器中字的个数，而位数不变，各个存储芯片的地址线、数据线、读写控制线相应并联，片选信号来区别芯片的地址范围。</span></li><li><span>字位同时扩展：同时增加位和字长，地址线连接相同，数据线和片选信号连接不同。</span></li></ol><h4><a name="地址分配和片选" class="md-header-anchor"></a><span>地址分配和片选</span></h4><p><span>CPU对存储单元的访问，首先需要片选选中存储芯片，而后字选选择相应存储单元，字选由低位地址线，片选信号则分为线选法和译码片选法。</span></p><p><span>线选法：用除低位地址线外的高位地址线直接（或经过反相器）分别连接到每个芯片的片选端，片选地址线每次寻址时只能有一位有效，才能保证每次只选中一个芯片（或芯片组）如三根线只能控制3块芯片，优点是不需要地址译码器，线路简单，缺点是地址空间不连续，选片的地址线必须分时位低电平，不能充分利用系统存储器空间，造成地址资源浪费。</span></p><p><span>译码片选法：用高位地址线通过译码器芯片产生片选信号，如3根地址线可以选择8片芯片。</span></p><h4><a name="存储器和cpu的连接" class="md-header-anchor"></a><span>存储器和CPU的连接</span></h4><ol start='' ><li><span>合理选择存储芯片（ROM还是RAM等，尽量连线简单方便）</span></li><li><span>地址线的连接，CPU一般比存储芯片的地址线多，CPU低位地址线连接存储芯片地址线来实现字选，而CPU高位地址线用来扩充存储芯片进行片选使用，一般外界译码器逻辑完成。</span></li><li><span>数据线的连接，芯片和CPU数据线数相等时可以直接连接，不等时需要对存储芯片位扩展，使数量相等。</span></li><li><span>读写命令线：一般直接连接，高读低写，或者分开两条线，低电平有效。</span></li><li><span>片选线的连接：一般与CPU的访存控制信号MREQ（低电平有效）有关。</span></li></ol><p>&nbsp;</p><h2><a name="五双口ram和多模块存储器" class="md-header-anchor"></a><span>(五)双口RAM和多模块存储器</span></h2><p><span>双端口RAM：一个存储器有左右两个独立端口，有两组独立地址线数据线和控制线，允许两个独立控制器异步访问存储单元，在空间上并行；地址不相同时一定不发生冲突。</span></p><p><span>地址相同时可能发生冲突，有4种情况：</span></p><ol start='' ><li><span>两个端口不同时对同一单元存取数据：无事</span></li><li><span>两个端口同时读出：无事</span></li><li><span>两个端口同时写入：写入错误</span></li><li><span>两个端口一个读一个写：读出错误</span></li></ol><p><span>解决方法：置忙信号 </span><span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.535ex" height="2.811ex" viewBox="0 -1107.7 2813.5 1210.2" role="img" focusable="false" style="vertical-align: -0.238ex;"><defs><path stroke-width="0" id="E9-MJMAIN-42" d="M131 622Q124 629 120 631T104 634T61 637H28V683H229H267H346Q423 683 459 678T531 651Q574 627 599 590T624 512Q624 461 583 419T476 360L466 357Q539 348 595 302T651 187Q651 119 600 67T469 3Q456 1 242 0H28V46H61Q103 47 112 49T131 61V622ZM511 513Q511 560 485 594T416 636Q415 636 403 636T371 636T333 637Q266 637 251 636T232 628Q229 624 229 499V374H312L396 375L406 377Q410 378 417 380T442 393T474 417T499 456T511 513ZM537 188Q537 239 509 282T430 336L329 337H229V200V116Q229 57 234 52Q240 47 334 47H383Q425 47 443 53Q486 67 511 104T537 188Z"></path><path stroke-width="0" id="E9-MJMAIN-55" d="M128 622Q121 629 117 631T101 634T58 637H25V683H36Q57 680 180 680Q315 680 324 683H335V637H302Q262 636 251 634T233 622L232 418V291Q232 189 240 145T280 67Q325 24 389 24Q454 24 506 64T571 183Q575 206 575 410V598Q569 608 565 613T541 627T489 637H472V683H481Q496 680 598 680T715 683H724V637H707Q634 633 622 598L621 399Q620 194 617 180Q617 179 615 171Q595 83 531 31T389 -22Q304 -22 226 33T130 192Q129 201 128 412V622Z"></path><path stroke-width="0" id="E9-MJMAIN-53" d="M55 507Q55 590 112 647T243 704H257Q342 704 405 641L426 672Q431 679 436 687T446 700L449 704Q450 704 453 704T459 705H463Q466 705 472 699V462L466 456H448Q437 456 435 459T430 479Q413 605 329 646Q292 662 254 662Q201 662 168 626T135 542Q135 508 152 480T200 435Q210 431 286 412T370 389Q427 367 463 314T500 191Q500 110 448 45T301 -21Q245 -21 201 -4T140 27L122 41Q118 36 107 21T87 -7T78 -21Q76 -22 68 -22H64Q61 -22 55 -16V101Q55 220 56 222Q58 227 76 227H89Q95 221 95 214Q95 182 105 151T139 90T205 42T305 24Q352 24 386 62T420 155Q420 198 398 233T340 281Q284 295 266 300Q261 301 239 306T206 314T174 325T141 343T112 367T85 402Q55 451 55 507Z"></path><path stroke-width="0" id="E9-MJMAIN-59" d="M518 0Q497 3 374 3Q253 3 232 0H221V46H254Q313 47 321 58Q324 62 324 167V273L221 446Q117 620 114 623Q106 631 91 634T31 637H11V683H20Q29 680 148 680Q273 680 294 683H305V637H287Q239 636 236 621Q236 619 321 475L407 332L483 460Q502 492 527 534Q563 594 563 604Q563 632 517 637H508V683H517H525Q533 683 545 683T571 682T600 681T626 681Q695 681 731 683H738V637H723Q640 633 613 588Q612 587 517 427L425 273V169V95Q425 66 428 59T444 49Q459 46 506 46H528V0H518Z"></path><path stroke-width="0" id="E9-MJMAIN-AF" d="M69 544V590H430V544H69Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g transform="translate(24,0)"><use xlink:href="#E9-MJMAIN-42"></use><use xlink:href="#E9-MJMAIN-55" x="708" y="0"></use><use xlink:href="#E9-MJMAIN-53" x="1458" y="0"></use><use xlink:href="#E9-MJMAIN-59" x="2014" y="0"></use></g><g transform="translate(0,520)"><use transform="scale(0.707)" xlink:href="#E9-MJMAIN-AF" x="-69" y="0"></use><g transform="translate(-175.45288516298206,0) scale(8.827939851521426,1)"><use transform="scale(0.707)" xlink:href="#E9-MJMAIN-AF"></use></g><use transform="scale(0.707)" xlink:href="#E9-MJMAIN-AF" x="3478" y="0"></use></g></g></svg></span><script type="math/tex">\overline{\text{BUSY}}</script><span> 为0，由判断逻辑决定暂时关闭一个端口（延时）</span></p><p><span>多模块存储器：在时间上并行；常用的有单体多姿存储器和多体低位交叉存储器，因为CPU的速度比存储器快，所以同时从存储器中取出多条指令就可以充分利用CPU资源提高运行速度。</span></p><p><span>单体多字存储器：存储器中只有一个存储体，每个存储单元存m个字，一次并行读出m个字，地址必须顺序排列并处于同一存储单元。这显然增大了存储器的带宽，提高了工作速度，缺点是指令和数据必须是顺序存放的，如果转移指令或操作数不连续时，效果不明显。</span></p><p><span>多体并行存储器：由多体模块组成，每个模块有相同的容量和存取速度，各模块有独立的读写控制电路、地址寄存器、数据寄存器，可以并行或交叉工作。又可以分为高位交叉编址（顺序方式）和低位交叉编址（交叉方式）两种。</span></p><p><span>高位交叉编址方式下，地址是连续的，存取方式仍是串行存取，是顺序存储器。把低位的体内地址送到高位体号确定的模块中译码，访问一个连续主存块时，总是先在一个模块内访问，完了到下一个模块，不能并行访问，不能提高吞吐率。</span></p><p><span>低位交叉编制方式下，高位的体内地址送到低位体号的模块内译码，程序连续存放在相邻模块中，是交叉存储器。可以采用流水线的方式并行存取，提高带宽</span></p><p><span>设模块字长等于数据总线宽度，模块存取一个字的周期为T，总线传送周期为r，为实现流水线方式存取，交叉的模块数应该大于等于m=T/r，m称为交叉存取度，每经过r时间延迟后启动下一模块，连续存取m个字的时间为t</span><sub><span>1</span></sub><span>=T+(m-1)r，而顺序读取则需要mT，可见带宽大大提高。</span></p><p>&nbsp;</p><h2><a name="六高速缓冲存储器cache" class="md-header-anchor"></a><span>(六)高速缓冲存储器(Cache)</span></h2><h3><a name="1cache的基本工作原理和局部性原理" class="md-header-anchor"></a><span>1.Cache的基本工作原理和局部性原理</span></h3><p><span>程序访问的局部性原理包括空间局部性和时间局部性，时间局部性指未来要用到的信息很可能是现在正在使用的信息，空间局部性是指未来要用的信息很可能与现在正在使用的信息在空间上是邻近的，因为指令通常是顺序存放、顺序执行的，数据一般也是以向量、数组等形式簇聚地存储在一起的。高速缓冲就利用这一原理，将部分内容存放在高速、容量小的Cache中，使CPU大部分访存操作都针对Cache进行。</span></p><h4><a name="基本工作原理" class="md-header-anchor"></a><span>基本工作原理：</span></h4><p><span>Cache位于存储器层次结构顶层，通常由SRAM构成，一般Cache的块和主存块大小相等，称为Cache的行。一般Cache的行数远小于主存的块数，进保存最活跃的若干块的副本，一般通过预测将一部分块装入Cache行。</span></p><p><span>CPU发出读请求时，若地址在Cache中则命中，将地址转换成Cache地址，直接对Cache进行读操作。若不命中，则需要访问主存，将字所在的块一次性从主存中调入Cache。若Cache已满，则需要用替换算法实现。Cache和CPU之间交换数据以字为单位，而Cache与主存间交换数据以块为单位。（某些计算机也使用同时访问Cache和主存的方式，如果命中，则终止主存访问，否则访问主存并替换Cache）</span></p><p><span>CPU需要访问的信息在Cache中的概率称为命中率H，命中率越接近1越好，Cache-主存系统平均访问时间T</span><sub><span>a</span></sub><span>=H·t</span><sub><span>c</span></sub><span>+（1-H)·t</span><sub><span>m</span></sub><span>。</span></p><h3><a name="2cache和主存之间的映射方式" class="md-header-anchor"></a><span>2.Cache和主存之间的映射方式</span></h3><p><span>Cache行中的信息是主存中某个块的副本，地址映射是指将主存地址空间映射到Cache地址空间，即把主存中的信息按照某种规则装入Cache。因为Cache行数较少，所以Cache中要加一个标记指明是哪一块的副本，标记内容相当于主存的块号，为了说明Cache行中的信息是否有效，还需要一个有效位。地址变换是CPU在访存时，将主存地址按照映射规则换算成Cache地址的过程，而不等同于地址映射本身。映射有三种策略：</span></p><ol start='' ><li><span>直接映射：主存中的每一块只能装入Cache的唯一位置，若这个位置已有内容，则产生块冲突，原来的块将被无条件替换（而无需替换算法）。直接映射简单，但不够灵活，块冲突的改良也最高，空间利用率最低。映射关系一般为：j=i %2</span><sup><span>c</span></sup><span>。j是行号，i是块号，c是Cache总行数，映射可以看出，主存块的低c位刚好是要装入的Cache行号，所以标记为t=m-c，主存地址位数-Cache行地址位数。地址结构为 ：| 标记 | Cache行号 | 块内地址 |。CPU访存时，根据地址的c位找到Cache行，比较t和主存地址高t位，若相同且有效位是1，则命中，否则不命中，读出该地址所在块放入Cache行中，将有效位置1并更新t。</span></li><li><span>全相联映射：主存中的每一块可以装入Cache的任意位置，每行的标记指出取自主存的那一块，CPU访存时需要与所有Cache行的标记进行比较，优点是灵活、冲突概率低、空间利用率高、命中率高，缺点是比较标记速度慢，实现成本高，一般需要用昂贵的按内容寻址的相联存储器进行地址映射，地址结构是：| 标记 |块内地址|。</span></li><li><span>组相联映射：折中，组内全相联，组间直接映射。每组Cache行的数量越大，发生冲突的概率越低，越接近于全相联的性能，选用适当的数量，则成本接近于直接映射。映射关系为：j=i % Q，Q是组数。地址结构为：|标记| 组号 | 块内地址 |。CPU访存过程如下：首先根据组号找到对应的Cache组，将对应组中的每个行的标记与主存地址高位标记进行比较，若有相等且有效位为1，则命中，若不命中则从主存中读出该地址所在块并送到对应Cache组中任意一个空闲位置，并将有效位设为1，置标记并将内容送入CPU。</span></li></ol><h3><a name="3cache中主存块的替换算法" class="md-header-anchor"></a><span>3.Cache中主存块的替换算法</span></h3><p><span>全相联或组相连时才需要替换算法，常用算法如下：</span></p><ol start='' ><li><span>随机算法：随机确定替换的行，实现简单，但未根据局部性原理，可能命中率低。</span></li><li><span>FIFO先进先出算法：容易实现，但也未根据局部性原理，因为最早进的也可能是目前最常用的。</span></li><li><span>LRU近期最少使用（least recently used）：根据局部性原理，平均命中率高于FIFO，是堆栈类算法。对每个行设置一个计数器，用计数值记录主存块的使用情况，并根据计数值决定淘汰那个块，计数值的位数和Cache的组大小相关，2路1位，4路2位……，计数规则，命中时计数值清零，比他低的计数器加一，其他不变，未命中且还有空行时，新装入的行置0，其余全加1，未命中且五空闲行时，计数值最大的行被淘汰，新装入置0，其余加1.</span></li></ol><p>&nbsp;</p><h3><a name="4cache写策略" class="md-header-anchor"></a><span>4.Cache写策略</span></h3><p><span>如果对于Cache写命中（write hit）,有两种解决方法：</span></p><ol start='' ><li><span>全写法（写直通法、write-through)即写命中时同时写入Cache和主存，替换时则不必写回，优点是实现简单，缺点是增加访存次数，降低了Cache效率，改进是增加一个写缓存（write buffer）但是缓存也可能饱和溢出。</span></li><li><span>写回法（write-back）Cache命中时，只修改Cache内容，只有在被换出的时候才写回主存，可能存在数据不一致的隐患，所以需要设置一个标志位（脏位），反映是否经过修改。</span></li></ol><p><span>对于Cache写不命中，也有两种处理方法：</span></p><ol start='' ><li><span>写分配法：加载块到Cache，然后更新Cache块，试图利用程序空间局部性，但是每次不命中都需要从主存中读取一块，一般和写回法合用。</span></li><li><span>非写分配法：只写入主存，不进行调块。一般和全写法合用。</span></li></ol><p><span>而对于多级（如两级）Cache，L1_Cache对于L2_Cache使用全写法，而L2_Cache对主存使用写回法，由于多级缓存速度大于主存，避免了写缓冲饱和溢出和多次访存带来的效率降低。</span></p><p>&nbsp;</p><h2><a name="七虚拟存储器" class="md-header-anchor"></a><span>(七)虚拟存储器</span></h2><h3><a name="1虚拟存储器的基本概念" class="md-header-anchor"></a><span>1.虚拟存储器的基本概念</span></h3><p><span>虚拟存储器将主存或辅存的地址空间统一编址，形成一个庞大的地址空间，称为虚拟空间或程序空间，地址称为虚地址或逻辑地址；而实际的主存单元地址称为实地址或物理地址，对应实地址空间。虚拟存储器具有主存的速度和辅存的容量，提高了性价比，对于应用程序员透明。</span></p><p><span>CPU使用虚地址时，由辅助硬件找出虚地址和实地址之间的对应关系，并判断对应存储单元是否已经装入主存，并进行相应操作。实际上，程序和数据在操作系统管理下，先存入磁盘，而后操作系统将当前运行所需要的部分调入主存，供CPU使用，其余留在磁盘中。</span></p><h4><a name="虚拟存储和cache比较" class="md-header-anchor"></a><span>虚拟存储和Cache比较</span></h4><p><span>相同：</span>1️⃣<span>最终目标都是提高系统性能，都有容量、速度、价格的梯度</span>2️⃣<span>都把信息划成小块，作为基本传递单位</span>3️⃣<span>都有地址映射、替换算法、更新策略等问题</span>4️⃣<span>都依据程序局部性原理应用了快速缓存的思想。</span></p><p><span>不同：</span>1️⃣<span>C​a​ch​e​主要​解决​系统速度，虚存则是为了解决主存容量，</span>2️⃣<span>Cache全由硬件组成，对所有程序员透明，而虚存则由OS和硬件共同实现，是逻辑上的存储器，对系统程序员不透明，对应用程序员透明 ，</span>3️⃣<span> CPU速度是Cache的10倍，而主存速度为硬盘的100倍，所以虚存不命中对于系统性能影响更大，</span>4️⃣<span> CPU和Cache和主存之间都建立了直接访问的通路，Cache不命中时，CPU可以和主存直接通信，同时将数据调入Cache，而虚存不命中时，只能由硬盘通过DMA调入主存，而不能直接和CPU通信。</span></p><h3><a name="2页式虚拟存储器" class="md-header-anchor"></a><span>2.页式虚拟存储器</span></h3><p><span>以页为基本单位，主存的页称为实页，虚存的页称为虚页，虚拟地址分为两个字段，虚页号和页内地址，由页表实现虚拟地址到物理地址的转换。页表中包含有效位（是否装入主存），脏位（页面是否修改），引用位（使用位，配合替换策略使用），每个进程都有一个页表基址寄存器，放入页表首地址，根据虚拟地址高位的虚拟页号找到对应页表项，装入位为0说明缺页，需要操作系统调用缺页异常处理程序。页式的优点时页面长度固定，页表简单，装入方便，缺点是由于程序不可能是整数倍，最后一页会产生页内碎片，页也不是逻辑上独立的实体，对于处理、保护、共享都不如段式虚拟存储方便。</span></p><h3><a name="3段式虚拟存储器" class="md-header-anchor"></a><span>3.段式虚拟存储器</span></h3><p><span>段式虚拟存储的段按照程序的逻辑结构划分，长度各异，所以段表给出各段的起始地址以及段的长度，段表是程序逻辑段在主存中存放位置的对照表，每行记录某段对应的段号、装入位、起点、段长等信息。虚拟地址划为两部分，段号和段内地址（偏移量）。CPU根据虚拟地址访存时，首先根据段号和段表基地址拼接成段表行，然后根据装入位判断是否装入主存，装入后，从段表读出起始地址和偏移量，相加可以的得到对应的主存实地址。优点是段的分界和程序自然分界相对应，具有逻辑独立性，易于编译、管理、修改、保护和多道程序的共享，缺点则是因为段长度可变，分配空间麻烦，容易在段间留下碎片，使主存空间利用率相对较低。</span></p><h3><a name="4段页式虚拟存储器" class="md-header-anchor"></a><span>4.段页式虚拟存储器</span></h3><p><span>程序按照逻辑结构分段，每段再划分为大小固定的页，装入主存大小相等的页框中，程序对于主存的调入调出以页为基本传送单位，每一个程序对应一个段表，每一段对应一个页表，段的长度必须是页长的整数倍，段的起点必须是某一页的起点。虚地址分为段号、段内页号、页内地址三部分，优点是兼具页式和段式的优点，可以按段实现共享和保护，缺点是地址变换过程中可能需要两次查表，系统开销大。</span></p><h3><a name="5tlb快表" class="md-header-anchor"></a><span>5.TLB(快表)</span></h3><p><span>采用虚拟存储机制后，访问主存的次数变多了，而根据程序的局部性原理，我们可以将近期经常访问的页表项存入高速缓冲器组成的快表（TLB）中，加快地址转换。快表通常采用全相联或组相连方式，每个TLB表项由页表项内容加一个TLB标记字段组成，TLB标记表明该表象取自页表中的哪个页表项，在全相联下，TLB标记就是页表项对应的虚页号，组相联下就是对应虚页号的高位部分，地位部分用于选择TLB组的组索引。</span></p><p><span>在一个具有Cache、TLB、虚存的系统中，系统一次访存可能产生三种却是情况：</span>1️⃣<span>T​LB缺失，对应页表项不在TLB中，</span>2️⃣<span>Cache缺失，主存块不在Cache中 </span>3️⃣<span>缺页故障，要访问的页不在主存中。最好是三者都命中，无需访问主存；TLB或Cache缺失都需要一次访存，而两者都缺失需要两次访存；缺页异常则需要访问磁盘，并且至少访问两次主存。Cache缺失由硬件完成，缺页由软件完成，即缺页异常处理程序，TLB软硬在逻辑上等效，操作系统一般有“TLB缺失异常处理”程序。</span></p><figure><table><thead><tr><th><span>TLB</span></th><th><span>Cache</span></th><th><span>page</span></th><th><span>情况</span></th></tr></thead><tbody><tr><td><span>命中</span></td><td><span>命中</span></td><td><span>命中</span></td><td><span>最佳情况</span></td></tr><tr><td><span>缺失</span></td><td><span>缺失</span></td><td><span>缺失</span></td><td><span>信息不在主存，至少访问磁盘和两次主存</span></td></tr><tr><td><span>缺失</span></td><td><span>命中</span></td><td><span>命中</span></td><td><span>信息在Cache中，但页表项不在TLB，需要访存一次</span></td></tr><tr><td><span>命中</span></td><td><span>缺失</span></td><td><span>命中</span></td><td><span>信息在主存不在Cache，访存一次</span></td></tr><tr><td><span>缺失</span></td><td><span>缺失</span></td><td><span>命中</span></td><td><span>信息在主存不在Cache，页表项不在TLB，至少两次访存</span></td></tr><tr><td><span>任意</span></td><td><span>命中</span></td><td><span>缺失</span></td><td><span>不可能，信息都不在主存，必不可能在Cache。</span></td></tr></tbody></table></figure><p>&nbsp;</p><h1><a name="四指令系统" class="md-header-anchor"></a><span>四、指令系统</span></h1><h2><a name="一指令格式" class="md-header-anchor"></a><span>(一)指令格式</span></h2><p><span>指令（机器指令）是指示计算机执行某种操作的命令，是计算机运行的最小功能单位，一台计算机所有指令的集合构成指令系统（指令集），指令系统是计算机的主要属性，位于软硬件的交界面上。</span></p><h3><a name="1指令的基本格式" class="md-header-anchor"></a><span>1.指令的基本格式</span></h3><p><span>一条指令就是机器语言的一个语句，一组有意义的二进制代码，通常包括操作码字段和地址码字段。指令长度是二进制位数，指令字长取决于操作码长度、地址个数和地址长度，与机器字长没有固定关系，一个机器字长的叫单字长指令，还有半字长指令双字长指令，所有指令长度相等为定长指令字结构，定长执行速度快控制简单，否则为变长。</span></p><p><span>根据地址可以分类如下</span></p><ol start='' ><li><p><span>零地址指令：只有操作码OP，有两种可能，不需要操作数，如空指令、停机、关中断；或是堆栈计算机种的运算指令，两个操作数隐含地从栈顶和次栈顶弹出运算，结果隐含地压入堆栈。</span></p></li><li><p><span>一地址指令：两种常见形态</span></p><ol start='' ><li><span>只有目的操作数的单操作数指令，按A</span><sub><span>1</span></sub><span>地址读取操作数，操作后结果返回源地址；含义：OP（A</span><sub><span>1</span></sub><span>）--&gt;A</span><sub><span>1</span></sub><span>，操作码常是+1、-1、求反、求补</span></li><li><span>隐含约定目的地址的双操作数指令，按A</span><sub><span>1</span></sub><span>地址读取操作数，隐含约定另一个操作数由ACC提供，运算结果也存在ACC中；含义：(ACC)OP(A</span><sub><span>1</span></sub><span>)--&gt;(ACC)，若指令字长32位操作码8位，则直接寻址范围是2</span><sup><span>24</span></sup><span>=16M.</span></li></ol></li><li><p><span>二地址指令：含义(A</span><sub><span>1</span></sub><span>)OP(A</span><sub><span>2</span></sub><span>)--&gt;A1;对于常用的算数和逻辑运算往往需要两个操作数，给出目的操作数和源操作数的地址，目的操作数同时用来保存本次运算的结果。若指令32位，操作8位，直接寻址范围是2</span><sup><span>12</span></sup><span>=4K。</span></p></li><li><p><span>三地址指令：含义：(A</span><sub><span>1</span></sub><span>)OP(A</span><sub><span>2</span></sub><span>)--&gt;A</span><sub><span>3</span></sub><span>，完成一条三地址指令需要四次访问存储器（取址1，取操作数2，存结果1），若32位指令字长，则直接寻址范围是2</span><sup><span>8</span></sup><span>=256。</span></p></li><li><p><span>四地址指令：含义：(A</span><sub><span>1</span></sub><span>)OP(A</span><sub><span>2</span></sub><span>)--&gt;A</span><sub><span>3</span></sub><span>；A</span><sub><span>4</span></sub><span>--&gt;PC；A</span><sub><span>4</span></sub><span>是下一条指令地址，直接寻址范围是2</span><sup><span>6</span></sup><span>=64。</span></p></li></ol><h3><a name="2定长操作码指令格式" class="md-header-anchor"></a><span>2.定长操作码指令格式</span></h3><p><span>在指令的最高位部分分配固定的若干位表示操作码，n位操作码指令系统可以表示2</span><sup><span>n</span></sup><span>条指令。定长有利于简化硬件设计，提高指令译码和识别速度，是32位或更长的计算机字长的常规用法。</span></p><h3><a name="3扩展操作码指令格式" class="md-header-anchor"></a><span>3.扩展操作码指令格式</span></h3><p><span>为了在字长有限的前提下保持丰富的指令种类，可以使用变长操作码，其中最常见的是扩展操作码，操作码的长度随着地址码的减少而增加。如15条三地址、15条2地址、15条一地址、16条零地址；或15，12，63，16。</span></p><p><span>保证短码不是长码的前缀，操作码不能重复。对于频繁的指令分配短的操作码，尽可能减少指令译码和分析的时间。</span></p><h4><a name="操作类型" class="md-header-anchor"></a><span>操作类型</span></h4><ol start='' ><li><span>数据传送：LOAD；STORE（数据传送类）</span></li><li><span>算术逻辑操作：加减乘除、自增自减、求补、浮点运算；逻辑与或非、异或、位操作、位测试（运算类）</span></li><li><span>移位操作：（运算类）</span></li><li><span>转移操作：无条件JMP；有条件转移；调用和返回CALL、RETURN；陷阱指令（Trap）（程序控制类）</span></li><li><span>I/O操作：CPU寄存器与IO端口间的数据传送。（I/O类）</span></li></ol><h2><a name="二指令的寻址方式" class="md-header-anchor"></a><span>(二)指令的寻址方式</span></h2><h3><a name="1有效地址的概念" class="md-header-anchor"></a><span>1.有效地址的概念</span></h3><p><span>寻址方式是寻找指令或操作数有效地址的方式，分为指令寻址和数据寻址两大类，寻找下一条指令的地址即指令寻址，寻找操作数的即数据寻址。指令中的地址码字段往往不代表操作数的真实地址，这类地址称为形式地址(A)形式地址结合寻址方式，可以找出真实地址，也称为有效地址(EA)。(A)表示A的数值，A可以是寄存器编号、内存地址。</span></p><h3><a name="2数据寻址和指令寻址" class="md-header-anchor"></a><span>2.数据寻址和指令寻址</span></h3><p><span>指令寻址主要有两种方式，顺序寻址，即(PC)+1（一个指令字长），自动形成下一条指令地址。跳跃寻址，即通过程序转移指令实现，本条指令给出下条指令地址计算方式，通过当前指令指出绝对地址或相对地址（偏移量）修改PC值进行跳跃，下一条指令地址仍然通过PC给出。</span></p><p><span>数据寻址的方式较多，一般在指令字中设置一个字段，来指明寻址特征，以下寻址方式基本都是数据寻址方式。</span></p><h3><a name="3常见寻址方式" class="md-header-anchor"></a><span>3.常见寻址方式</span></h3><ol start='' ><li><span>隐含寻址：（ACC），隐式给出地址，一般默认为ACC累加器，有利于缩短指令字长，但是需要增加存储操作数或隐含地址的硬件。</span></li><li><span>立即数寻址：操作数=A，地址字段直接给出操作数A，指令执行时间最短，但是立即数范围有限。</span></li><li><span>寄存器寻址：EA=R</span><sub><span>i</span></sub><span>，操作数存在寄存器中，给出寄存器编号，只需要访问寄存器，指令字段且块，支持向量/矩阵运算，但是寄存器贵且有限。</span></li></ol><p><span>以上三种不需要访存，</span></p><hr /><ol start='4' ><li><span>直接寻址：EA=A，形式地址直接是实际地址，优点是简单，只需要一次访存，但是指令寻址范围小，操作数的地址不易修改。</span></li><li><span>间接寻址（</span><em><span>2</span></em><span>)：EA=(A)，间址可以是一次，也可以是多次，有主存字第一位指出，1表示需要继续间址，优点是扩大寻址范围，而且能够方便的完成子程序返回，缺点是多次访存，访问速度慢。所以一般扩大寻址范围多使用寄存器间接寻址。</span></li><li><span>寄存器间接寻址：EA=(R</span><sub><span>i</span></sub><span>)：指令给出寄存器编号，地址储存在寄存器中，相较间址指令字短且快，但是需要访存。</span></li></ol><p><span>以下四种是偏移寻址</span></p><hr /><ol start='7' ><li><span>相对寻址：EA=(PC)+A：地址字段给出偏移量，和PC内容相加获得绝对地址，多用于转移指令，如指令寻址。</span></li><li><span>基址寻址：EA=(BR)+A：操作系统或管理程序确定基址内容，程序执行中BR不变，面向系统，用于多道程序或为数据分配空间，可用于编制浮动程序，扩大寻址范围，但是偏移量（A的位数）较小。</span></li><li><span>变址寻址：EA=(IX)+A：面向用户，用于处理数组，循环程序，可以设置A为基地址，不断改变IX变址寄存器的内容，IX位数较大 ，偏移量足够表示整个存储空间。变址中A不变，变址寄存器的内容则由用户设定。</span></li><li><span>堆栈寻址 ：SP：堆栈是一块LIFO的存储区，根据软硬件组成不同可以分为软堆栈和硬堆栈，栈顶地址存储在SP堆栈寄存器中，也称为堆栈指针，堆栈计算机大部分指令表面上无操作数，但隐式使用了SP堆栈指针，堆栈弹出操作数或地址来完成指令，每一个读写单元都自动完成对SP的增减操作，类似于PC自动+1。</span></li></ol><h2><a name="三cisc和risc的基本概念" class="md-header-anchor"></a><span>(三)CISC和RISC的基本概念</span></h2><figure><table><thead><tr><th><span>项目</span></th><th><span>CISC</span></th><th><span>RISC</span></th></tr></thead><tbody><tr><td><span>指令系统</span></td><td><span>复杂庞大</span></td><td><span>简单精简</span></td></tr><tr><td><span>指令数</span></td><td><span>200+</span></td><td><span>100-</span></td></tr><tr><td><span>指令字长</span></td><td><span>不固定</span></td><td><span>定长</span></td></tr><tr><td><span>可访存指令</span></td><td><span>不限制</span></td><td><span>Load/Store访存</span></td></tr><tr><td><span>指令执行时间</span></td><td><span>相差很大</span></td><td><span>绝大多数一个时钟周期</span></td></tr><tr><td><span>指令执行频率</span></td><td><span>相差很大</span></td><td><span>都比较常用</span></td></tr><tr><td><span>通用寄存器数量</span></td><td><span>较少</span></td><td><span>多</span></td></tr><tr><td><span>目标代码</span></td><td><span>难以优化</span></td><td><span>采用优化编译，生成代码较为高效</span></td></tr><tr><td><span>控制方式</span></td><td><span>绝大多数由微程序控制</span></td><td><span>绝大多数为组合逻辑控制</span></td></tr><tr><td><span>指令流水线</span></td><td><span>可以通过一定方式实现</span></td><td><span>必须实现</span></td></tr><tr><td><span>兼容</span></td><td><span>大多能实现软件兼容</span></td><td><span>大多数不兼容</span></td></tr><tr><td><span>芯片面积利用</span></td><td><span>50%控制存储器</span></td><td><span>硬布线逻辑10%，通用寄存器多</span></td></tr></tbody></table></figure><p><span>RISC优点：</span></p><ol start='' ><li><span>充分利用VLSI芯片面积（10%硬布线</span></li><li><span>提高运算速度（流水线、寄存器、指令数量种类</span></li><li><span>便于设计，降低成本提高可靠性</span></li><li><span>编译程序代码优化</span></li></ol><h3><a name="x86汇编" class="md-header-anchor"></a><span>x86汇编</span></h3><p>&nbsp;</p><h1><a name="五中央处理器cpu" class="md-header-anchor"></a><span>五、中央处理器(CPU)</span></h1><h2><a name="一cpu的功能和基本结构" class="md-header-anchor"></a><span>(一)CPU的功能和基本结构</span></h2><h4><a name="功能" class="md-header-anchor"></a><span>功能：</span></h4><ol start='' ><li><span>指令控制：取指、分析、执行，即程序的顺序控制</span></li><li><span>操作控制：将指令的操作信号送到相应部件</span></li><li><span>时间控制</span></li><li><span>数据加工</span></li><li><span>中断处理</span></li></ol><p><span>运算器主要对数据进行加工，控制器要进行取指令（形成指令地址、发出取指命令），分析指令（操作码译码、产生操作数有效地址），执行指令（形成操作信号控制序列，控制运算器存储器IO等），中断处理（管理总线，处理异常情况） </span></p><h4><a name="基本结构" class="md-header-anchor"></a><span>基本结构：</span></h4><p><span>运算器：</span></p><ol start='' ><li><span>ALU，算术逻辑单元</span></li><li><span>通用寄存器组，AX、BX、CX、DX、SP，SP栈顶指针，通用寄存器和ALU的连接可以使用专用数据通路（性能高、结构复杂）、多路选择器MUX、三态门等，实际多使用CPU内部总线（可能冲突）。</span></li><li><span>暂存寄存器：暂存从主存中读到的数据，不直接放入通用寄存器避免破坏；或暂存通用寄存器到ALU的数据</span></li><li><span>ACC累加寄存器</span></li><li><span>PSW程序状态字寄存器，包括OF溢出、SF符号、ZF零、CF进位标志</span></li><li><span>移位器</span></li><li><span>CT计数器</span></li></ol><p><span>控制器：</span></p><ol start='' ><li><span>PC程序计数器</span></li><li><span>IR指令寄存器</span></li><li><span>指令译码器</span></li><li><span>存储器地址寄存器MAR</span></li><li><span>存储器数据寄存器MDR</span></li><li><span>时序系统：由统一时钟CLOCK分频得到。</span></li><li><span>微操作信号发生器：根据IR、时序、PSW产生各种控制信号。</span></li></ol><p><strong><span>用户可见的寄存器（对汇编程序员透明）：PC、PSW、ACC、通用寄存器。一定不可见：MAR、MDR、IR </span></strong></p><h2><a name="二指令执行过程" class="md-header-anchor"></a><span>(二)指令执行过程</span></h2><h4><a name="指令周期" class="md-header-anchor"></a><span>指令周期：</span></h4><p><span>CPU从主存中取出并执行一条指令的全部时间</span></p><p><span>取指周期：取出指令；执行周期：执行指令的时间</span></p><p><span>指令周期有若干个机器周期（CPU周期），机器周期包括若干时钟周期（节拍、T、CPU时钟周期，CPU最基本的单位），每个机器周期、指令周期长度可以不等。</span></p><p><span>每个节拍内可以完成一个或若干个须同时执行的操作。</span></p><p><span>空指令NOP：取指周期</span></p><p><span>加法指令ADD：取指周期和执行周期；乘法指令MUL：取指+执行，执行&gt;加法</span></p><p><span>间址寻址：取指周期+间址周期+执行周期</span></p><p><span>中断的指令：取指+间址+执行+中断</span></p><p><span>CPU内部4个标志触发器：FE、IND、EX、INT对应取指、间址、执行、中断四个周期。</span></p><h4><a name="指令周期的数据流" class="md-header-anchor"></a><span>指令周期的数据流</span></h4><ol start='' ><li><p><span>取指周期：</span></p><ol start='' ><li><span>PC--&gt;MAR--&gt;地址总线--&gt;主存</span></li><li><span>CU发出控制信号--&gt;控制总线--&gt;主存</span></li><li><span>主存M(MAR)--&gt;数据总线--&gt;MDR--&gt;IR</span></li><li><span>CU发出命令--&gt;PC+1</span></li></ol></li><li><p><span>间址周期：</span></p><ol start='' ><li><span>Ad(IR)或Ad(MDR)--&gt;MAR---&gt;地址总线---&gt;主存</span></li><li><span>CU--&gt;控制总线--&gt;主存</span></li><li><span>主存--&gt;数据总线--&gt;MDR(存放有效地址)</span></li></ol></li><li><p><span>中断周期：</span></p><ol start='' ><li><span>SP-1；SP--&gt;MAR--&gt;地址总线--&gt;主存</span></li><li><span>CU发出写命令--&gt;控制总线--&gt;主存</span></li><li><span>PC--&gt;MDR--&gt;数据总线--&gt;主存（程序断点存入主存)</span></li><li><span>CU（中断服务程序的入口地址）--&gt;PC</span></li></ol></li></ol><h4><a name="指令执行方案" class="md-header-anchor"></a><span>指令执行方案：</span></h4><ol start='' ><li><span>单指令周期：所有指令选用相同的执行时间，指令间串行执行，指令周期取决于执行时间最长的执行时间；本可以短时间完成的指令用了长周期，降低整个系统的运行速度</span></li><li><span>多指令周期：指令串行，不同指令选用不同的步骤，可使用不同的个数的时钟周期来完成；缺点是硬件结构复杂</span></li><li><span>流水线方案：指令之间并行执行，力争在每个时钟脉冲周期完成一条指令，多条指令同时运行，但处在不同的执行步骤中。</span></li></ol><h2><a name="三数据通路的功能和基本结构" class="md-header-anchor"></a><span>(三)数据通路的功能和基本结构</span></h2><p><span>数据通路：数据在功能部件之间的传送路径</span></p><p><span>数据通路部件：数据通路路径上的部件 </span></p><p><span>内部总线：CPU内部连接寄存器、运算部件之间的总线；系统总线：计算机系统的各部件，如CPU内存IO</span></p><p><span>基本结构有：CPU内部单总线（效率低、冲突多）；CPU内部三总线（提高效率）；专用数据通路（性能强，硬件量大）</span></p><ol start='' ><li><p><span>寄存器之间的数据传送：(PC)--&gt;Bus（PCout有效）Bus--&gt;MAR（MARin有效）</span></p></li><li><p><span>主存和CPU之间的数据传送：</span></p><p><span>PC--&gt;Bus--&gt;MAR（PCout和MARin有效，现行地址--&gt;MAR）；</span></p><p><span>1--&gt;R（CU发读命令）；</span></p><p><span>M(MAR)--&gt;MDR（MDRin有效）；</span></p><p><span>MDR--&gt;Bus--&gt;IR（MDRout和IRin有效，现行指令--&gt;IR）</span></p></li><li><p><span>执行算术或逻辑：</span></p><p><span>Ad(IR)--&gt;Bus--&gt;MAR（MDRout和MARin有效）；</span></p><p><span>1--&gt;R（CU发出读命令）</span></p><p><span>M(MAR)--&gt;数据线--&gt;MDR（操作数从存储器--&gt;数据线--&gt;MDR）</span></p><p><span>MDR--&gt;Bus--&gt;Y（MDRout和Yin有效，操作数--&gt;Y)</span></p><p><span>(ACC)+(Y)--&gt;Z（ACCout和ALUin有效，CU向ALU发送命令，结果--&gt;Z）</span></p><p><span>Z--&gt;ACC（Zout和ACCin有效，结果到--&gt;ACC）</span></p></li></ol><p><span> </span><strong><span>ALU要和缓存器配合使用！！</span></strong></p><h4><a name="专用数据通路" class="md-header-anchor"></a><span>专用数据通路</span></h4><p><span>不使用总线，各个部件单独连接，由各个c控制信号单独控制例如取指：</span></p><blockquote><p><span>(PC)--&gt;MAR；C</span><sub><span>0</span></sub><span>有效</span></p><p><span>(MAR)--&gt;主存；C</span><sub><span>1</span></sub><span>有效</span></p><p><span>1--&gt;R；控制单元向主存发送读信号</span></p><p><span>M(MAR)--&gt;IR；C</span><sub><span>2</span></sub><span>有效</span></p><p><span>(PC)+1--&gt;PC；C</span><sub><span>3</span></sub><span>有效</span></p><p><span>OP(IR)--&gt;CU；（译码部分，根据题目要求来）</span></p></blockquote><p>&nbsp;</p><h2><a name="四控制器的功能和工作原理" class="md-header-anchor"></a><span>(四)控制器的功能和工作原理</span></h2><p><span>功能：</span></p><ol start='' ><li><span>从主存中取指、指出下一条指令位置</span></li><li><span>指令译码或测试，产生控制信号</span></li><li><span>指挥控制CPU、主存、输入输出之间的数据流动方向。</span></li></ol><p><span>根据控制器产生位操作控制信号的方式不同分为硬布线和微程序控制器，两类控制的PC、IR相同，但是执行步骤的表示办法和控制各部件运行所需的控制信号的方案不同。</span></p><blockquote><p><span>控制单元的输入：</span></p><ol start='' ><li><span>指令寄存器OP(IR)--&gt;CU，控制信号的产生</span></li><li><span>时钟脉冲</span></li><li><span>标志（条件转移指令、PSW等）</span></li><li><span>外部信号（中断请求、总线请求信号）</span></li></ol><p><span>输出：</span></p><ol start='' ><li><span>CPU内部的控制信号</span></li><li><span>到控制总线的控制信号：到存储器（访存控制信号 </span><span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.343ex" height="3.161ex" viewBox="0 -1107.7 3161.5 1361" role="img" focusable="false" style="vertical-align: -0.588ex;"><defs><path stroke-width="0" id="E10-MJMAIN-4D" d="M132 622Q125 629 121 631T105 634T62 637H29V683H135Q221 683 232 682T249 675Q250 674 354 398L458 124L562 398Q666 674 668 675Q671 681 683 682T781 683H887V637H854Q814 636 803 634T785 622V61Q791 51 802 49T854 46H887V0H876Q855 3 736 3Q605 3 596 0H585V46H618Q660 47 669 49T688 61V347Q688 424 688 461T688 546T688 613L687 632Q454 14 450 7Q446 1 430 1T410 7Q409 9 292 316L176 624V606Q175 588 175 543T175 463T175 356L176 86Q187 50 261 46H278V0H269Q254 3 154 3Q52 3 37 0H29V46H46Q78 48 98 56T122 69T132 86V622Z"></path><path stroke-width="0" id="E10-MJMAIN-52" d="M130 622Q123 629 119 631T103 634T60 637H27V683H202H236H300Q376 683 417 677T500 648Q595 600 609 517Q610 512 610 501Q610 468 594 439T556 392T511 361T472 343L456 338Q459 335 467 332Q497 316 516 298T545 254T559 211T568 155T578 94Q588 46 602 31T640 16H645Q660 16 674 32T692 87Q692 98 696 101T712 105T728 103T732 90Q732 59 716 27T672 -16Q656 -22 630 -22Q481 -16 458 90Q456 101 456 163T449 246Q430 304 373 320L363 322L297 323H231V192L232 61Q238 51 249 49T301 46H334V0H323Q302 3 181 3Q59 3 38 0H27V46H60Q102 47 111 49T130 61V622ZM491 499V509Q491 527 490 539T481 570T462 601T424 623T362 636Q360 636 340 636T304 637H283Q238 637 234 628Q231 624 231 492V360H289Q390 360 434 378T489 456Q491 467 491 499Z"></path><path stroke-width="0" id="E10-MJMAIN-45" d="M128 619Q121 626 117 628T101 631T58 634H25V680H597V676Q599 670 611 560T625 444V440H585V444Q584 447 582 465Q578 500 570 526T553 571T528 601T498 619T457 629T411 633T353 634Q266 634 251 633T233 622Q233 622 233 621Q232 619 232 497V376H286Q359 378 377 385Q413 401 416 469Q416 471 416 473V493H456V213H416V233Q415 268 408 288T383 317T349 328T297 330Q290 330 286 330H232V196V114Q232 57 237 52Q243 47 289 47H340H391Q428 47 452 50T505 62T552 92T584 146Q594 172 599 200T607 247T612 270V273H652V270Q651 267 632 137T610 3V0H25V46H58Q100 47 109 49T128 61V619Z"></path><path stroke-width="0" id="E10-MJMAIN-51" d="M56 341Q56 499 157 602T388 705Q521 705 621 601T722 341Q722 275 703 218T660 127T603 63T555 25T525 9Q524 8 524 8H523Q524 5 526 -1T537 -21T555 -47T581 -67T615 -76Q653 -76 678 -56T706 -3Q707 10 716 10Q721 10 728 5L727 -13Q727 -88 697 -140T606 -193Q563 -193 538 -166T498 -83Q483 -23 483 -8L471 -11Q459 -14 435 -18T388 -22Q254 -22 155 81T56 341ZM607 339Q607 429 586 496T531 598T461 649T390 665T318 649T248 598T192 496T170 339Q170 143 277 57Q301 39 305 39L304 42Q304 44 304 46Q301 53 301 68Q301 101 325 128T391 155Q454 155 495 70L501 58Q549 91 578 164Q607 234 607 339ZM385 18Q404 18 425 23T459 33T472 40Q471 47 468 57T449 88T412 115Q398 117 386 117Q367 117 353 102T338 67Q338 48 351 33T385 18Z"></path><path stroke-width="0" id="E10-MJMAIN-AF" d="M69 544V590H430V544H69Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g transform="translate(24,0)"><use xlink:href="#E10-MJMAIN-4D"></use><use xlink:href="#E10-MJMAIN-52" x="917" y="0"></use><use xlink:href="#E10-MJMAIN-45" x="1653" y="0"></use><use xlink:href="#E10-MJMAIN-51" x="2334" y="0"></use></g><g transform="translate(0,520)"><use transform="scale(0.707)" xlink:href="#E10-MJMAIN-AF" x="-69" y="0"></use><g transform="translate(-241.9681206200458,0) scale(10.19122605569272,1)"><use transform="scale(0.707)" xlink:href="#E10-MJMAIN-AF"></use></g><use transform="scale(0.707)" xlink:href="#E10-MJMAIN-AF" x="3971" y="0"></use></g></g></svg></span><script type="math/tex">\overline{\text{MREQ}}</script><span> 读写命令）、I/O设备（</span><span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.76ex" height="2.811ex" viewBox="0 -1107.7 1188.5 1210.2" role="img" focusable="false" style="vertical-align: -0.238ex;"><defs><path stroke-width="0" id="E11-MJMAIN-49" d="M328 0Q307 3 180 3T32 0H21V46H43Q92 46 106 49T126 60Q128 63 128 342Q128 620 126 623Q122 628 118 630T96 635T43 637H21V683H32Q53 680 180 680T328 683H339V637H317Q268 637 254 634T234 623Q232 620 232 342Q232 63 234 60Q238 55 242 53T264 48T317 46H339V0H328Z"></path><path stroke-width="0" id="E11-MJMAIN-4F" d="M56 340Q56 423 86 494T164 610T270 680T388 705Q521 705 621 601T722 341Q722 260 693 191T617 75T510 4T388 -22T267 3T160 74T85 189T56 340ZM467 647Q426 665 388 665Q360 665 331 654T269 620T213 549T179 439Q174 411 174 354Q174 144 277 61Q327 20 385 20H389H391Q474 20 537 99Q603 188 603 354Q603 411 598 439Q577 592 467 647Z"></path><path stroke-width="0" id="E11-MJMAIN-AF" d="M69 544V590H430V544H69Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g transform="translate(24,0)"><use xlink:href="#E11-MJMAIN-49"></use><use xlink:href="#E11-MJMAIN-4F" x="361" y="0"></use></g><g transform="translate(0,520)"><use transform="scale(0.707)" xlink:href="#E11-MJMAIN-AF" x="-69" y="0"></use><g transform="translate(135.14268270405398,0) scale(2.4620200762962745,1)"><use transform="scale(0.707)" xlink:href="#E11-MJMAIN-AF"></use></g><use transform="scale(0.707)" xlink:href="#E11-MJMAIN-AF" x="1180" y="0"></use></g></g></svg></span><script type="math/tex">\overline{\text{IO}}</script><span>）；中断响应信号INTA，总线响应信号HLDA</span></li></ol></blockquote><p>&nbsp;</p><h3><a name="1硬布线控制器非重点）" class="md-header-anchor"></a><span>1、硬布线控制器（非重点）</span></h3><p><span>输入输出信号同上；</span></p><blockquote><p><span>微操作命令：</span></p><ul><li><p><span>取指周期：</span></p><p><span>PC--&gt;MAR;</span></p><p><span>1--&gt;R</span></p><p><span>M(MAR)--&gt;MDR</span></p><p><span>MDR--&gt;IR</span></p><p><span>OP(IR)--&gt;CU</span></p><p><span>(PC)+1--&gt;PC</span></p></li><li><p><span>间址周期</span></p><p><span>Ad(IR)--&gt;MAR</span></p><p><span>1--&gt;R</span></p><p><span>M(MAR)--&gt;MDR</span></p></li><li><p><span>执行周期</span></p><ul><li><p><span>a.非访存指令</span></p><p><span>CLA</span><span>	</span><span>0--&gt;ACC；//清ACC，clear</span></p><p><span>COM</span><span>	</span><span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.211ex" height="2.811ex" viewBox="0 -1107.7 2243.5 1210.2" role="img" focusable="false" style="vertical-align: -0.238ex;"><defs><path stroke-width="0" id="E12-MJMAIN-41" d="M255 0Q240 3 140 3Q48 3 39 0H32V46H47Q119 49 139 88Q140 91 192 245T295 553T348 708Q351 716 366 716H376Q396 715 400 709Q402 707 508 390L617 67Q624 54 636 51T687 46H717V0H708Q699 3 581 3Q458 3 437 0H427V46H440Q510 46 510 64Q510 66 486 138L462 209H229L209 150Q189 91 189 85Q189 72 209 59T259 46H264V0H255ZM447 255L345 557L244 256Q244 255 345 255H447Z"></path><path stroke-width="0" id="E12-MJMAIN-43" d="M56 342Q56 428 89 500T174 615T283 681T391 705Q394 705 400 705T408 704Q499 704 569 636L582 624L612 663Q639 700 643 704Q644 704 647 704T653 705H657Q660 705 666 699V419L660 413H626Q620 419 619 430Q610 512 571 572T476 651Q457 658 426 658Q322 658 252 588Q173 509 173 342Q173 221 211 151Q232 111 263 84T328 45T384 29T428 24Q517 24 571 93T626 244Q626 251 632 257H660L666 251V236Q661 133 590 56T403 -21Q262 -21 159 83T56 342Z"></path><path stroke-width="0" id="E12-MJMAIN-AF" d="M69 544V590H430V544H69Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g transform="translate(24,0)"><use xlink:href="#E12-MJMAIN-41"></use><use xlink:href="#E12-MJMAIN-43" x="750" y="0"></use><use xlink:href="#E12-MJMAIN-43" x="1472" y="0"></use></g><g transform="translate(0,531)"><use transform="scale(0.707)" xlink:href="#E12-MJMAIN-AF" x="-69" y="0"></use><g transform="translate(-66.5055167419294,0) scale(6.594971068827065,1)"><use transform="scale(0.707)" xlink:href="#E12-MJMAIN-AF"></use></g><use transform="scale(0.707)" xlink:href="#E12-MJMAIN-AF" x="2672" y="0"></use></g></g></svg></span><script type="math/tex">\overline{\text{ACC}}</script><span> --&gt;ACC；//取反</span></p><p><span>SHR</span><span>	</span><span>L(ACC)--&gt;R(ACC)；ACC</span><sub><span>0</span></sub><span>--&gt;ACC</span><sub><span>0</span></sub><span>；//算数右移</span></p><p><span>CSL</span><span>	</span><span>R(ACC)--&gt;L(ACC)；ACC</span><sub><span>0</span></sub><span>--&gt;ACC</span><sub><span>n</span></sub><span>；//循环左移</span></p><p><span>STP</span><span>	</span><span>0--&gt;G；//停机指令</span></p></li><li><p><span>b.访存指令</span></p><p><span>ADD X</span><span>	</span><span>Ad(IR)--&gt;MAR；1--&gt;R；M(MAR)--&gt;MDR；(ACC)+(MDR)--&gt;ACC</span></p><p><span>STA X</span><span>	</span><span>Ad(IR)--&gt;MAR；1--&gt;W；ACC--&gt;MDR；MDR--&gt;M(MAR)；</span></p><p><span>LDA X </span><span>	</span><span>Ad(IR)--&gt;MAR；1--&gt;R；M(MAR)--&gt;MDR；MDR--&gt;ACC；</span></p></li><li><p><span>c.转移指令</span></p><p><span>JMP X</span><span>	</span><span>Ad(IR)--&gt;PC；//无条件转移</span></p><p><span>BAN X</span><span>	</span><span>A</span><sub><span>0</span></sub><span>·Ad(IR)+</span><span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.018ex" height="2.811ex" viewBox="0 -1107.7 1299.5 1210.2" role="img" focusable="false" style="vertical-align: -0.238ex;"><defs><path stroke-width="0" id="E13-MJMAIN-41" d="M255 0Q240 3 140 3Q48 3 39 0H32V46H47Q119 49 139 88Q140 91 192 245T295 553T348 708Q351 716 366 716H376Q396 715 400 709Q402 707 508 390L617 67Q624 54 636 51T687 46H717V0H708Q699 3 581 3Q458 3 437 0H427V46H440Q510 46 510 64Q510 66 486 138L462 209H229L209 150Q189 91 189 85Q189 72 209 59T259 46H264V0H255ZM447 255L345 557L244 256Q244 255 345 255H447Z"></path><path stroke-width="0" id="E13-MJMAIN-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path stroke-width="0" id="E13-MJMAIN-AF" d="M69 544V590H430V544H69Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g transform="translate(24,0)"><use xlink:href="#E13-MJMAIN-41"></use><use xlink:href="#E13-MJMAIN-30" x="750" y="0"></use></g><g transform="translate(0,531)"><use transform="scale(0.707)" xlink:href="#E13-MJMAIN-AF" x="-69" y="0"></use><g transform="translate(113.92661622205955,0) scale(2.896861365557808,1)"><use transform="scale(0.707)" xlink:href="#E13-MJMAIN-AF"></use></g><use transform="scale(0.707)" xlink:href="#E13-MJMAIN-AF" x="1337" y="0"></use></g></g></svg></span><script type="math/tex">\overline{\text{A0}}</script><span>·(PC)--&gt;PC；//负则转移</span></p></li></ul></li></ul></blockquote><p><span>CPU控制方式：</span></p><ol start='' ><li><span>同步控制：控制信号来自统一的时钟，以最长的微操作序列为标准（控制电路简单，速度慢）</span></li><li><span>异步控制：各部件按自身固有速度运行，通过应答方式联络。（速度快，电路复杂）</span></li><li><span>联合控制：大部分同步，小部分异步；（折中）</span></li></ol><p><span>设计步骤：</span></p><ol start='' ><li><p><span>分析每个阶段的微操作序列</span></p></li><li><p><span>选择CPU的控制方式</span></p></li><li><p><span>安排微操作时序</span></p></li><li><p><span>电路设计</span></p><ol start='' ><li><span>列出操作时间表</span></li><li><span>写出微操作的最简表达式</span></li><li><span>画出逻辑图</span></li></ol></li></ol><blockquote><p><span>安排微操作时序的原则：</span></p><ol start='' ><li><span>先后顺序不得随意更改</span></li><li><span>被控对象不同的微操作尽量在一个节拍内</span></li><li><span>占用时间短的微操作 尽量安排在一个节拍内并允许有先后顺序。</span></li></ol></blockquote><p><strong><span>微操作控制信号由组合逻辑电路根据当前的指令码、状态和时序、及时产生。</span></strong></p><p><span> </span></p><h3><a name="2微程序控制器" class="md-header-anchor"></a><span>2、微程序控制器</span></h3><p><strong><span>事先把微操作控制信号存储在一个专门的存储器中</span></strong></p><h4><a name="基本概念" class="md-header-anchor"></a><span>基本概念</span></h4><p><span>微程序：一条机器指令</span></p><p><span>微指令：对应一个或几个微操作；基本格式：操作控制微操作码+顺序控制微地址码</span></p><p><span>微周期：读取一条微指令并执行相应微操作所需的时间。</span></p><p><span>微操作：计算机最基本的不可再分割的操作。</span></p><p><span>微命令：微操作的控制命令，构成控制序列的最小单位。</span></p><p><span>互斥性的微命令：不可以同时完成的微命令，相容性：可以同时完成。</span></p><p>&nbsp;</p><h4><a name="微程序控制器的组成和工作过程" class="md-header-anchor"></a><span>微程序控制器的组成和工作过程</span></h4><blockquote><ol start='' ><li><span>控制存储器（CM）</span></li><li><span>微指令寄存器（CMDR/μIR）</span></li><li><span>微地址形成部件：产生初始和后续微地址</span></li><li><span>微地址寄存器（CMAR）</span></li><li><span>地址译码器</span></li></ol></blockquote><blockquote><p><span>执行过程：:</span></p><ol start='' ><li><span>执行取微指令公共操作，具体执行是在机器运行时，将取微程序的入口地址送入CMAR，从CM中读出微指令并送入CMDR。取指微指令一般是CM的0号单元，取指微程序执行后，机器指令就存入指令寄存器中。</span></li><li><span>由机器指令的操作码字段通过微地址形成部件产生指令对应的微程序入口地址，送入CMAR。</span></li><li><span>从CM中逐条取出微指令，并执行。</span></li><li><span>执行完一个微程序后，又回到取指微程序入口地址，以完成取下一条机器指令的公共操作。</span></li></ol></blockquote><p><span>因为任何一条机器指令的取指部分是一致的，所以可以编成统一的取指微程序，同样，也可以考虑将间址、中断共用的微程序单独编制。由此，指令系统中有n条指令，则微程序数至少是n+1。</span></p><h4><a name="微指令的编码方式" class="md-header-anchor"></a><span>微指令的编码方式</span></h4><p><span>微指令编码方式又称为微指令控制方式，指如何对微指令的控制字段进行编码，以形成控制字段</span></p><ol start='' ><li><span>直接编码（直接控制）：每位代表一条微命令，每个微命令对应控制数据通路的一个操作，优点是简单直观，执行速度快、并行性好，缺点是指令字长过长，造成存储控制器容量极大。</span></li><li><span>字段直接编码：将微命令字段分成若干个小段，把互斥性微命令组合在同一字段，相容性在不同字段，每个字段直接编码。可以缩短指令字长，但是要通过译码电路发出微命令，较慢。分段原则有：互斥、相容；每段信息位不能太多；每段留出一个状态，通常位全0，表示不操作。</span></li><li><span>字段间接编码方式：某些微命令由另一个字段中的某些微指令来解释，一般作为字段直接编码的辅助手段，由于不是靠字段直接译码发出微命令，也称为隐式编码，这种方式可以进一步缩短微指令字长，但削弱了并行控制能力。</span></li></ol><h4><a name="微地址的形式方式" class="md-header-anchor"></a><span>微地址的形式方式</span></h4><p><span>后继地址主要有两大基本类型：一是直接由微指令的下地址字段给出，这种也称为断定方式。另一种则根据机器指令的操作码形成，微指令的地址由操作码微地址形成部件形成。实际上还有以下形成方式：</span>1️⃣<span> 增量计数法，即(CMAR)+1--&gt;CMAR，适用于后继微指令地址连续的情况 </span>2️⃣<span> 通过各种标志位决定微指令分支转移地址​ </span>3️⃣<span> 通过网络测试产生​ </span>4️⃣<span>通过硬件直接产生微程序入口地址。​ </span></p><h4><a name="微指令格式" class="md-header-anchor"></a><span>微指令格式</span></h4><ol start='' ><li><span>水平型微指令：定义并执行几种并行的基本操作，指令字中的一位对应一个控制信号；优点是微程序短，执行速度快， 并行操作能力强，灵活，但微指令长，编写微程序麻烦，用户难以掌握</span></li><li><span>垂直性微操作：类似机器指令操作码，在微操作码中规定微指令的功能，一条垂直型只定义并执行一种基本操作，优点是微指令短、简单规整、便于编写，但微程序长，执行速度慢，工作效率低。</span></li><li><span>混合型：在垂直型的基础上，增加不太复杂的并行操作，微指令较短，便于编写，微程序也不长。</span></li></ol><h4><a name="微程序控制单元设计步骤" class="md-header-anchor"></a><span>微程序控制单元设计步骤：</span></h4><ol start='' ><li><span>写出对应机器指令的微操作命令和节拍安排</span></li><li><span>确定指令格式</span></li><li><span>编写指令码点</span></li></ol><p><span>动态微程序：能够根据用户需求更改微程序，采用EPROM储存，还需要可写控制寄存器的支持。</span></p><p><span>毫微程序：硬件不由微程序直接控制，而是由毫微程序执行微指令，这个第二级控制存储器就是毫微存储器，由其毫微指令直接控制硬件。</span></p><figure><table><thead><tr><th><span>对比项目\类别</span></th><th><span>微程序控制器</span></th><th><span>硬布线控制器</span></th></tr></thead><tbody><tr><td><span>工作原理</span></td><td><span>微操作控制信号以微程序的形式存放在控制存储器中，执行指令时读出</span></td><td><span>微操作控制信号由组合逻辑电路根据当前指令码、状态和时序即时产生</span></td></tr><tr><td><span>执行速度</span></td><td><span>慢</span></td><td><span>快</span></td></tr><tr><td><span>规整性</span></td><td><span>规整</span></td><td><span>烦琐、不规整</span></td></tr><tr><td><span>应用场合</span></td><td><span>CISC</span></td><td><span>RISC</span></td></tr><tr><td><span>易扩充性</span></td><td><span>易扩充易修改</span></td><td><span>困难</span></td></tr></tbody></table></figure><p>&nbsp;</p><h2><a name="五指令流水线" class="md-header-anchor"></a><span>(五)指令流水线</span></h2><h3><a name="1指令流水线的基本概念" class="md-header-anchor"></a><span>1、指令流水线的基本概念</span></h3><p><span>把一个重复的过程的若干子过程，每个字过程并行执行，只需增加少量硬件就能将计算机运算速度提高几倍，是一种普遍使用的并行处理技术。</span></p><h4><a name="定义" class="md-header-anchor"></a><span>定义</span></h4><p><span>三级流水线将一条指令的执行过程分为取指、分析、执行三个阶段。则对于n条指令，设每个阶段都耗时t，则顺序执行n条指令需要T</span><sub><span>1</span></sub><span>=3nt，又叫串行执行，优点是控制简单，硬件代价小，缺点是执行指令的速度慢，机器利用率低。一次重叠，即k条指令的执行和k+1的取值阶段重叠，则耗时T</span><sub><span>2</span></sub><span>=(1+2n)t，程序执行时间缩短了1/3，但是硬件上付出了较大开销的代价，控制过程复杂。二次重叠则将k的执行、k+1的分析和k+2的取指重叠，T</span><sub><span>3</span></sub><span>=（2+n）t，若指令需要更多执行步骤，也可以进行更多次重叠。重叠后基本达到每个机器周期完成一条指令。</span></p><h4><a name="表示方法" class="md-header-anchor"></a><span>表示方法</span></h4><p><span>时空图。</span></p><h4><a name="特点" class="md-header-anchor"></a><span>特点</span></h4><ol start='' ><li><span>把一条指令分解为几个有联系的子任务，每个子任务由一个专门功能部件执行，依靠多个功能部件并行工作来提高效率</span></li><li><span>每个功能段不见后设置缓冲寄存器或锁存器，保存本流水段的执行结果</span></li><li><span>各功能段时间尽量相等，否则会阻塞、断流</span></li><li><span>必须是连续任务</span></li><li><span>需要装入时间和排空时间，装入时间是第一个任务进入流水线到输出流水线的时间，排空类似。</span></li></ol><h3><a name="2指令流水线的基本实现" class="md-header-anchor"></a><span>2、指令流水线的基本实现</span></h3><h4><a name="指令流水线的分类" class="md-header-anchor"></a><span>指令流水线的分类</span></h4><ol start='' ><li><span>部件功能级、处理机级、处理机间级：功能部件级将复杂的算术逻辑运算组成流水线工作方式；处理机级将一条指令解释过程分为多个子过程，如取指、译码、执行、访存、和写回；处理机间则是一种宏流水，每个处理机完成某一个专门任务。</span></li><li><span>单功能流水线和多功能流水线：单功能实现一种固定的专门功能，多功能则是通过各段之间不同的连接方式可以同时或不同时的地实现多种功能。</span></li><li><span>动态流水线和静态流水线：静态各段只能按照同一种功能地连接方式工作；某些段正在实现运算，另一些段正在进行另一种运算，能提高效率，但是使控制复杂。</span></li><li><span>线性流水线和非线性流水线：线性流水功能段只经过一次，不存在反馈回路；非线性存在反馈回路，可以进行递归运算。</span></li></ol><h4><a name="影响因素" class="md-header-anchor"></a><span>影响因素</span></h4><p><span>主要有资源冲突和相关问题，相关问题包括数据相关和控制相关，也称为数据冲突、数据冒险、控制冲突、冒险。</span></p><p><span>资源冲突指多条指令在同一时刻争抢同一资源造成冲突，解决方法有：</span>1️⃣<span>使后一条指令暂停，</span>2️⃣<span>单独设置数据存储器和指令存储器，增加硬件来避免冲突。但更多的问题是指令间的关联关系导致指令流水线停顿，主要有以下两种。</span></p><ol start='' ><li><span>数据冲突（数据相关、冒险），即下一条指令需要用到本条指令数据，解决方法有：</span>1️⃣<span>将后续指令暂停，可用硬件阻塞（stall）或软件插入“NOP”指令两种方法。</span>2️⃣<span>数据旁路、相关专用通路技术，将前一条指令的ALU计算结果直接作为输入数据进行计算。</span>3️⃣<span>指令编译优化，调整指令顺序。</span></li><li><span>控制冲突，在执行转移、调用、返回等指令改变PC值，可能造成断流和控制冒险，主要有以下解决方案：</span>1️⃣<span> 对转移指令进行分支预测，尽早生成转移目标地址，分为简单（静态）预测和动态预测，静态预测总是预测条件不满足，动态预测则根据程序执行的历史状况，进行动态预测调整，有较高的准确率。 </span>2️⃣<span> 预取成功失败两个控制流方向上的目标指令 </span>3️⃣<span> 加快和提前形成条件码 </span>4️⃣<span> 提高转移方向的猜准率</span></li></ol><p><span>####性能指标</span></p><p><span>吞吐率：单位时间内完成的任务数，即TP=n/T</span><sub><span>k</span></sub><span>，完成的任务数量除以时间（k+n-1）Δt，k是流水线级数</span></p><p><span>加速比：不使用流水线的时间除以使用流水线的时间，S=T</span><sub><span>0</span></sub><span>/T</span><sub><span>k</span></sub><span>=kn/k+n-1，n--&gt;∞，则S--&gt;k。</span></p><p><span>效率：有效时空面积/时间和流水段围成的时空区总面积，流水线各段执行时间相等，连续输入任务趋于∞时，最高效率E</span><sub><span>max</span></sub><span>=1。</span></p><h3><a name="3超标量和动态流水线的基本概念" class="md-header-anchor"></a><span>3、超标量和动态流水线的基本概念</span></h3><p><span>超标量：每个时钟周期并发多条独立指令，用并行操作方式将多条指令编译并执行，但超标量不能调整指令执行顺序，可以通过编译优化搭配指令，挖掘并行性。</span></p><p><span>超流水：同一个时钟周期内，一个功能部件使用多次，即在一个时钟周期内，再次分段，缺点也是不能调整指令顺序。</span></p><p><span>超长指令字：将多个指令结合，通过编译程序挖掘指令潜在并行性，将多条可以并行操作的指令组合成一条具有多个操作码字段的超长指令字。</span></p><p><span>  </span></p><h1><a name="六总线" class="md-header-anchor"></a><span>六、总线</span></h1><h2><a name="一总线概述" class="md-header-anchor"></a><span>(一)总线概述</span></h2><h3><a name="1总线的基本概念" class="md-header-anchor"></a><span>1、总线的基本概念</span></h3><p><strong><span>总线</span></strong><span>：总线是一组能为多个部件分时共享的公共信息传送路线，（实际线路）</span></p><p><strong><span>总线设备</span></strong><span>:总线上连接的设备，分为主从两种，主设备能获得系统总线控制权，从设备只能响应主设备发来的命令。</span></p><p><strong><span>总线特性</span></strong><span>：机械特性(尺寸、形状)、电气特性（传输方向和有效电平范围）、功能特性（每根传输线的功能）、时间特性（信号和时序的关系）</span></p><p><strong><span>猝发传输</span></strong><span>：在一个总线周期内传输存储地址连续的多个数据字的传输方式。</span></p><p><span>###2、总线的分类</span></p><p><span>串行总线：优点：只需要一条传输线，成本低廉，广泛应用于长距离传输，应用于内部时，可以节省布线空间；缺点：数据发送和接受时需要拆卸和装配，要考虑串并行转换问题。</span></p><p><span>并行总线：优点：逻辑时序简单，电路实现容易；缺点：信号线多，成本高，频率高时，信号线会产生干扰，对每条线等长的要求也越高，无法持续提升工作频率。</span></p><p><span>片内总线：芯片内部总线，CPU内</span></p><p><span>系统总线：计算机系统内各功能部件之间相互连接的总线。包括数据、地址、控制总线。</span></p><p><span>数据总线：双向总线，传输数据信息，与机器字长、存储字长有关</span></p><p><span>地址总线：单向，包括地址，位数与地址空间和设备数量有关。</span></p><p><span>控制总线：有出有入，控制命令和反馈信号</span></p><p><span>通信总线（外部总线）：计算机系统之间或与其他远程通信设备、测试设备之间传送信息。</span></p><h3><a name="3总线的组成及性能指标" class="md-header-anchor"></a><span>3、总线的组成及性能指标</span></h3><h4><a name="结构" class="md-header-anchor"></a><span>结构：</span></h4><ol start='' ><li><span>单总线：I/O、主存、CPU挂在同一组总线上，可以分为地址控制数据信号点，优点：简单、易于接入新设备；缺点带宽低，负载中，不支持并发，争用和冲突多。</span></li><li><span>双总线（通道）：主存总线和I/O总线，主存总线在CPU、主存、通道之间传送数据，I/O总线在多个外设与通道之间传送数据，支持猝发传送，优点：将低速I/O设备分离，缺点：需要增加通道等硬件设备。</span></li><li><span>三总线（DMA）：主存总线、I/O总线和DMA总线，高速外设可以通过DMA（直接内存访问）总线访问内存，优点：提高I/O设备性能，更快响应命令，提高系统吞吐量，缺点工作效率低。</span></li><li><span>4总线（桥）：桥连接不同总线，具有数据缓冲、转换控制功能，越靠近CPU越快。CPU总线（CPU和Cache）通过桥和系统总线连接主存，通过高速总线连接各类接口，通过扩展总线接口连接扩展总线，扩展总线连接各类外设。</span></li></ol><h4><a name="性能指标-n1006" class="md-header-anchor"></a><span>性能指标：</span></h4><ol start='' ><li><span>总线周期（传输周期）：一次总线操作所需的全部时间，包括申请、寻址、传输和结束阶段，通常由若干个总线时钟周期构成。</span></li><li><span>时钟周期：机器时钟周期，</span></li><li><span>工作频率：总线周期的倒数，1s内传送几次数据；总线频率=时钟频率/N。</span></li><li><span>时钟频率：机器时钟频率。</span></li><li><span>总线宽度：总线位宽，通常指数据总线的根数，一次能同时传输位数。</span></li><li><span>总线带宽：总线的数据传输率=总线宽度/总线周期(bit/s)=总线频率x总线宽度，如果需要B/s，再÷8.</span></li><li><span>总线复用：一种信号线在不同的时间传输不同的信息，可以用较少的先传输更多的信息，节省成本。</span></li><li><span>信号线数：三种总线数的总和。</span></li></ol><p>&nbsp;</p><h2><a name="二总线仲裁" class="md-header-anchor"></a><span>//(二)总线仲裁</span></h2><p><span>为了解决多个主设备同时竞争总线控制权的问题，需要采用总线仲裁部件，以某种方式选择一个主设备优先获得总线控制权，可以分为集中和分布两种方式。</span></p><h3><a name="1集中仲裁方式" class="md-header-anchor"></a><span>1、集中仲裁方式</span></h3><p><span>控制逻辑集中于一个设备（如CPU），将所有总线请求集中，用一个裁决算法进行裁决。</span></p><ol start='' ><li><span>链式查询（BR BG BS三根线）：所有部件共用总线请求线BR，总线控制器检查总线忙？：不忙发送总线响应信号，信号在总线响应线BG中串行的从一个部件到下一个部件依次查询，若到达的部件有请求，则信号被截住，不再往下传，同时</span><strong><span>部件</span></strong><span>发送总线忙的BS线信号，获得总线控制权。部件离总线控制器越近，优先级越高，</span><em><span>优点：优先级固定，只需很少几根线就能实现优先次序，结构简单，扩充容易；缺点：对硬件电路故障敏感，优先级不能改变，高优先级频繁请求时，低优先级长期不能使用总线。</span></em></li><li><span>计数器定时查询（BS BR和设备地址线，[log</span><sub><span>2</span></sub><span>n]+2）：计时器通过设备地址线向各个部件发送计数值，计数值与请求使用总线设备地址一致时，获得总线控制权，并终止计数查询。</span><em><span>优点是：优先级可以固定也可以通过设置计数初值改变，也可以优先级相等，电路故障没那么敏感。缺点是增加了控制线束，控制比链式复杂</span></em></li><li><span>独立请求方式（每个设备都有一对BG</span><sub><span>i</span></sub><span>和BR</span><sub><span>i</span></sub><span>，共用BS，一共2n+1）：每个设备均有一对BR和BG，设备使用各自的总线请求线发送总线请求信号，并在总线控制器中排队，排队器按照一定优先次序决定批准部件请求，并向部件发送总线响应信号，部件获得使用权后，开始传输数据，</span><em><span>优点：响应速度快，直接发送信号，优先级灵活，缺点控制线数量多，总线控制逻辑更复杂</span></em></li></ol><p><strong><span>总线忙的信号都由总线使用权获得者建立</span></strong></p><h3><a name="2分布仲裁方式" class="md-header-anchor"></a><span>2、分布仲裁方式</span></h3><p><span>不需要集中的仲裁器，每个潜在主模块都有自己的仲裁号和仲裁器，有总线请求时，将仲裁号发布在共享的仲裁总线上，每个仲裁器将总线上的仲裁号于自己的进行比较，若仲裁总线上的优先级更高，则总线请求不予响应并撤销他的仲裁号，最后，获胜者的仲裁号保留在仲裁总线上。</span></p><h2><a name="三总线操作和定时" class="md-header-anchor"></a><span>(三)总线操作和定时</span></h2><p><span>总线定时是指再双方交换数据的过程中，需要时间上配合关系的控制，实质是一种协议或规则。</span></p><h4><a name="总线传输的四个阶段" class="md-header-anchor"></a><span>总线传输的四个阶段：</span></h4><ol start='' ><li><span>申请分配阶段：可以分为传输请求和总线仲裁两个小阶段</span></li><li><span>寻址阶段：主模块通过总线发出本次访问的从模块的地址和相关命令，启动从模块</span></li><li><span>传输阶段：数据交换</span></li><li><span>结束接环：主模块信息从系统总线上撤出，让出总线使用权。</span></li></ol><h3><a name="1同步定时方式" class="md-header-anchor"></a><span>1、同步定时方式</span></h3><p><span>采用统一的时钟信号协调，每个总线周期进行一次数据传送，优点：传输速度快，传输效率高，总线控制逻辑简单；缺点：强制性同步，不能及时进行有效性检验，可靠性差。一般用于总线长度较短以及总线所连接部件存取时间比较接近的系统。</span></p><p><span>时钟前沿发信号，后沿判断识别。</span></p><h3><a name="2异步定时方式" class="md-header-anchor"></a><span>2、异步定时方式</span></h3><p><span>通过应答“握手”来实现定时控制，主设备向从设备发送请求，从设备回应“回答”信号</span></p><p><span>根据“请求”和“回答”信号撤销是否互锁，异步定时方式分为三种类:</span></p><ol start='' ><li><span>不互锁：主设备发出请求后，一段时间自动撤销；从设备回答后，一段时间自动撤销。问题：可靠性不够高（故障没法发现）但速度快</span></li><li><span>半互锁：主设备发送请求后，等到回答才撤销，有互锁关系；从设备回答后，一段时间自动撤销，无互锁关系，问题：主设备可能一直在等待回答</span></li><li><span>全互锁：都等到反馈才撤销，完全互锁。</span></li></ol><p><span>优点：周期长度可变，能保证两个工作时间相差很大的部件之间可靠信息交换，自动适应时间配合。缺点：比同步控制复杂，速度比同步定时慢</span></p><p><span>求有效传输率？（数据位数/数据位+其他附加位）*波特率</span></p><h4><a name="半同步定时" class="md-header-anchor"></a><span>半同步定时</span></h4><p><span>再同步的基础上，增加一个</span><span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.76ex" height="2.811ex" viewBox="0 -1107.7 2910.5 1210.2" role="img" focusable="false" style="vertical-align: -0.238ex;"><defs><path stroke-width="0" id="E14-MJMAIN-57" d="M792 683Q810 680 914 680Q991 680 1003 683H1009V637H996Q931 633 915 598Q912 591 863 438T766 135T716 -17Q711 -22 694 -22Q676 -22 673 -15Q671 -13 593 231L514 477L435 234Q416 174 391 92T358 -6T341 -22H331Q314 -21 310 -15Q309 -14 208 302T104 622Q98 632 87 633Q73 637 35 637H18V683H27Q69 681 154 681Q164 681 181 681T216 681T249 682T276 683H287H298V637H285Q213 637 213 620Q213 616 289 381L364 144L427 339Q490 535 492 546Q487 560 482 578T475 602T468 618T461 628T449 633T433 636T408 637H380V683H388Q397 680 508 680Q629 680 650 683H660V637H647Q576 637 576 619L727 146Q869 580 869 600Q869 605 863 612T839 627T794 637H783V683H792Z"></path><path stroke-width="0" id="E14-MJMAIN-41" d="M255 0Q240 3 140 3Q48 3 39 0H32V46H47Q119 49 139 88Q140 91 192 245T295 553T348 708Q351 716 366 716H376Q396 715 400 709Q402 707 508 390L617 67Q624 54 636 51T687 46H717V0H708Q699 3 581 3Q458 3 437 0H427V46H440Q510 46 510 64Q510 66 486 138L462 209H229L209 150Q189 91 189 85Q189 72 209 59T259 46H264V0H255ZM447 255L345 557L244 256Q244 255 345 255H447Z"></path><path stroke-width="0" id="E14-MJMAIN-49" d="M328 0Q307 3 180 3T32 0H21V46H43Q92 46 106 49T126 60Q128 63 128 342Q128 620 126 623Q122 628 118 630T96 635T43 637H21V683H32Q53 680 180 680T328 683H339V637H317Q268 637 254 634T234 623Q232 620 232 342Q232 63 234 60Q238 55 242 53T264 48T317 46H339V0H328Z"></path><path stroke-width="0" id="E14-MJMAIN-54" d="M36 443Q37 448 46 558T55 671V677H666V671Q667 666 676 556T685 443V437H645V443Q645 445 642 478T631 544T610 593Q593 614 555 625Q534 630 478 630H451H443Q417 630 414 618Q413 616 413 339V63Q420 53 439 50T528 46H558V0H545L361 3Q186 1 177 0H164V46H194Q264 46 283 49T309 63V339V550Q309 620 304 625T271 630H244H224Q154 630 119 601Q101 585 93 554T81 486T76 443V437H36V443Z"></path><path stroke-width="0" id="E14-MJMAIN-AF" d="M69 544V590H430V544H69Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g transform="translate(24,0)"><use xlink:href="#E14-MJMAIN-57"></use><use xlink:href="#E14-MJMAIN-41" x="1028" y="0"></use><use xlink:href="#E14-MJMAIN-49" x="1778" y="0"></use><use xlink:href="#E14-MJMAIN-54" x="2139" y="0"></use></g><g transform="translate(0,531)"><use transform="scale(0.707)" xlink:href="#E14-MJMAIN-AF" x="-69" y="0"></use><g transform="translate(-193.99305136796823,0) scale(9.207936293488713,1)"><use transform="scale(0.707)" xlink:href="#E14-MJMAIN-AF"></use></g><use transform="scale(0.707)" xlink:href="#E14-MJMAIN-AF" x="3616" y="0"></use></g></g></svg></span><script type="math/tex">\overline{\text{WAIT}}</script><span>，等待响应信号，允许速度不匹配的模块和谐工作</span></p><h4><a name="分离式定时" class="md-header-anchor"></a><span>分离式定时</span></h4><p><span>前三种共同点：在一个总线传输周期占用，但在从模块准备数据时，空闲。</span></p><p><span>分离式将一个总线传输周期分为两个子周期，子周期1主模块申请，发送地址和命令，发完以后放弃使用权，可以由别的模块占用总线；子周期2从模块准备好数据后，占用总线，将信息送到总线。</span></p><h2><a name="四总线标准" class="md-header-anchor"></a><span>(四)总线标准</span></h2><p><span>为了把各种不同的模块组成计算机系统时必须遵守的规范，接口两端的设备只需要按总线标准的要求完成自身方面的功能要求即可。</span></p><p><span>系统总线：ISA、EISA、VESA、PCI、PCI-Express</span></p><p><span>设备总线：IDE、AGP、RS-232、USB、SATA、SCSI</span></p><p><span>局部总线标准：ISA和CPU总线间增加的一级总线，如PCI、VESA</span></p><p><span>即插即用：Plug &amp; Play：自动配置板卡和其他设备，</span></p><p><span>热插拔：Hot swap带电插拔</span></p><ol start='' ><li><em><span>ISA</span></em><span>：并行；系统总线；数据线8/16，工业标准体系结构，最早出现的微型计算机系统总线，需要CPU和DMA控制，不支持总线仲裁，最快16MB。</span></li><li><em><span>EISA</span></em><span>（Extended）： 并行，系统总线，解决了上述大部分问题，支持猝发传输，数据速度32MB</span></li><li><em><span>PCI</span></em><span>：并行，局部总线，最大速度528MB，支持即插即用、突发传送、兼容性良好、可扩充性好，可通过桥连接实现多层总线，使用了多路复用，减少引脚个数，与处理器和存储器子系统完全并行操作。</span></li><li><span>AGP：加速图形接口，并行，2.1GB，局部总线，连接显卡。</span></li><li><em><span>PCI-Express</span></em><span>：串行总线，10GB以上，热插拔。</span></li><li><span>VESA：局部总线；视频</span></li><li><em><span>USB</span></em><span>：设备总线，最大速度1280MB，串行；热插拔，即插即用，标准统一，高速传输，连接电缆轻巧，可为5v低压外设供电，菊花链连接，最多127个设备。</span></li><li><span>RS-232：通信总线，20Kbps</span></li><li><span>IDE（ATA）：硬盘，并行，100MB</span></li><li><span>SATA：硬盘，串行，600MB，（ATA并行）</span></li><li><span>SCSI：计算机和智能设备之间的独立处理器标准</span></li><li><span>PCMCIA：扩展功能的小型插槽，笔记本，即插即用</span></li></ol><p><span>北桥：连接AGP和内存；以及处理器。</span></p><p><span>南桥：连接USB，IDE总线；以及北桥。</span></p><p><span>视频线标准：</span></p><p><span>VGA：传输模拟信号，在CRT（阴极射线显示器）上可以直接使用，LCD需要先转成数字信号。</span></p><p><span>DVI：传输数字信号，但是1024*768以下和VGA差别不大</span></p><p><span>HDMI：传输数字信号。</span></p><p><span>  </span></p><h1><a name="七输入输出io系统" class="md-header-anchor"></a><span>七、输入输出(I/O)系统</span></h1><h2><a name="一io系统基本概念" class="md-header-anchor"></a><span>(一)I/O系统基本概念</span></h2><p><span>外部设备：包括输入输出设备，以及通过输入输出接口才能访问到的外部设备。</span></p><p><span>接口：外设和主机间传输数据时进行协调工作的逻辑部件，包括协调速度匹配、电平、格式转换等。</span></p><p><span>输入/输出设备：键盘和鼠标是最基本的输入设备，显示器和打印机是最基本的输出设备。</span></p><p><span>外存设备：除了内存和CPU缓存以外的存储器。</span></p><p><span>早期I/O：CPU和I/O串行工作，分散连接，程序查询方式：不断查询I/O设备是否已经ready，从而控制I/O设备与主机交换信息。</span></p><p><span>接口和DMA阶段：从分散到总线连接，可以通过中断方式和DMA方式进行控制。</span></p><p><span>I/O通道阶段，再到I/O处理机阶段，通道上具有微型CPU，有控制功能。</span></p><p><span>I/O系统由I/O软件和I/O硬件组成，软件包括驱动程序、用户程序、升级补丁等，通常采用I/O指令和通道指令实现信息交换。I/O指令包括操作码、命令码、设备码，操作码只声明是I/O指令，操作通过命令码给出，属于CPU指令；通道指令是通道自身的指令，一般放在主存。硬件包括外部设备、设备控制器、接口和I/O总线；设备控制器控制具体动作，接口用来和主机（总线）相连。</span></p><p><span>I/O控制方式：</span></p><ol start='' ><li><span>程序查询方式：CPU通过程序不断查询I/O设备是都已经做好准备。</span></li><li><span>程序中断方式：只有在I/O设备Ready并向CPU发送请求时才响应。</span></li><li><span>DMA方式：（高速外设）主存和I/O之间有直接数据通路，无需中断服务程序。</span></li><li><span>通道方式：在系统中有通道控制部件，每个通道挂若干外设，主机在执行I/O命令时，只启动通道，通道内的处理器将执行通道程序，完成I/O操作。</span></li></ol><p>&nbsp;</p><p>&nbsp;</p><h2><a name="二外部设备" class="md-header-anchor"></a><span>(二)外部设备</span></h2><p><span>除主机外的能直接或间接与计算机交换信息的装置。</span></p><h3><a name="1输入设备键盘鼠标" class="md-header-anchor"></a><span>1、输入设备：键盘、鼠标</span></h3><p><span>键盘是最常用的输入设备，通过它可以发出命令或输入数据。</span></p><p><span>键盘通常以矩阵的形式排列按键，每个键相当于一个开关，按下时电信号接通，但可能产生抖动，需要用硬件或软件方式消除，键盘键入分为三个步骤，查出按下的键，翻译成主机能接收的编码，将编码传给主机。</span></p><p><span>鼠标是最常用的定位输入设备，把操作和屏幕上的位置信息相联系。</span></p><h3><a name="2输出设备显示器打印机" class="md-header-anchor"></a><span>2、输出设备：显示器、打印机</span></h3><h4><a name="显示器" class="md-header-anchor"></a><span>显示器：</span></h4><p><span>按照器件分类分为阴极射线管CRT，液晶显示器LCD，发光二极管LED等，按照显示信息可以分为字符显示器、图形显示器和图像显示器，属于点阵方式运行的设备，参数有屏幕大小（对角线长度）；分辨率即能表示的像素个数；灰度级，黑白显示器的亮暗差别，在彩色显示器中表现为颜色的不同，灰度越多图像层次越清晰、逼真；刷新，光点消失前重新扫描显示一遍；刷新率，单位时间扫描整个屏幕内容的次数，至少要30Hz，典型60-120Hz；显存（VRAM）由分辨率和灰度级位数相关，VRAM容量=分辨率x灰度级位数；VRAM带宽=分辨率x灰度级位数x帧频（刷新率）；</span></p><p><span>CRT：主要由电子枪、偏转线圈、荫罩、高压石墨电极、荧光粉涂层、玻璃外壳组成，可视角度大，无坏点，色彩均匀，响应时间极短。</span></p><blockquote><p><span>字符显示器：点阵是由mxn个点组成的阵列，点阵存入由ROM构成的字符发生器中，对于每个字符窗口，所需显示的字符的ASCII代码被存放在VRAM中，以备 刷新。分为光栅扫描显示器和随即扫描显示器。</span></p><p><span>图形显示器：显示文件传送给矢量发生器，产生模拟电压控制电子束移动，需要按一定频率反复刷新。</span></p></blockquote><p><span>LCD：液晶电光效应，由图像信号电压控制薄膜晶体管，间接控制液晶分子来实现图像显示</span></p><h4><a name="打印机" class="md-header-anchor"></a><span>打印机：</span></h4><p><span>分类：按照工作原理分为击打、非击打式打印机，按照工作方式分为串行（逐字打印）行式打印机（逐行打印）根据工作方式分类如下：</span></p><ol start='' ><li><span>针式打印机：击打式，擅长多层复写打印，实现票据打印，造价低廉工作简单。</span></li><li><span>喷墨式打印机：带点喷雾通过电极偏转形成字型，三原色混合产生颜色。</span></li><li><span>激光打印机：硒鼓。</span></li></ol><p>&nbsp;</p><p><span>###3、外存储器：硬盘存储器、磁盘阵列、光盘存储器</span></p><p><span>目前主要使用磁表面存储器，优点：容量大，位价格低，记录介质可重复使用，可以长期保存，非破坏性读出，缺点存取速度慢，机械结构复杂，对工作环境要求高</span></p><p><span>磁盘存储器：</span></p><blockquote><p><span>存储区域：每个硬盘有若干个面，每个面划分为若干磁道，每个磁道划分为若干扇区，扇区（块）是磁盘读写的最小单位。磁头数=记录面数；柱面数=磁道数；扇区数=块数。</span></p><p><span>硬件构成：磁盘驱动器（温彻斯特盘，可移动磁头固定盘片），磁盘控制器，盘面</span></p><p><span>性能指标：</span></p><ol start='' ><li><span>磁盘容量，分为格式化和非格式化，非格式化是可以利用的磁化单元总数，格式化是按照记录格式所能存储的信息总量，一般是70%非格式化</span></li><li><span>记录密度：盘片单位面积上记录的二进制信息量，一般以道密度、位密度和面密度表示，道密度是单位长度上的磁道数，位密度是磁道单位长度记录的二进制代码位数，面密度是两者乘积（一般靠内的位密度大)。</span></li><li><span>平均存取时间：=寻道时间+旋转延迟时间+传输时间。</span></li><li><span>数据传输零率：转数r，每条磁道容量位N，传输率就是r*N=Dr。</span></li></ol><p><span>磁盘地址：驱动器号、柱面号（磁道号）、盘面号、扇区号。</span></p><p><span>工作过程：寻址、读盘、写盘，每个操作都对应一个控制字，机械式串行部件，不能同时读写或同时读写多个数据。</span></p></blockquote><p><span>磁记录原理：一般采用FM和MFM（改进型调频制）记录。</span></p><p><span>磁盘阵列：</span></p><ol start='' ><li><span>RAID0：无冗余无校验，提高数据存储速度，扩大容量</span></li><li><span>RAID1：镜像磁盘阵列，两个磁盘同时读写互为备份，</span></li><li><span>RAID2：海明码纠错</span></li><li><span>RAID3：位交叉奇偶校验</span></li><li><span>RAID4：块交叉</span></li><li><span>RAID5：无独立的奇偶检验</span></li></ol><p><span>//光盘：利用光学原理读写信息，密度高，携带方便，成本低容量大存储期限长容易保存。</span></p><p><span>固态硬盘：Flash组成。</span></p><h2><a name="三io接口io控制器" class="md-header-anchor"></a><span>(三)I/O接口(I/O控制器)</span></h2><p><span>I/O接口是主机和外设之间的交接界面，通过接口可以实现信息交换。</span></p><h3><a name="1io接口的功能和基本结构" class="md-header-anchor"></a><span>1、I/O接口的功能和基本结构</span></h3><h4><a name="功能-n1194" class="md-header-anchor"></a><span>功能：</span></h4><ol start='' ><li><span>通信联络控制：时序协调（协调不同速度）</span></li><li><span>地址译码和设备选择</span></li><li><span>数据缓冲</span></li><li><span>信号格式转换</span></li><li><span>传送控制命令和状态信息。</span></li></ol><p><span>分类：并行、串行；程序查询、程序中断、DMA；可编程、不可编程接口。</span></p><h4><a name="结构-n1207" class="md-header-anchor"></a><span>结构：</span></h4><p><span>内部接口：面向系统，并行，有数据线、地址线、命令线、状态线。</span></p><p><span>外部接口：面向设备，可能是串行也可能是并行。</span></p><p><span>设备选择电路；</span></p><p><span>命令寄存器和命令译码器；</span></p><p><span>控制逻辑电路；</span></p><p><span>数据缓冲寄存器（DBR）；</span></p><p><span>设备状态标记；</span></p><h3><a name="2io端口及其编址" class="md-header-anchor"></a><span>2、I/O端口及其编址</span></h3><p><span>端口就是接口电路中，可以被CPU直接访问的寄存器，主要有数据端口、状态端口（只读）和控制端口（只写），I/O端口需要被CPU访问，就需要对每个端口编号，每个端口对应一个地址。方式有两种：</span></p><ol start='' ><li><span>统一编制，存储器映射方式，把I/O端口当作存储器的单元进行地址分配，不需要专门的I/O指令，可以用统一的访存命令访问。优点：不需要专门指令，操作灵活方便，编制空间大；缺点：专用内存地址，使内存容量变少，利用存储器编制进行输入输出执行速度较慢。</span></li><li><span>独立编址，I/O映射方式，I/O端口的地址空间和主存的地址空间是两个独立的地址空间，需要专门的I/O指令来访问呢，优点：程序清晰便于理解；缺点：指令少，一般只能传送，需要存储器读写和I/O设备读写两组信号，增加控制的复杂性。</span></li></ol><h2><a name="四io方式" class="md-header-anchor"></a><span>(四)I/O方式</span></h2><h3><a name="1程序查询方式" class="md-header-anchor"></a><span>1、程序查询方式</span></h3><p><span>信息交换的控制完全由主机执行程序实现，接口中设置一个数据缓冲寄存器和设备状态寄存器。一旦启动就必须停止现行程序，并在现行程序中插入一段，CPU“踏步”等待，CPU和外设串行工作，接口设计简单，设备量少，但是CPU花了很多时间查询等待，而且在一段时间内只能和一台外设交换信息，效率太低。</span></p><blockquote><p><span>工作流程</span></p><ol start='' ><li><span>CPU执行初始化程序，预置传送参数</span></li><li><span>向I/O接口发出命令，启动I/O设备</span></li><li><span>向外设接口读取状态信息</span></li><li><span>CPU不断查询等待，直到外设准备就绪（浪费CPU大量时间）</span></li><li><span>传送一次数据</span></li><li><span>修改地址和计数器参数</span></li><li><span>判断传送是否结束，若未结束，跳转到第三步，直到计数器为0。</span></li></ol></blockquote><h3><a name="2程序中断方式" class="md-header-anchor"></a><span>2、程序中断方式</span></h3><p><span>中断是现代计算机提高效率的一个十分重要的功能，CPU中通常设有处理中断的机构，中断系统。</span></p><h4><a name="中断的基本概念" class="md-header-anchor"></a><span>中断的基本概念;</span></h4><p><span>计算机执行程序的过程中，出现某些急需处理的异常情况或特殊请求，CPU暂停先行程序，转去处理，处理完毕后自动返回现行程序的断电，继续执行原程序。作用有：</span></p><ol start='' ><li><span>实现CPU和I/O设备并行工作</span></li><li><span>处理硬件故障和软件错误</span></li><li><span>实现人机交互</span></li><li><span>多道程序和分时操作 等。</span></li></ol><p><span>中断方式的思想：CPU中安排好某个时刻启动某台外设，外设就绪后向CPU发出中断请求，CPU在可以响应中断的条件下，转到中断服务程序，完成后再回到原程序。</span></p><h4><a name="中断响应过程" class="md-header-anchor"></a><span>中断响应过程;</span></h4><p><span>中断请求：中断源向CPU发送中断请求信号。</span></p><p><span>内中断和外中断，内中断来自处理器和内存，包括程序运算错误、指令错误、用户特权指令、用户态切换到核心态等；外中断来自处理器和内存以外的部件，狭义上一般称为中断。</span></p><p><span>硬件中断和软件中断：硬件中断指外部硬件产生的中断，一般属于外中断，软件中断指通过指令产生的中断，软件中断一定是内中断。</span></p><p><span>非屏蔽中断和可屏蔽中断：非屏蔽中断是一种硬件中断，不可屏蔽中断请求，不受中断标志位IF的影响，必须响应。可屏蔽中断也是硬件中断，通过中断请求标记触发器INTR控制，受标志位IF影响。</span></p><p><span>中断判优：通过判优逻辑确定响应哪个中断请求，可以用硬件排队器实现，也可以用软件查询程序实现。一般来说硬件故障最高优先级，其次软件中断，非屏蔽高于屏蔽，DMA高于I/O设备，高速设备优于低速设备，输入优于输出，实时设备优于普通设备。</span></p><p><span>CPU响应中断的条件：1.中断源有中断请求；2.CPU允许中断和开中断；3.一条指令执行完毕，且没有更紧迫的任务。</span></p><p><span>中断隐指令：硬件直接实现的操作，不是真正的指令，没有操作码，用户完全透明，主要包括关中断（停止中断），保存断点（保存PC内容）和引出中断服务程序（将入口地址传到PC）。</span></p><p><span>中断向量：即中断服务程序的入口地址，中断向量一般存储在存储器一部分，这部分成为中断向量表，中断向量地址是中断服务程序入口地址的地址。</span></p><h4><a name="中断处理过程" class="md-header-anchor"></a><span>中断处理过程;</span></h4><ol start='' ><li><span>关中断：首先保护现场，在这一过程中，不能响应任何中断，否则现场不完整。</span></li><li><span>保存断点：可以压入堆栈或主存特定位置，包括PC中的地址、PSW等信息。</span></li><li><span>识别中断源（引出中断服务程序）：有硬件向量法和软件查询法两种，硬件产生中断向量地址，由中断向量地址找到中断服务程序入口地址，硬件产生的实际是中断类型，由类型号指出向量地址。软件则直接查询入口地址。</span></li><li><span>保存现场和屏蔽字</span></li><li><span>开中断：允许更高级中断请求，实现嵌套</span></li><li><span>执行中断服务程序</span></li><li><span>关中断：保证恢复现场时不被中断</span></li><li><span>恢复现场和屏蔽字</span></li><li><span>开中断，中断返回，继续执行原程序。</span></li></ol><p><strong><span>前三步由中断隐指令（硬件）执行，4-9由中断服务程序完成。中断返回由中断服务程序的最后一条中断返回指令完成。</span></strong></p><h4><a name="多重中断和中断屏蔽的概念" class="md-header-anchor"></a><span>多重中断和中断屏蔽的概念。</span></h4><p><span>多重中断即中断嵌套。每个中断源都有屏蔽触发器，1表示屏蔽，所有屏蔽字触发器组合在一起构成屏蔽字寄存器，其内容称为屏蔽字。</span></p><h3><a name="3dma方式" class="md-header-anchor"></a><span>3、DMA方式</span></h3><p><span>完全由硬件进行成组信息传送的控制方式，具有程序中断的优点，（CPU和外设并行工作）。DMA在外设和主存之间开辟“直接数据通道”，让信息不再经过CPU，降低了CPU在传送数据的开销，称为直接存储器存取方式。适合硬盘等高度设备大批量数据传送，硬件开销大。</span></p><h4><a name="特点-n1290" class="md-header-anchor"></a><span>特点：</span></h4><ol start='' ><li><span>使主存和CPU的固定关系脱钩，主存既可以被CPU也可以被外设访问</span></li><li><span>数据块传送时，主存地址的确定、传送数据计数都由硬件电路实现</span></li><li><span>主存中要开辟专用缓冲块，供给和接受外设数据</span></li><li><span>DMA传送速度快，并行工作，提高效率</span></li><li><span>传送开始前通过程序进行预处理，结束后用中断方式进行后处理。</span></li></ol><p>&nbsp;</p><h4><a name="dma控制器的组成" class="md-header-anchor"></a><span>DMA控制器的组成</span></h4><p><span>主要功能：</span></p><ol start='' ><li><span>接受外设DMA请求，向CPU发出总线请求。</span></li><li><span>CPU响应总线请求后，发出总线响应信号，接管总线控制权，进入DMA操作周期</span></li><li><span>确定传送数据的主存单元地址和长度，自动修改主存地址计数和传送长度计数。</span></li><li><span>规定数据在主存和外设间的传送方向，发出读写控制信号，执行数据传送操作。</span></li><li><span>向CPU报告DMA操作的结束。</span></li></ol><p><span>DMA控制器主要结构：</span></p><p><span>主存地址计数器：存放交换数据的主存地址。</span></p><p><span>传送长度计数器：记录传送数据的长度，计数器溢出时传送完毕，自动发送中断请求信号。</span></p><p><span>数据缓冲寄存器。</span></p><p><span>DMA请求触发器：每当I/O准备好数据后，给出控制信号使DMA请求触发器置位。</span></p><p><span>”控制/状态“逻辑：由控制和时序电路及状态标志位组成，用于指定传送方向、修改参数、对DMA请求和CPU响应信号进行协调同步。</span></p><p><span>中断机构：数据块传输完毕后，触发中断机构，向CPU提出中断请求。</span></p><p><span>在DMA传送过程中，接管地址总线、数据总线和控制总线，CPU的主存控制信号被禁止使用，DMA控制器具有控制系统总线的权力。</span></p><h4><a name="主存使用方式" class="md-header-anchor"></a><span>主存使用方式：</span></h4><ol start='' ><li><span>停止CPU访问主存：CPU基本处于不工作状态，在DMA传送结束后，DMA接口通知CPU可以使用主存，并把总线控制权还给CPU。</span></li><li><span>DMA和CPU交替访存：在CPU工作周期比主存存取周期长的情况下，将CPU工作周期划为两个周期，其中一部分专供DMA访存，一部分专供CPU。不需要总线使用权的申请归还，总线的控制权是通过C1C2分时控制的。</span></li><li><span>周期挪用（周期窃取：在DMA请求的三种情况下，如果CPU没有访存，不产生冲突，CPU正在访存，则必须等到存取周期结束，如果同时请求访存，则CPU暂时放弃总线占有，由DMA挪用一个或几个存取周期。</span></li></ol><p>&nbsp;</p><p><span>####DMA传送过程。</span></p><ol start='' ><li><span>预处理。CPU完成一些准备工作，如执行I/O指令测试I/O设备状态，向DMA寄存器设置初值、传送方向，启动设备等。然后CPU继续执行原有程序，直到I/O设备准备好后，向DMA控制器发送DMA请求，再由DMA控制器向CPU发送总线请求，开始传送数据。</span></li><li><span>数据传送：传输可以以字节（或字）为基本单位，也可以以数据块为基本单位，数据输入输出操作一般通过循环实现，循环由DMA控制器实现。</span></li><li><span>后处理：DMA控制器向CPU发送中断请求，CPU执行中断服务程序做DMA结束处理，包括数据校验、检查传送过程是否出错，决定是否继续用DMA传送其他数据等。</span></li></ol><h4><a name="dma和中断的区别" class="md-header-anchor"></a><span>DMA和中断的区别：</span></h4><ol start='' ><li><span>中断是程序间切换，需要保护和恢复现场，DMA除了预处理和后处理，不占用CPU资源。</span></li><li><span>对中断请求的响应只能在每条指令执行结束后，而对DMA请求的响应可以发生在每个机器周期结束时，只要CPU不占用总线就可以响应。</span></li><li><span>中断传送过程需要CPU干预，DMA不需要，所以数据传输率高，适合高速外设的成组数据传送</span></li><li><span>DMA请求的优先级高于中断请求。</span></li><li><span>中断方式具有异常处理能力，而DMA仅限于传送数据块的I/O操作。</span></li><li><span>中断方式靠程序传送数据，而DMA方式靠硬件传送。</span></li></ol></div>
</body>
</html>