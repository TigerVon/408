<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>计算机网络</title><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; tab-size: 4; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 40px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
.typora-export .task-list-item input { pointer-events: none; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }
button, input, select, textarea { color: inherit; font: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror-linenumber { user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  html.blink-to-pdf { font-size: 13px; }
  .typora-export #write { break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.html-for-mac .inline-math-svg .MathJax_SVG { vertical-align: 0.2px; }
.md-math-block .MathJax_SVG_Display { text-align: center; margin: 0px; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; overflow-y: hidden; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: var(--monospace); }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: 400; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; overflow-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none 0s ease 0s; }
.MathJax_SVG_Display svg { vertical-align: middle !important; margin-bottom: 0px !important; margin-top: 0px !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
svg[id^="mermaidChart"] { line-height: 1em; }
mark { background: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
mark .md-meta { color: rgb(0, 0, 0); opacity: 0.3 !important; }
@media print {
  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }
  .typora-export h1::after, .typora-export h2::after, .typora-export h3::after, .typora-export h4::after, .typora-export h5::after, .typora-export h6::after { content: ""; display: block; height: 100px; margin-bottom: -100px; }
}


:root {
  /* dark color for background*/
  /* default color */
  --bg-color1: rgb(40, 44, 52);
  /* for most panel, context, header, etc */
  --bg-color2: rgb(33, 37, 43);
  /* for toc and table edit panel */
  --bg-color3: rgba(16, 17, 20, 0.5);
  /* for tips */
  --bg-color4: black;
  /* for blockquote, codeblock, input, etc */
  --bg-color5: rgb(29, 31, 35);
  /* light color for text and icon*/
  /* default color */
  --text-color1: rgb(170, 178, 180);
  /* for text on panel */
  --text-color2: rgb(220, 220, 220);
  /* for checkbox and radio */
  --text-color3: hsl(192, 6%, 40%);
  /* for tips */
  --text-color4: white;
  /* for focus mode */
  --text-color5: rgba(170, 178, 180, 0.5);
  /* link color */
  --link-color: rgb(197, 202, 210);
  /* table color */
  --table-border-color: rgb(100, 104, 116);
  --table-thead-color: rgb(31, 35, 40);
  --table-bg-color: rgb(40, 45, 52);
  --table-bg-darker-color: rgb(35, 40, 46);
  /* hover color */
  /* default hover background color */
  --hover-bg-color1: rgb(62, 66, 73);
  /* for input item */
  --hover-bg-color2: hsl(220, 9%, 14%);
  /* for button on toc and table edit panel */
  --hover-bg-color3: rgba(62, 66, 73, 0.8);
  /* default hover text color */
  --hover-text-color: white;
  /* active color */
  --active-color: var(--hover-bg-color1);
  /* input color */
  --input-color: rgb(29, 31, 35);
  /* menu divider color */
  --menu-divider-color: rgb(95, 97, 101);
  /* scrollbar color */
  --scrollbar-thumb-color: var(--menu-divider-color);
  --scrollbar-track-color: rgba(95, 97, 101, 0.3);
  /* theme select color */
  --theme-select-color: rgba(255, 255, 255, 0.5);
  --button-color: rgb(62, 66, 73);
  --select-color: rgb(33, 37, 43);
  /* focus color */
  --focus-color: rgba(100, 100, 100, 0.8);
  --focus-ring-color: var(--focus-color);
  /* codeblock color */
  --code-red-color: rgb(221, 110, 115);
  --code-yellow-color: rgb(218, 192, 123);
  --code-cyan-color: rgb(86, 182, 194);
  --code-blue-color: rgb(94, 174, 237);
  --code-purple-color: rgb(195, 115, 215);
  --code-orange-color: rgb(221, 153, 103);
  --code-grey-color: rgb(127, 132, 142);
  --code-green-color: rgb(152, 195, 123);
  --code-select-bg-color: rgb(64, 72, 89);
  --code-cursor-color: rgb(82, 139, 255);
  /* implicit selecttion text bg color */
  --select-text-bg-color: rgb(150, 156, 170);
  /* implicit button color */
  --primary-color: var(--button-color);
  --primary-btn-border-color: transparent;
  --primary-btn-text-color: var(--text-color2);
  /* implicit sidebar color */
  --side-bar-bg-color: var(--bg-color2);
  --control-text-color: var(--text-color2);
  /* implicit text color */
  --text-color: var(--text-color1);
  /* implicit background color for setting menu */
  --bg-color: var(--bg-color1);
  /* implicit hover color */
  --item-hover-bg-color: var(--hover-bg-color1);
  --item-hover-text-color: var(--hover-text-color);
  /* implicit active color */
  --active-file-bg-color: var(--hover-bg-color);
  /* implicit mathjax edit panel background color */
  --rawblock-edit-panel-bd: var(--bg-color5);
  /* implicit focus mode color */
  --blur-text-color: var(--text-color5);
  /* implicit search result select color */
  --search-select-bg-color: var(--select-text-bg-color);
  --search-select-bg-color: rgb(56, 71, 95);

  --control-text-hover-color: var(--hover-text-color);
  /* implicit active file color in sidebar file menu treeview */
  --active-file-text-color: var(--hover-text-color);
  --active-file-border-color: var(--hover-text-color);

  --node-border: var(--menu-divider-color);
  --node-fill: var(--bg-color2);
}

/* font */
/* basic style */
html {
  font-size: 16px;
}

body {
  font-family: "Open Sans", "Clear Sans", "Helvetica Neue", Helvetica, Arial,
    sans-serif;
  color: var(--text-color1);
  background: var(--bg-color1);
  line-height: 1.6;
}

/* text selection background color */
.in-text-selection {
  background-color: rgb(64, 72, 89);
}

/* link */
#write a:not([role="menuitem"]) {
  color: var(--link-color) !important;
}

#write a:not([role="menuitem"]):hover {
  color: var(--hover-text-color) !important;
}

/* h1-h6 */
#write h1,
#write h2,
#write h3,
#write h4,
#write h5,
#write h6 {
  margin-top: 0.5em;
  margin-bottom: 0em;
  line-height: 1em;
}

#write h1 {
  font-size: 2.5em;
  padding-bottom: 0.5em;
  border-bottom: 5px double var(--text-color1);
}

#write h1:before {
  content: "\00A7  ";
}

#write h2 {
  font-size: 2em;
  padding-bottom: 0.5em;
  border-bottom: 3px double var(--text-color1);
}

#write h2:before {
  content: "\00A7  ";
}

#write h3 {
  font-size: 1.75em;
  padding-bottom: 0.5em;
  border-bottom: 1px solid var(--text-color1);
}

#write h4 {
  font-size: 1.55em;
}

#write h5 {
  font-size: 1.35em;
}

#write h6 {
  font-size: 1.2em;
}

/* horizontal divider */
hr {
  height: 2px;
  background-color: var(--text-color1);
  border: 0px;
}

/* list */
ul,
ol {
  padding-left: 30px;
}

/* blockquote */
blockquote {
  border-left: 4px solid var(--text-color1);
  padding: 4px 15px;
  color: var(--text-color1);
  background-color: var(--bg-color5);
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
}

blockquote blockquote {
  padding-right: 0em;
}

/* table */
.md-table-fig,
.md-table-fig:active {
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
}

.md-table thead tr {
  background-color: var(--table-thead-color);
}

.md-table tr th {
  font-weight: bold;
  border-left: 1px solid var(--table-border-color);
  border-right: 1px solid var(--table-border-color);
  text-align: left;
  margin: 0;
  padding: 6px 13px;
}

.md-table tbody tr {
  border-top: 1px solid var(--table-border-color);
  margin: 0;
  padding: 0;
}

.md-table tbody tr:nth-child(2n) {
  background-color: var(--table-bg-darker-color);
}

.md-table tbody tr:nth-child(2n + 1) {
  background-color: var(--table-bg-color);
}

.md-table tr td {
  border-left: 1px solid var(--table-border-color);
  border-right: 1px solid var(--table-border-color);
  text-align: left;
  margin: 0;
  padding: 6px 13px;
}

.md-table tr th:first-child,
.md-table tr td:first-child {
  border-left-width: 0px;
}

.md-table tr th:last-child,
.md-table tr td:last-child {
  border-right-width: 0px;
}

/* table edit panel */
.ty-table-edit {
  background-color: var(--bg-color3);
  border: 0px;
  border-radius: 6px;
  padding-top: 2px;
  padding-bottom: 2px;
  padding-left: 6px;
  padding-right: 6px;
  margin-top: -29px !important;
}

/* button on table edit panel */
.ty-table-edit button {
  background-color: transparent;
  color: var(--text-color2);
  border: 0px;
  margin-left: 0px !important;
}

/* button hover on table edit panel */
.ty-table-edit button:hover {
  background-color: var(--hover-bg-color3);
  color: var(--hover-text-color);
}

/* adjusting table panel */
.popover {
  background-color: var(--bg-color2);
  box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.5);
}

/* arrow of adjusting table panel */
.popover.bottom > .arrow:after {
  border-bottom-color: var(--bg-color2);
}

/* divider in adjust table panel */
.md-grid-board-wrap .popover-title {
  border-top-color: var(--menu-divider-color);
}

/* grid size */
.md-grid-board a {
  width: 15px;
  height: 15px;
}

/* existing thread grid */
.md-grid-board tr[row="1"] .md-grid-ext {
  background-color: rgb(60, 60, 60);
}

/* not existing thread grid */
.md-grid-board tr[row="1"] {
  background-color: rgb(220, 220, 220);
}

/* existing grid */
.md-grid-board .md-grid-ext {
  background-color: rgb(120, 120, 120);
}

/* selected thread grid */
.md-grid-board tr[row="1"] a.md-active,
.md-grid-board tr[row="1"] a:hover {
  background-color: rgb(60, 60, 60);
}

/* selected grid */
.md-grid-board a.md-active,
.md-grid-board a:hover {
  border-color: var(--menu-divider-color);
  background-color: rgb(120, 120, 120);
}

/* task */
.md-task-list-item > input {
  margin-left: -1.3em;
}

/* footnote */
sup.md-footnote {
  color: var(--text-color1);
  background-color: var(--bg-color2);
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
}

/* mathjax */
/* .mathjax-block>.code-tooltip {
    bottom: .375rem;
}
.md-mathjax-midline {
    background: #fafafa;
} */
.md-inline-math script {
  color: var(--text-color1);
}

.md-rawblock > .md-rawblock-container {
  transition: 0.5s;
}

.md-rawblock > .md-rawblock-tooltip {
  transition: 0.5s;
  display: block;
  visibility: hidden;
  opacity: 0;
}

.md-rawblock:hover > .md-rawblock-tooltip {
  transition: 0.5s;
  visibility: visible;
  opacity: 1;
  animation: none;
}

/* meta information of image */
.md-image > .md-meta {
  border: 0px;
  padding: 2px 0px 0px 4px;
  font-size: 0.9em;
  color: var(--text-color1);
}

/* input */
input {
  background-color: var(--input-color) !important;
  border: 0px !important;
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
}

/* input hover */
/* input:hover {
    background-color: var(--hover-bg-color2) !important;
} */
/* checkbox */
input[type="checkbox"]:before {
  content: "";
  display: inline-block;
  width: 1.1rem;
  height: 1.1rem;
  vertical-align: middle;
  text-align: center;
  border: 0px;
  border-radius: 3px;
  background-color: var(--input-color);
  margin-top: -0.5rem;
  margin-left: -0.1rem;
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
}

/* checkbox hover */
input[type="checkbox"]:not([disabled]):not(:checked):hover:before {
  content: "\2713";
  font-size: 0.9rem;
  line-height: 1.2rem;
  color: var(--text-color3);
}

/* checkbox checked*/
input[type="checkbox"]:checked:before {
  content: "\2713";
  font-size: 0.9rem;
  line-height: 1.2rem;
  color: var(--text-color2);
}

/* checkbox checked hover*/
input[type="checkbox"]:checked:hover:before {
  content: "\2713";
  font-size: 0.9rem;
  line-height: 1.2rem;
  color: var(--hover-text-color);
}

/* radio */
input[type="radio"]:before {
  content: "";
  display: inline-block;
  width: 1.1rem;
  height: 1.1rem;
  vertical-align: middle;
  text-align: center;
  border: 0px;
  border-radius: 0.55rem;
  background-color: var(--input-color);
  margin-top: -0.4rem;
  margin-left: -0.1rem;
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
}

/* radio hover */
input[type="radio"]:not([disabled]):not(:checked):hover:before {
  content: "\25CF";
  font-size: 1rem;
  line-height: 1rem;
  color: var(--text-color3);
}

/* radio checked */
input[type="radio"]:checked:before {
  content: "\25CF";
  font-size: 1rem;
  line-height: 1rem;
  color: var(--text-color2);
}

/* radio checked hover*/
input[type="radio"]:checked:before {
  content: "\25CF";
  font-size: 1rem;
  line-height: 1rem;
  color: var(--hover-text-color);
}

/* default focus style */
:focus {
  outline-color: var(--focus-color);
}

/* exit source view button */
.typora-sourceview-on #toggle-sourceview-btn {
  background-color: var(--bg-color2);
}

.typora-sourceview-on #toggle-sourceview-btn:hover {
  background-color: var(--hover-bg-color1);
}

/* shadow for image item*/
.md-image img {
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
}

/* toc */
.md-toc {
  background-color: var(--bg-color3);
  border-radius: 6px;
  padding: 0px 0px 0px 0px;
  margin: 0px 0px 0px 0px;
  border: 0px;
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
}

/* toc content */
.md-toc-content {
  padding-top: 5px;
  padding-bottom: 8px;
  margin-top: 15px;
  margin-bottom: 0px;
}

/* remove outline when toc is selected */
.md-toc:focus .md-toc-content {
  border: 0px;
  margin: 0px;
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
}

/* toc item */
.md-toc-item {
  margin: 2px;
}

/* toc edit panel */
#write div.md-toc-tooltip {
  border: 0px;
  padding-left: 10px;
  padding-right: 10px;
  background-color: var(--bg-color3);
  border-top-left-radius: 6px;
  border-top-right-radius: 6px;
  opacity: 0;
  visibility: hidden;
  display: block !important;
  transition: 0.3s;
}

#write .md-toc:focus div.md-toc-tooltip {
  visibility: visible;
  opacity: 1;
}

#write .md-toc:focus {
  border-top-left-radius: 0px;
  border-top-right-radius: 0px;
}

/* toc delete button */
.md-delete-toc {
  background-color: transparent;
}

/* html block */
.md-htmlblock:hover .md-htmlblock-container {
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
  border-radius: 6px;
  border-top-right-radius: 0px;
}

/* search panel */
#md-searchpanel {
  background-color: var(--bg-color2);
  color: var(--text-color2);
  box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.5);
}

/* ignore case button and find whole word button */
.searchpanel-search-option-btn {
  border: 0px;
}

/* button on search panel */
#md-searchpanel .btn:hover {
  color: var(--hover-text-color);
  background-color: var(--hover-bg-color1) !important;
}

/* remove shadow around input in search panel*/
#md-searchpanel input {
  box-shadow: none;
}

/* search option button hover */
.searchpanel-search-option-btn:not(.active):hover {
  color: var(--hover-text-color);
  background-color: var(--hover-bg-color1);
}

/* close button in search panel */
#md-searchpanel .input-group-addon.close-btn {
  padding-left: 16px;
  padding-right: 16px;
}

/* replaceall button */
.ty-replace-panel-row #search-panel-replaceall-btn {
  padding-left: 8px;
  padding-right: 6px !important;
}

/* replace button */
.ty-replace-panel-row #search-panel-replace-btn {
  padding-left: 16px;
  padding-right: 16px;
}

/* sidebar */
.sidebar-menu {
  color: var(--text-color2);
}

/* sidebar shadow */
#typora-sidebar,
.typora-node #typora-sidebar {
  box-shadow: 3px 0px 10px rgba(0, 0, 0, 0.5);
}

/* divider between file item and search */
.ty-sidebar-search-panel {
  border-color: var(--menu-divider-color);
}

/* file item in sidebar */
#file-library .file-list-item {
  border-bottom: 0px;
  opacity: 1;
  border-left: 4px solid;
  border-color: var(--bg-color2);
}

/* file item hover */
#file-library .file-list-item:hover {
  background-color: var(--hover-bg-color1);
  color: var(--hover-text-color);
  border-color: var(--hover-bg-color1);
}

/* file item active */
#file-library .file-list-item.active {
  background-color: var(--hover-bg-color1);
  color: var(--hover-text-color);
  border-color: var(--hover-text-color);
}

/* suffix of file item*/
.file-list-item-file-ext-part {
  opacity: 0.8;
}

/* sidebar file menu */
#sidebar-files-menu {
  border: 0px;
  box-shadow: -2px -2px 10px rgba(0, 0, 0, 0.5);
}

/* sidebar file menu item */
.dropdown-menu > li > a {
  color: var(--text-color2);
}

.dropdown-menu > li > a:hover {
  color: var(--hover-text-color);
}

/* sidebar file menu close button */
#close-sidebar-menu-btn:hover {
  color: var(--hover-text-color);
}

/* sidebar file nemu divider */
#sidebar-files-menu > .show + .menuitem-group-label.show {
  border-color: var(--menu-divider-color);
}

/* sidebar osx tab */
.html-for-mac .sidebar-osx-tab > .sidebar-tabs {
  border: 0px;
  box-shadow: 0 4px 10px -5px rgba(0, 0, 0, 0.5);
}

.html-for-mac .sidebar-content {
  z-index: -1; /* so that the background doesn't overlap with the shadow */
}

/* sidebar footer */
.sidebar-footer {
  border: 0px;
  box-shadow: 0 -4px 10px -5px rgba(0, 0, 0, 0.5);
}

/* remove outline when file item in treeview is selected*/
.file-library-node:not(.file-node-root):focus > .file-node-content {
  outline: none;
}

/* sort button on sidebar file menu */
.ty-side-sort-btn.active,
.ty-side-sort-btn:hover {
  color: var(--hover-text-color);
}

/* setting */
/* header in setting */
.window-header {
  box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.5) !important;
}

/* sidebar in setting */
.sidebar {
  background-color: var(--bg-color2) !important;
  box-shadow: 3px 0px 10px rgba(0, 0, 0, 0.5);
}

.list-group-content {
  margin-left: 10px !important;
}

/* sidebar button in setting menu */
.nav-group-item {
  color: var(--text-color2) !important;
  border-top-left-radius: 6px !important;
  border-bottom-left-radius: 6px !important;
  border-top-right-radius: 0px !important;
  border-bottom-right-radius: 0px !important;
}

/* sidebar button hover in setting menu */
.nav-group-item:hover,
.nav-group-item:active,
.nav-group-item.active {
  background-color: var(--hover-bg-color1) !important;
  color: var(--hover-text-color) !important;
}

/* remove up and down button from number type input*/
input[type="number"]::-webkit-outer-spin-button,
input[type="number"]::-webkit-inner-spin-button {
  -webkit-appearance: none !important;
}

/* the indent example in setting.editor */
div.pane
  > div:nth-child(4)
  > div:nth-child(2)
  .label-input-group
  td:last-child
  div {
  border: 0px !important;
  border-radius: 6px;
  background-color: var(--bg-color5);
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
  margin: 10px !important;
}

/* button in setting menu */
.ty-preferences button.btn-default {
  border: 0px;
  background-color: var(--bg-color5);
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
  border-radius: 6px;
}

/* button hover in setting menu */
.ty-preferences .btn-default:not([disabled]):hover {
  background-color: var(--hover-bg-color1) !important;
}

/* return button in setting menu */
.window-header button:hover {
  color: var(--text-color2) !important;
}

/* search input in setting menu */
.search-input {
  border-top-left-radius: 6px !important;
  border-bottom-left-radius: 6px !important;
  border-top-right-radius: 0px !important;
  border-bottom-right-radius: 0px !important;
  margin-top: 10px !important;
  margin-bottom: 10px !important;
  margin-left: 10px !important;
}

.search-input:focus {
  border: none !important;
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2) !important;
}

/* select item (mostly in setting menu) */
select {
  border: 0px;
  border-radius: 6px;
  background-color: var(--input-color) !important;
  padding-top: 5px !important;
  padding-bottom: 5px !important;
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
}

/* enabled select item hover */
select:not([disabled]):hover {
  color: var(--text-color2);
  opacity: 1;
}

/* disabled select item hover */
select[disabled]:hover {
  opacity: 0.5;
}

/* mega menu */
.megamenu-content,
.megamenu-opened header {
  background: var(--bg-color1);
}

.megamenu-content {
  display: block;
  visibility: hidden;
  opacity: 0;
  transition: 0.3s;
}

.megamenu-opened .megamenu-content {
  visibility: visible;
  opacity: 1;
  animation: none;
}

/* mega menu sidebar*/
.megamenu-menu {
  background-color: var(--bg-color2);
  box-shadow: 3px 0px 10px rgba(0, 0, 0, 0.5);
}

/* return button in mega menu */
#megamenu-menu-sidebar .menu-style-btn {
  border: 0px;
}

/* remove divider in mega menu */
.megamenu-menu-header {
  border-color: var(--menu-divider-color);
}

/* return button color in mega menu */
.megamenu-menu-header #megamenu-menu-header-title {
  color: var(--text-color2);
}

/* return button hover in mega menu */
.megamenu-menu-header:hover {
  background-color: var(--hover-bg-color1);
}

/* return button hover in mega menu */
.megamenu-menu-header:hover #megamenu-menu-header-title {
  color: var(--hover-text-color);
}

/* long button in mega menu */
.long-btn {
  border: 0px;
  background-color: var(--bg-color5);
  color: var(--text-color1);
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
  margin-bottom: 10px;
  margin-left: 10px;
}

/* recent file in mega menu */
#recent-file-panel {
  padding: 10px;
}

#recent-document-table {
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
}

#recent-file-panel-action-btn {
  background: var(--bg-color5);
  border: 0px;
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
}

#recent-file-panel thead tr {
  background-color: var(--table-thead-color);
}

#recent-file-panel tbody tr:nth-child(2n) {
  background-color: var(--table-bg-darker-color);
}

#recent-file-panel tbody tr:nth-child(2n + 1) {
  background-color: var(--table-bg-color);
}

#recent-file-panel-action-btn:hover {
  background-color: var(--hover-bg-color1);
  color: var(--text-color2);
}

/* theme preview */
.theme-preview-div {
  box-shadow: 10px 0px 10px rgba(0, 0, 0, 0.8);
}

/* theme preview hover */
.theme-preview-div:hover {
  border-color: var(--theme-select-color);
}

/* context menu and spell check panel */
.dropdown-menu:not(.megamenu-menu-list) {
  background-color: var(--bg-color2);
  color: var(--text-color2);
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.5);
}

/* divider in context menu and spell check panel */
.dropdown-menu .divider {
  border-color: var(--menu-divider-color);
}

/* remove divider outline */
.dropdown-menu {
  border: 0px;
}

/* footer */
footer.ty-footer {
  border-top: 0px !important;
  background-color: var(--bg-color2) !important;
  /*     color: var(--text-color2); */
  box-shadow: 0px -2px 10px rgba(0, 0, 0, 0.5);
}

/* footer item */
.footer-item,
#outline-btn,
#footer-word-count {
  color: var(--text-color2);
  opacity: 1;
}

/* footer item hover */
.footer-item:hover,
#outline-btn:hover {
  background-color: var(--hover-bg-color1);
  color: var(--hover-text-color);
}

/* button on some panel */
.btn {
  border: 0px;
  outline-width: 0px !important;
}

.btn:hover {
  background-color: var(--hover-bg-color1);
  color: var(--hover-text-color);
}

/* traffic button hover */
#top-titlebar .toolbar-icon.btn:hover {
  color: var(--text-color2);
  background-color: var(--hover-bg-color1);
}

/* traffic button hover */
#top-titlebar #w-close:hover {
  background-color: #e81123 !important;
}

/* adjust maxmize restore button height */
.typora-maxmized #w-restore {
  height: 24px;
}

/* left upper button hover */
.ty-menu-btn-area:hover .ty-menu-btn-area-sub {
  color: var(--text-color2) !important;
}

/* scrollbar */
::-webkit-scrollbar {
  width: 8px;
  padding-right: 10px;
  background-color: rgba(0, 0, 0, 0);
}

/* scrollbar track */
::-webkit-scrollbar-track:hover {
  background-color: var(--scrollbar-track-color) !important;
  border-radius: 4px;
}

/* scrollbar thumb */
::-webkit-scrollbar-thumb,
::-webkit-scrollbar-thumb:active {
  background-color: var(--scrollbar-thumb-color) !important;
  border-radius: 4px;
}

/* tip when hover on a button */
#ty-tooltip {
  background-color: var(--bg-color4);
  color: var(--text-color4);
}

/* item container hover in context menu */
.menu-item-container:hover {
  background-color: var(--bg-color2);
}

/* item in context menu */
.menu-item-container .menu-style-btn {
  border-color: var(--menu-divider-color);
}

/* mathjax edit panel*/
.md-rawblock-before {
  border-top-left-radius: 6px;
}

.md-rawblock-after {
  border-bottom-left-radius: 6px;
  border-bottom-right-radius: 6px;
}

/* mathjax focus */
.MathJax_SVG:focus {
  outline: none;
  background-color: transparent;
}

/* notification panel */
#md-notification {
  background-color: var(--bg-color2) !important;
  color: var(--text-color2);
  box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.5);
}

#ty-surpress-mode-warning-close-btn {
  float: unset !important;
  margin: 0px !important;
}

.unibody-window #md-notification p {
  bottom: -4px !important;
}

/* inline codeblock */
code {
  font-size: 0.9em;
  background-color: var(--bg-color5);
  border-radius: 6px;
  padding: 4px 4px 4px 4px;
  margin: 0px 6px 0px 6px;
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
}

/* codeblock */
.md-fences,
.md-fences:active {
  background-color: var(--bg-color5);
  border-radius: 6px;
  padding: 8px 4px 8px 4px !important;
  margin-top: 15px;
  margin-bottom: 15px;
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
}

.md-fences .code-tooltip {
  display: block !important;
  visibility: hidden;
  opacity: 0;
  transition: 0.3s;
  background-color: var(--bg-color3);
}

.md-fences.md-focus .code-tooltip {
  opacity: 1;
  visibility: visible;
}

.CodeMirror-lines {
  padding-left: 4px;
}

/* selected text and cursor */
.CodeMirror-selected,
.CodeMirror-selectedtext {
  background: var(--code-select-bg-color) !important;
}

.CodeMirror div.CodeMirror-cursor {
  border-left: 2px solid var(--code-cursor-color);
  z-index: 3;
}

.CodeMirror.cm-s-typora-default div.CodeMirror-cursor {
  border-left: 3px solid var(--code-cursor-color);
}

/* highlight */
.cm-s-inner .cm-property {
  color: var(--code-blue-color) !important;
}

.cm-s-inner .cm-operator {
  color: var(--code-cyan-color) !important;
}

.cm-s-inner .cm-keyword {
  color: var(--code-purple-color) !important;
}

.cm-s-inner .cm-tag {
  color: var(--code-red-color) !important;
}

.cm-s-inner .cm-attribute {
  color: var(--code-orange-color) !important;
}

.cm-s-inner .cm-string {
  color: var(--code-green-color) !important;
}

.cm-s-inner .cm-comment,
.cm-s-inner.cm-comment {
  /*     color: var(--code-orange-color) !important; */
  color: var(--code-grey-color) !important;
  font-style: italic;
}

.cm-s-inner .cm-header,
.cm-s-inner .cm-def,
.cm-s-inner.cm-header,
.cm-s-inner.cm-def {
  /*     color: var(--code-red-color) !important; */
  color: var(--code-blue-color) !important;
}

.cm-s-inner .cm-meta,
.cm-s-inner .cm-qualifier {
  color: var(--code-red-color) !important;
}

.cm-s-inner .cm-builtin {
  /*     color: var(--code-blue-color) !important; */
  color: var(--code-cyan-color) !important;
}

.cm-s-inner .cm-bracket {
  color: var(--text-color1) !important;
}

.cm-s-inner .cm-number {
  color: var(--code-orange-color) !important;
}

.cm-s-inner .cm-variable {
  color: var(--text-color1) !important;
}

.cm-s-inner .cm-variable-2 {
  /*     color: var(--code-blue-color) !important; */
  color: var(--code-yellow-color) !important;
}

.cm-s-typora-default .cm-header,
.cm-s-typora-default .cm-property {
  color: var(--code-red-color) !important;
}

.cm-s-typora-default .cm-string {
  /*     color: var(--code-blue-color); */
  color: var(--code-purple-color);
}

.cm-s-typora-default .cm-atom {
  color: var(--code-grey-color);
  font-style: italic;
}

.cm-s-typora-default .cm-number {
  color: var(--code-orange-color);
  font-style: normal !important;
}

.cm-s-typora-default .cm-link {
  color: var(--code-blue-color);
}

.cm-s-typora-default .CodeMirror-activeline-background {
  background: var(--hover-bg-color1);
}

.cm-s-typora-default .cm-comment,
.cm-s-typora-default .cm-code {
  color: var(--code-purple-color);
}

.cm-s-typora-default .cm-tag {
  /*     color: var(--code-red-color); */
  color: var(--code-blue-color);
}

.cm-s-typora-default .cm-strong,
.cm-s-typora-default .cm-em,
.cm-s-typora-default .cm-del {
  /*     color: var(--code-green-color); */
  color: var(--code-orange-color);
}

.cm-s-typora-default .cm-block-start.cm-variable-2 {
  /*     color: var(--code-orange-color); */
  color: var(--code-red-color);
}

.cm-formatting-task .cm-formatting-task {
  color: var(--code-red-color);
}

/* math formula tag */
.cm-s-inner .cm-atom,
.cm-s-inner.cm-atom {
  color: var(--code-blue-color);
}

/* inline codeblock in source mode */
.cm-s-typora-default .cm-comment {
  color: var(--code-green-color);
}

/* horizontal divider when language is markdown */
.cm-s-inner .cm-hr {
  color: var(--text-color1);
}

/* variable type when language is c/cpp */
.cm-s-inner .cm-variable-3 {
  color: var(--code-purple-color);
}

/* unknown highlight keyword */
.cm-s-inner .cm-quote,
.cm-s-inner.cm-quote {
  color: #57ac57;
}

.cm-s-inner .cm-link {
  color: var(--code-blue-color);
}

.cm-s-inner .cm-negative {
  color: #d95050;
}

.cm-s-inner .cm-positive {
  color: #50e650;
}

.cm-s-inner .cm-string-2 {
  color: #f50;
}

.CodeMirror-gutters {
  border-right: none;
}

/* focus mode */
.on-focus-mode .md-end-block:not(.md-focus) .md-toc-item {
  opacity: 0.5;
}

.on-focus-mode #write h1:not(.md-focus):before {
  opacity: 0.5;
}

.on-focus-mode #write h2:not(.md-focus):before {
  opacity: 0.5;
}

.on-focus-mode #write h1:not(.md-focus) {
  border-color: var(--text-color5);
}

.on-focus-mode #write h2:not(.md-focus) {
  border-color: var(--text-color5);
}

.on-focus-mode #write h3:not(.md-focus) {
  border-color: var(--text-color5);
}

/* YAML block */
pre.md-meta-block,
pre.md-meta-block:active {
  background-color: var(--bg-color5);
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
  border-radius: 6px;
  padding: 10px;
  padding-left: 20px;
  padding-right: 20px;
}

/* switch between different mode */
#typora-source {
  display: block !important;
  visibility: hidden;
  opacity: 0;
  transition: 0.3s;
}

.typora-sourceview-on #typora-source {
  visibility: visible;
  opacity: 1;
}

#typora-source .CodeMirror-lines {
  max-width: 1200px;
  padding-left: 70px;
  padding-right: 70px;
}

#write {
  display: block !important;
  visibility: visible;
  opacity: 1;
  transition: 0.3s;
  max-width: 1200px;
  padding-left: 70px;
  padding-right: 70px;
}

.typora-sourceview-on #write {
  visibility: hidden;
  opacity: 0;
}

/* #md-searchpanel {
    visibility: hidden;
    opacity: 0;
    transition: 0.3s !important;
}

.on-search-panel-open #md-searchpanel {
    visibility: visible;
    opacity: 1;
} */

.uni-preference-panel {
  display: block;
  visibility: hidden;
  opacity: 0;
  transition: 0.3s;
}

.show-preference-panel .uni-preference-panel {
  visibility: visible;
  opacity: 1;
}

/* quick open menu */
.typora-quick-open-item:hover {
  background-color: var(--hover-bg-color1);
  color: var(--hover-text-color);
}

/* insert table panel */
.modal-content {
  border: 0px;
  border-radius: 6px;
}

.modal-content .btn-primary {
  background-color: var(--hover-bg-color1);
  color: var(--text-color1);
  outline-width: 0px;
}

.modal-content .btn-primary:hover {
  color: var(--hover-text-color);
}

.modal-content .form-control,
.modal-content .form-control:focus {
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
}

.modal-backdrop {
  background-color: black;
  opacity: 0.3 !important;
}

/* zoom  */
#zoom-hint #zoom-hint-reset {
  color: var(--text-color1);
}

#zoom-hint .zoom-hint-button:hover {
  color: var(--hover-text-color) !important;
}

/* word count */
#footer-word-count-info {
  display: block;
  visibility: hidden;
  opacity: 0;
  transition: 0.3s;
}

.ty-show-word-count #footer-word-count-info {
  visibility: visible;
  opacity: 1;
}

/* spell check */
#spell-check-panel {
  display: block;
  visibility: hidden;
  opacity: 0;
  transition: 0.3s;
}

.ty-show-spell-check #spell-check-panel {
  visibility: visible;
  opacity: 1;
}

/* search result */
.md-search-select {
  border: 2px solid rgb(69, 125, 255);
  box-sizing: content-box;
  color: var(--text-color1) !important;
}

.md-search-hit {
  background-color: var(--search-select-bg-color);
}

/* search panel message */
#searchpanel-msg {
  background-color: var(--bg-color2);
  color: var(--text-color2);
}

.searchpanel-msg-btn:hover {
  background-color: var(--hover-bg-color1);
  color: var(--hover-text-color);
}

/* language selection for codeblock */
.auto-suggest-container {
  border: 0px;
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
  background-color: var(--bg-color2);
}

/* sidebar outline item hover and active */
.outline-item:hover {
  color: var(--hover-text-color);
}

.outline-label:hover {
  text-decoration: none;
}

.pin-outline .outline-active {
  color: var(--hover-text-color);
}

/* sidebar title hover */
.info-panel-tab:hover {
  color: var(--hover-text-color) !important;
}

/* active file in sidebar file menu treeview */
.file-tree-node.active > .file-node-background {
  background-color: var(--hover-bg-color1);
}

/* hover file in sidebar file menu treeview */
.file-node-content:hover {
  cursor: pointer;
}

/* saved button in megamenu */
#m-saved:hover {
  background-color: var(--bg-color2);
  color: var(--text-color2);
  cursor: default;
}

/* mermaid sequence*/
text.actor {
  fill: var(--text-color1);
}

.labelText {
  fill: var(--text-color1);
}

.loopText {
  fill: var(--text-color1);
}

/* mermaid flowchart */
.node rect,
.node circle,
.node ellipse,
.node polygon {
  fill: var(--bg-color2);
  stroke: var(--text-color1);
  stroke: var(--menu-divider-color);
}

.edgePath .path {
  stroke: var(--menu-divider-color);
}

.label {
  color: var(--text-color1);
}

/* mermaid gantt */
.titleText {
  fill: var(--text-color1);
}

.section0,
.section2 {
  fill: var(--table-thread-color);
}

.section1,
.section3 {
  fill: var(--table-bg-color);
}

.task0,
.task1,
.task2,
.task3 {
  fill: rgb(80, 84, 90);
  stroke: rgb(80, 84, 90);
}

.taskText0,
.taskText1,
.taskText2,
.taskText3 {
  fill: var(--text-color2) !important;
}

.active0,
.active1,
.active2,
.active3 {
  fill: rgb(100, 104, 110);
  stroke: rgb(100, 104, 110);
}

.activeText0,
.activeText1,
.activeText2,
.activeText3 {
  fill: var(--text-color2) !important;
}

.done0,
.done1,
.done2,
.done3 {
  fill: rgb(48, 51, 58);
  stroke: rgb(48, 51, 58);
}

.crit0,
.crit1,
.crit2,
.crit3 {
  fill: rgb(150, 150, 150);
  stroke: var(--text-color1);
}

.activeCrit0,
.activeCrit1,
.activeCrit2,
.activeCrit3 {
  fill: rgb(100, 104, 110);
  stroke: var(--text-color1);
}

.doneCrit0,
.doneCrit1,
.doneCrit2,
.doneCrit3 {
  fill: rgb(48, 51, 58);
  stroke: var(--text-color1);
}

.taskTextOutside0,
.taskTextOutside2,
.taskTextOutside1,
.taskTextOutside3 {
  fill: var(--text-color1) !important;
}

.grid text {
  fill: white;
}

.today {
  stroke: var(--text-color1);
}

/* flow diagram */
.md-fences[lang="flow"] .md-diagram-panel-preview rect {
  fill: var(--bg-color2);
  stroke: var(--menu-divider-color);
  stroke-width: 1.2;
}

.md-fences[lang="flow"] .md-diagram-panel-preview path {
  stroke: var(--menu-divider-color);
  stroke-width: 1.2;
}

.md-fences[lang="flow"] #cond {
  fill: var(--bg-color2);
}

/* sequence diagram */
.md-fences[lang="sequence"] .md-diagram-panel-preview rect:not([fill="none"]) {
  fill: var(--bg-color2);
  stroke: var(--menu-divider-color);
  stroke-width: 1.2;
}

.md-fences[lang="sequence"] .md-diagram-panel-preview path {
  fill: var(--menu-divider-color);
  stroke: var(--menu-divider-color);
  stroke-width: 1.2;
}

.md-fences[lang="sequence"] text,
.md-fences[lang="flow"] text {
  font-family: "Consolas" !important;
}

/* remove box shadow when not edit graph */
.md-fences[lang="sequence"]:not(.md-focus),
.md-fences[lang="mermaid"]:not(.md-focus),
.md-fences[lang="flow"]:not(.md-focus) {
  box-shadow: none;
}

/* remove border when edit graph */
.md-diagram-panel {
  border: none !important;
}



</style>
</head>
<body class='typora-export os-windows'>
<div id='write'  class=''><h1><a name="计算机网络" class="md-header-anchor"></a><span>计算机网络 </span></h1><p><span>【考查目标】</span></p><p><span>1.掌握计算机网络的基本概念、基本原理和基本方法。</span></p><p><span>2.掌握计算机网络的体系结构和典型网络协议，了解典型网络设备的组成和特点，理解典型网络设备的工作原理。</span></p><p><span>3.能够运用计算机网络的基本概念、基本原理和基本方法进行网络系统的分析、设计和应用。</span></p><h1><a name="一计算机网络体系结构" class="md-header-anchor"></a><span>一、计算机网络体系结构</span></h1><h2><a name="一计算机网络概述" class="md-header-anchor"></a><span>（一)计算机网络概述</span></h2><h3><a name="1计算机网络的概念组成与功能" class="md-header-anchor"></a><span>1.计算机网络的概念、组成与功能</span></h3><p><span>互联的自治的计算机系统的集合。</span></p><p><span>组成分类：</span></p><ol start='' ><li><span>从组成部分看，主要有硬件、软件、协议三部分组成，硬件主要有主机（端系统），通信链路、交换设备、通信处理机等组成。</span></li><li><span>从工作方式看，主要分为边缘部分和核心部分，边缘部分主要是主机，进行资源共享和进程通信，核心部分则有大量网络和路由器组成。</span></li><li><span>功能上看，主要有通信子网和资源子网组成，对应IOSI模型的上三层和下三层，中间还有传输层承上启下。</span></li></ol><p><span>功能：</span></p><ol start='' ><li><span>数据通信</span></li><li><span>资源共享</span></li><li><span>分布式：分布处理、提高可靠性、负载均衡。</span></li></ol><p><span>发展的三个阶段：</span></p><ol start='' ><li><span>69年创建第一个分组交换APRANET，83年TCP/IP成为APRANET标准协议，83年被认为是互联网诞生的时间。90年APRANET关闭。internet小写的i是通用名词，Internet大写的i是专用名词，以APRANET为前身、使用TCP/IP协议簇，是当前最大的开放的互联网。</span></li><li><span>85年起NSF（美国国家科学基金会）围绕六个大型计算机中心建立NSFNET，三级网络，分为主干网、地区网、校园网。</span></li><li><span>逐渐形成多层次ISP结构的互联网，93年开始，NSFNET被若干商用互联网主干网替代，ISP（Internet Service Provider）网络服务提供商，而后为了加快层级转发，出现了IXP（Internet eXchange Point）互联网交换点，典型的IXP由网络交换机组成。</span></li></ol><h3><a name="2分类" class="md-header-anchor"></a><span>2.分类：</span></h3><ol start='' ><li><p><span>按照分布范围：</span></p><ol start='' ><li><span>广域网（WAN）：远程网，使用交换技术</span></li><li><span>城域网（MAN）：范围稍大，大多采用以太网技术（有时并入局域网讨论）</span></li><li><span>局域网（LAN）：范围较小，使用广播技术</span></li><li><span>个域网（PAN）：也常称无线个人区域网，多使用无线技术，范围大约为10m。</span></li></ol></li><li><p><span>按照传输技术：</span></p><ol start='' ><li><span>广播式：共享共用信道，广域网中的无线、卫星通信大多使用广播式通信，局域网基本采用。</span></li><li><span>点对点（Peer-to-Peer，P2P）：采用存储转发，分组传输。</span></li></ol></li><li><p><span>拓扑结构分类：结点和通信线路的几何形状，主要指通信子网的拓扑结构</span></p><ol start='' ><li><span>总线形：单根传输线链接，优点是建网简单，增减节点方便，节省线路，缺点是重负载式效率不高，对于任意一处故障敏感</span></li><li><span>星形：每个中断单独和中央设备链接，早期的中央设备是计算机，现在一般是交换机或路由器，优点是便于集中管理和控制，缺点是成本高，中心节点对故障敏感。链路条数=节点个数-1。</span></li><li><span>环形：所有设备连接成一个环，环中信号单向传输，可以是单环也可以是双环。</span></li><li><span>网状形：一般情况下，每个结点至少有两条路径和其他结点相连，多在广域网中，优点是可靠性奥，缺点是控制复杂，线路成本高。</span></li></ol></li><li><p><span>使用者分类</span></p><ol start='' ><li><span>公用网：公众网</span></li><li><span>专用网：军队、电力、铁路等专用网络。。</span></li></ol></li><li><p><span>交换技术</span></p><ol start='' ><li><span>电路交换：源和目标之间建立专用通路，包括建立连接、传输数据、断开连接三个部分，典型的有传统电话网络。优点是直接传送、实验小，缺点是线路利用率低，不能充分利用，不便差错控制。</span></li><li><span>报文交换：存储-转发网络，整个报文传输，优点是充分利用线路容量，可以实现格式转换、一对多多对多访问、差错控制等，缺点是增大了资源开销、增加缓冲时延，需要额外机制保证报文顺序，缓冲区难以管理等。</span></li><li><span>分组交换：包交换网络，将报文分成较短的定长数据块，是现在的主流网络形式。具备报文交换的优点的同时，还使缓冲区易于管理、包平均延时更小，平均缓冲区小、易于标准化和应用。</span></li></ol></li><li><p><span>传输介质：有线和无线两大类，无线分为蓝牙微波无线电等，有线由双绞线、同轴电缆等。</span></p></li></ol><h3><a name="3计算机网络的标准化工作及相关组织" class="md-header-anchor"></a><span>3.计算机网络的标准化工作及相关组织</span></h3><p><span>互联网协会ISOC（Internet Society），下设技术组织互联网体系结构委员会（Internet Architecture Board，IAB），下设两个工程部，互联网工程部（Internet Engineering Task Force，IETF）和互联网研究部（Internet Research Task Force，IRTF），具体工作由互联网工程任务组（Internet Engineering Steering Group，IESG）等完成。</span></p><p><span>互联网标准以RFC（Request For Comments）的形式发布，一般需要四个阶段</span></p><ol start='' ><li><span>互联网草案（Internet Draft），还不是RFC文档</span></li><li><span>建议标准（Proposed Standard），成为RFC文档</span></li><li><span>草案标准（Draft Standard），2011年后已经取消这一阶段</span></li><li><span>互联网标准（Internet Standard），正式标准，分配STD xx的编号。</span></li></ol><p><span>国际标准化组织ISO，制定OSI模型、HDLC等</span></p><p><span>国际电信联盟ITU，指定远程通信标准。</span></p><p><span>国际电气电子工程师协会IEEE，世界上最大的专业技术团队，IEEE802标准。</span></p><p>&nbsp;</p><h3><a name="4性能指标" class="md-header-anchor"></a><span>4.性能指标</span></h3><ol start='' ><li><p><span>时间类（单位：秒、毫秒）：</span></p><ol start='' ><li><span>时延。发送时延=分组长度/信道宽度（带宽），也称传输时延，是比特流进入链路的时延。传播时延=信道长度/电磁波平均传播速率，速率一般为2乘10的8次方m/s。处理时延是存储转发中提取数据、差错检验、路由查找的时间开销。排队时延，在队列中排队产生的时延。总时延就是发送时延（或传输时延）、传播时延、排队时延、处理时延四部分的和，一般可以忽略后两者，此外，提高数据发送速率只能减少发送时延。</span></li><li><span>往返时延（Round-Trip Time，RTT），发送端发送数据开始，接收端收到数据后立刻确认，到发送端收到确认的时间，包括两个传播时延和末端处理时间，处理时间中还包括中间结点的处理时延、排队时延、发送时延。</span></li></ol></li><li><p><span>速率类（单位：比特每秒bps）：</span></p><ol start='' ><li><span>速率：也称数据率或比特率，指单位时间内传送的二进制比特数，单位bps、b/s、bit/s，在速率计算时，一般使用小写的k，代表10的三次方，存储时使用大写的K，代表2的10次方。</span></li><li><span>带宽：原本表示通信线路允许通过的信号频带范围，以hz为单位，后表示传送数据能力，以bps为单位，是最高数据率的同义语。</span></li><li><span>吞吐量：单位时间内通过的数据量，即实际数据率，受带宽和额定速率限制。</span></li></ol></li><li><p><span>其他</span></p><ol start='' ><li><span>时延带宽积，单位比特。传播时延乘信号宽度，表示链路能容纳的比特数量。</span></li><li><span>信道利用率，无单位，有数据通过数据/总时间。利用率过低浪费，过高导致时延激增。</span></li></ol></li></ol><p>&nbsp;</p><h2><a name="二计算机网络体系结构与参考模型" class="md-header-anchor"></a><span>（二)计算机网络体系结构与参考模型</span></h2><h3><a name="1计算机网络分层结构" class="md-header-anchor"></a><span>1.计算机网络分层结构</span></h3><p><span>各层以及协议的集合称为网络体系结构（Architecture），还有实现（Implementation）问题，实现是具体的，体系结构是抽象的。最初设计APRANET时就有了分层的思想，74年IBM提出了最早的系统网络体系结构（System Network Architecture，SNA）。</span></p><p><span>分层基本原则有：</span>1️⃣<span>每层实现一种相对独立功能，</span>2️⃣<span>各层界面自然清晰，相互交流尽可能少，</span>3️⃣<span>各层定义独立于具体实现，可以选用最适合的技术完成，</span>4️⃣<span>上层单向使用下层提供的服务，</span>5️⃣<span>能促进标准化工作。</span></p><p><span>层次结构的含义有：</span>1️⃣<span>第n层的实体不仅要使用n-1层的服务来实现自身功能，还要向n+1层提供服务，</span>2️⃣<span>上一层只能通过相邻层间的接口提供下一层服务，</span>3️⃣<span>两台主机通信时，对等层在逻辑上有一条直接信道，表现为不经过下层就将信息直接传送到对方。</span></p><h3><a name="2计算机网络协议接口服务等概念" class="md-header-anchor"></a><span>2.计算机网络协议、接口、服务等概念</span></h3><p><span>实体：第n层的活动元素称为n层实体，同一层称为对等层，同一层实体称为对等实体，n层是n+1层的服务提供者，服务数据单元（Service Data Unit，SDU），协议控制信息（Protocol Control Information，PCI），协议数据单元（Protocol Data Unit，PDU），n-SDU+n-PCI=n-PDU=(n-1)-SDU，即本层服务数据单元加上协议控制信息是本层的协议数据单元，是下层的服务数据单元。</span></p><p><span>协议：规则的集合，网络协议（Network Protocol）是水平的，不对等的实体之间是没有协议的。协议由语法语义和同步三部分组成，语法规定了数据传输格式，语义规定了实现的功能，同步规定了条件、时序关系、顺序。</span></p><p><span>接口：同一结点内，相邻两层间交换信息的连接点，是一个系统内部分规定，同一结点相邻两层的实体通过服务访问点（Service Access Point，SAP）进行交互，SAP是一个抽象概念，实际上是一个逻辑接口。</span></p><p><span>服务：下层为上层提供的功能调用，是垂直的，上层必须和下层交换命令，这些命令在OSI中称为服务原语，分为四类​：</span>1️⃣<span>请求（Request），</span>2️⃣<span>指示（Indication），</span>3️⃣<span>响应（Response），</span>4️⃣<span>证实（Confirmation）。（一层实现的功能不全是服务，只有向上一层提供的才是）服务可以按三种形式分类：</span></p><ol start='' ><li><span>面向连接和无连接：TCP可靠，UDP、IP不可靠，尽最大努力（Best-Effort-Delivery）</span></li><li><span>可靠服务和不可靠服务：可靠的具有纠错、检错、应答机制，确保数据正确可靠的送达目的地；不可靠尽量正确，由应用或用户自己来保障，通过用户的检错重传，可以让不可靠变成可靠。</span></li><li><span>有应答服务和无应答服务：WWW无应答。</span></li></ol><h3><a name="3isoosi参考模型物联链）网淑输）惠会）试示）用" class="md-header-anchor"></a><span>3.ISO/OSI参考模型：物联（链）网淑（输）惠（会）试（示）用</span></h3><p><span>77年ISO成立专门机构，提出了建立开放系统互连基本参考模型（OSI/RM，Open Systems Interconnection Reference Model），即开放的，但因为专家缺乏实际经验，标准的商业驱动力不足；协议复杂，效率低；制定周期太长，错过机遇；层次划分不合理，功能重复等原因，只成为了法律上的国际标准OSI，而事实上的国际标准是TCP/IP。</span></p><ol start='' ><li><span>物理层：传输单位比特，在物理设备上透明的传输比特流，协议也称物理层接口标准、物理层规程（Procedure），有EIA-232C、EIA RS-449、CCITT的X.21等。主要规定了电路接口和相关参数、信号的意义和电器特征，物理媒体如双绞线同轴线不在规程中，而在协议下，也有人将物理媒介作为第0层。</span></li><li><span>数据链路层：传输单位是帧，将IP数据报组装成帧，功能主要是成帧、差错控制、流量控制、传输管理，主要协议有SDLC、HDLC、PPP、STP和帧中继等，广播式链路还需要控制共享信道访问，故有介质访问子层处理。</span></li><li><span>网络层：传输单位是（IP）数据报，主要协议是IP（Internet Protocol）和路由选择协议，也称网际层或IP层，主要关注通信子网的运行控制，特备是路由选择，以及流量控制、拥塞控制、差错控制和网际互连等。</span></li><li><span>传输层：也叫运输层，传输单位是报文段（TCP）或用户数据报（UDP），主要负责主机中两个进程之间的通信，协议主要是TCP和UDP，功能是为端到端提供连接服务，以及流量控制、差错控制、服务质量、数据传输管理等。传输层实现承上启下，屏蔽通信子网点到点的传输，为高层用户提供端到端的数据传输，也具有复用和分用的功能。</span></li><li><span>会话层：主要是建立连接并有序传输数据，也叫建立同步（SYN），主要功能更是建立管理进程会话，并提供恢复和同步能力。</span></li><li><span>表示层：主要处理交换信息的表示方式，包括数据压缩、加密、解密，ADT、编码转换等。</span></li><li><span>应用层：OSI的最高层，协议最多，主要有文件传送FTP，电子邮件SMTP，万维网的HTTP，域名解析DNS，虚拟终端Telnet等。</span></li></ol><h3><a name="4tcpip模型" class="md-header-anchor"></a><span>4.TCP/IP模型</span></h3><p><span>APRA在研究APRANET时就提出了TCP/IP模型，主要有网络接口层（对应物理层和数据链路层），网际层（IP层），传输层和应用层。由于广泛应用，成为事实上的国际标准。核心是IP协议，可以为各种应用服务（everything over IP），也允许在各种网络运行（IP over everything）。</span></p><ol start='' ><li><span>网络接口层：类似于物理和数据链路，具体的物理网络可以是各种类型的网络，如以太网、令牌环网、电话网、X.25、SDH等网络，主要功能是从主机或结点接受IP分组，并发送到指定物理网络。</span></li><li><span>网际层（主机-主机）：IP层，主要是路由选择，定义了标准的分组格式和协议，可靠传输但不保证有序交付。</span></li><li><span>传输层（进程-进程）：主要是TCP（Transmission Control Protocol）和UDP（User Datagram Protocol）。</span></li><li><span>应用层（用户-用户）：包含所有高层协议。</span></li></ol><h4><a name="tcpip模型和osi模型比较" class="md-header-anchor"></a><span>TCP/IP模型和OSI模型比较：</span></h4><p><span>相同：都采用分层体系结构，基于独立的协议栈概念，解决异构网络互联。</span></p><p><span>差别：</span></p><ol start='' ><li><span>OSI的最大贡献是精确定义了服务、协议和接口，吻合OOP，但IP没有明确区分。</span></li><li><span>OSI模型在协议发明之前，通用性良好，不偏向任何协议，所以在协议方面没有经验，不知道把哪些功能放在哪一层，TCP/IP正好相反，模型是对协议的描述，所以不会出现协议不匹配模型，但也不适合其他任何非TCP/IP协议栈。</span></li><li><span>TCP/IP最初就考虑了多种异构网互联问题，并将IP作为单独的重要层次，OSI最早只考虑用一种标准的公用数据网互联，之后才划分出子层来完成IP功能。</span></li><li><span>☆ OSI在网络层支持无连接和面向连接通信，但在传输层只有面向连接通信，而TCP/IP认为可靠性是端到端的问题，在网际层只有无连接通信模式，但在传输层支持无连接和面向连接两种模式。</span></li></ol><h1><a name="二物理层" class="md-header-anchor"></a><span>二、物理层</span></h1><h2><a name="一通信基础" class="md-header-anchor"></a><span>（一)通信基础</span></h2><h3><a name="1信道信号宽带码元波特速率信源与信宿等基本概念" class="md-header-anchor"></a><span>1.信道、信号、宽带、码元、波特、速率、信源与信宿等基本概念</span></h3><p><span>信号：数据是传送信息的实体，信号是数据的电气或电磁表现，是数据在传输过程中的存在形式。数据或信号都分为模拟和数字两种，连续即模拟，有限离散值即数字的，传输方式分为并行和串行两种。</span></p><p><span>码元：用一个固定市场的信号波形表示一位k进制数字，代表不同的离散数值的基本波形，是数字通信中数字信号的计量单位，这个时长内的信号也称为k进制码元，时长称为码元宽度。一个码元可以携带一位k进制数据的信息量，可以携带多个比特的信息量。</span></p><p><span>波特率：码元传输速率，也称码元速率、波形速率、符号速率、调制速率，表示单位时间内传输的马原个数，单位是波特（Baud），码元速率与进制无关，波特=码元每秒，单位中包含了时间。</span></p><p><span>信息传输速率：信息速率、比特率，表示单位时间内传送的二进制码元个数，即比特数，单位是bit/s，R</span><sub><span>b</span></sub><span>=R</span><sub><span>B</span></sub><span>×log</span><sub><span>2</span></sub><span>M。</span></p><p><span>数据通信系统主要划分为信源、信道、信宿三部分。信源是产生和发送数据的源头，信宿是接受数据的终点，通常都是计算机或其他数字终端装置。</span></p><p><span>信道是信号的传输媒介，一般是一条线路的逻辑部件，用来表示向某个方向传送信息的介质，因此一条通信线路往往包含两条信道，噪声源是信道噪声和其他噪声的集中表示。</span></p><h3><a name="2奈奎斯特定理与香农定理" class="md-header-anchor"></a><span>2.奈奎斯特定理与香农定理</span></h3><p><span>奈奎斯特定理：（奈氏准则），指出理想低通（没有噪音、带宽有限）的信道中，极限码元传输率为2W波特，W是带宽，单位Hz，用V表示码元种数，则传输率也是2Wlog</span><sub><span>2</span></sub><span>V（单位b/s）。可以得出以下结论：码元传输速率是有上限的，超过则会产生码间串扰；频带越宽码元速率越高；虽然给出了码元的传输速率限制，但未给出信息传输速率的极限，根据奈氏准则，要提高信息传输速率，就要使码元携带更多比特的信息量，所以采用多元制的调制方法。</span></p><p><span>香农定理：（Shannon），给出了带宽受限且有高斯白噪声干扰的极限数据传输率，即信道极限数据传输率=Wlog</span><sub><span>2</span></sub><span>（1+S/N），单位bps，W为带宽，S为信号平均功率，S/N为信噪比，可以得出以下结论：信噪比越大，信息极限传输率越高；对于一定的信噪比和带宽，信息传输速率上限是确定的，信息传输速率低于极限就有方法实现无差错传输；信道的实际传输速率达不到极限速率。</span></p><p><span>奈氏准则揭示了带宽和极限码元传输速率的关系，香农则同时考虑了信噪比，侧面表明一个码元对应的二进制位数是有限的。</span></p><h3><a name="3编码与调制" class="md-header-anchor"></a><span>3.编码与调制</span></h3><p><span>将数据转化为模拟信号为调制，转化为数字信号是编码，数字信号可以通过调制器转换成模拟信号传输，模拟数据可以通过PCM编码转换成数字，也可以用放大调制器转换成模拟信号传输。</span></p><ol start='' ><li><p><span>数字信号编码</span></p><ol start='' ><li><span>归零码RZ：高电平1，低电平0，每个时钟周期中间跳变到低电平，优点是提供了自同步机制，但是归零占用了一部分带宽（码元），传输速率受影响。</span></li><li><span>非归零码NRZ：不需要归零，所以难以同步，在高速同步传输时，还需要一根时钟线。</span></li><li><span>反向非归零码NRZI：信号翻转为0，不变为1，翻转可以作为一种同步机制，集成前两者优点，有时钟信号但不损失带宽，USB2.0通信使用这一编码。</span></li><li><span>曼彻斯特编码：将一个码元分为两部分，前高后低1，前低后高0，优点是跳变既作为时钟信号，又传输数据，但是频带宽度是原始基带宽度的两倍。以太网传输中，一般使用曼彻斯特编码。</span></li><li><span>差分曼彻斯特编码：码元为1则前半个码元根上一个码元后半个相同，为0则跳变，优点和曼彻斯特类似，抗干扰性好。局域网使用这一编码。</span></li><li><span>4B/5B编码：把数据流的每4位作为一组，通过编码规则转换成5位码，5位码32种组合中，指用16种状态，其他16种作为控制码（开始结束状态等）或保留。</span></li></ol></li><li><p><span>数字信号调制</span></p><ol start='' ><li><span>幅移键控ASK：改变振幅表示，频率相位不变，容易实现但是抗干扰差。</span></li><li><span>频移键控FSK：改变频率，容易实现、抗干扰强，应用广泛。</span></li><li><span>相移键控PSK：改变香味，分为绝对调相和相对调相（差分调相）。</span></li><li><span>正交振幅调制QAM：频率相同的前提下，结合ASK和PSK，形成叠加信号，设波特率B，m个相位，n种振幅，则数据传输率R=Blog</span><sub><span>2</span></sub><span>（mn）。</span></li></ol></li><li><p><span>模拟信号编码：采样定理（奈氏原理）：采样频率是f</span><sub><span>最大频率</span></sub><span>的两倍就可以不失真采样。</span></p><ol start='' ><li><span>采样：对模拟信号进行周期性扫描，将连续信号变成离散信号，只要符合采样定理，离散信号可以不失真的代表模拟数据</span></li><li><span>量化：取整转化为数字值，会产生损失。</span></li><li><span>编码：将量化结果编码。</span></li></ol></li><li><p><span>模拟信号调制：为了实现传输有效性，可能需要较高频率。电话局和本地局交换机就采用这类技术，可以用频分复用FDM提高带宽资源利用率。</span></p></li></ol><h3><a name="4电路交换报文交换与分组交换" class="md-header-anchor"></a><span>4.电路交换、报文交换与分组交换</span></h3><ol start='' ><li><span>电路交换：分为连接建立、数据传输、连接释放三个阶段，动态分配传输线路的资源，但在数据传输过程中，用户独占端到端的固定传输带宽。优点有：时延小（适合大数据量传输），有序传输，没有冲突，适用范围广，实时性强，控制简单。缺点有：建立连接时间长，线路独占利用率低，灵活性差（一旦链路故障就需要重新拨号），难以规格化和差错控制。因为连接建立后，结点采用直通方式接受发送数据，所以不会产生存储转发时间开销。</span></li><li><span>报文交换：数据交换的单位是报文，在节点采用存储转发。优点有：无需建立连接，动态分配路线，提高线路可靠性和利用率，提供多目标服务。缺点主要有存储转发产生的转发时延，还要求结点有较大的缓存空间。主要是用在早期的电报通信网，现在较少使用。</span></li><li><span>分组交换：也采用存储转发，但限制数据块大小，为每一块数据加上必要控制信息，构成分组（Packet）。主要优点有：无建立时延，线路利用率高，简化了存储管理（相对于报文交换），加速传输（使后一个分组的存储和前一个分组的转发并行，也减少了缓冲区不足等待的概率和时间），减少了出错概率和重发数据量（提高了可靠性和传输时延）。缺点主要有：存在传输时延，需要传输额外信息量，一定程度上降低了效率增加了处理时间，使用数据报服务还有可能产生失序、丢失、重复等情况，使用虚电路则增加了呼叫建立、数据传输、虚电路释放三个过程。</span></li></ol><p><span>在数据量大且呼叫时间远小于传送时间时，电路交换比较合适，信道利用率报文和分组都比电路高，分组的时延比报文小，特别适合突发式数据通信。</span></p><h3><a name="5数据报与虚电路" class="md-header-anchor"></a><span>5.数据报与虚电路</span></h3><p><span>数据报和虚电路是网络层提供的两种分组交换的形式，虚电路面向连接，数据报无连接。</span></p><ol start='' ><li><span>数据报：高层协议将报文拆成若干数据单元，在网络层加上地址等控制信息形成数据报分组，即网络层PDU，然后分组转发，每个分组的转发路径都可能不同，网络链路中的资源共享。主要特点有：不需要建立连接，随时可以收发；尽最大努力交付但不保证可靠性；每个分组独立选择路由，每个分组包括完整的收发地址，独立传输；存储转发中排队会带来时延，网络拥塞时可能丢包；网络有冗余路径，对故障适应能力强；延时一般较小，提高了网络吞吐量；不独占资源，所以利用率高。</span></li><li><span>虚电路：将数据报和电路交换相结合，在收发双方建立逻辑上相连的虚电路，包括虚电路建立、数据传输、虚电路释放三个过程，每次建立虚电路时，分配一个未使用的虚电路号，每个结点维护一张虚电路表，记录所有打开的虚电路和接受发送链路上的上下游相邻节点，上述过程在虚电路建立过程中确定。特点有：虚电路建立和拆除需要一定的时间开销，但对于长时间、频繁的数据交换而言，效率较高；路由选择在建立阶段，传输路径确立后节省一部分转发时延，但也因此导致节点故障会使所有经过节点的虚电路破坏；虚电路提供了可靠通信，能保证每个分组正确且有序到达，还能进行流量控制，如暂缓发送等；分组首部不需要包含目的地址，只需要虚电路标识符，相对数据报开销更小。</span></li></ol><h2><a name="二传输介质" class="md-header-anchor"></a><span>（二)传输介质</span></h2><h3><a name="1双绞线同轴电缆光纤与无线传输介质" class="md-header-anchor"></a><span>1.双绞线、同轴电缆、光纤与无线传输介质</span></h3><p><span>传输介质也称传输媒体，是收发设备间的物理通路，传输介质可以分为导向型和非导向型，非导向型可以是空气、真空、海水。</span></p><ol start='' ><li><p><span>双绞线：并排绞合、相互绝缘，减少对相邻导线的电磁干扰，提高抗电磁干扰能力，带屏蔽层的是屏蔽双绞线STP，不带的是UTP。价格偏移，是最常用的介质，模拟和数字都可以使用，通信距离几千米到数十千米，远距离需要用放大器放大模拟信号、中继器整形数字信号。</span></p></li><li><p><span>同轴电缆：由内导体、绝缘层、网状编制屏蔽层、塑料外层组成，50Ω的也称基带同轴电缆，主要用于局域网，75Ω的为宽带同轴电缆，主要用于有线电视系统，由于外导体屏蔽层，抗干扰特性较好，广泛应用于速率较高的数据，传输距离更远，但是价格更贵。</span></p></li><li><p><span>光纤：分为单模和多模，多模通过多次折射，以发光二极管为光源，传输中会逐渐展宽造成失真，只适合近距离传输。单模的光纤直径减小到一个光波长度，光纤同波导一样，一直向前传播，光源为激光二极管，衰减小适合远距离传输。</span></p></li><li><p><span>无线传输介质：</span></p><ol start='' ><li><span>无线电波：穿透力强、长距离传输，向所有方向散射，简化通信连接。</span></li><li><span>红外线：视距技术，传播距离较近，需要收发双方存在视线通路，方向性强，直线传播，也称视线介质。</span></li><li><span>微波激光同样是视线介质，但传播距离远一些，微波频率高所以频段范围宽，信道容量大，但因为直线传播所以微波需要中继站接力，卫星通信是利用卫星作为中继，3颗同步卫星就能覆盖全球，基本实现全球通信，通信容量大、距离远、覆盖广，但是端到端传播时延长，一般典型值为250~270ms</span></li></ol></li></ol><h3><a name="2物理层接口的特性" class="md-header-anchor"></a><span>2.物理层接口的特性</span></h3><ol start='' ><li><span>机械特性：物理连接的边界点，即接插装置</span></li><li><span>电气特性：二进制位的电压高低、阻抗匹配、速率距离限制等</span></li><li><span>功能特性：某一电平表示何种含义、信号线用途</span></li><li><span>规程特性：工作规程和时序关系。</span></li><li><span>常用标准：EIA RS-232-c，ADSL，SDH/SONET</span></li></ol><h2><a name="三物理层设备" class="md-header-anchor"></a><span>（三)物理层设备</span></h2><h3><a name="1中继器" class="md-header-anchor"></a><span>1.中继器</span></h3><p><span>也称转发器，只将信号整形并放大后再转发，原理是信号再生，用来消除失真和衰减，端口仅用作信号的电气部分，不管数据中的问题。是最廉价最简单的互联设备，相连的几个网段还是局域网，两端只能链接相同协议、相同媒体，也有些能完成媒介转换，不能连接速度不一致的网络，两端只是网段而不是子网，故障会同时影响相邻两个网段。</span></p><p><span>理论上来说使用数目无限，但因为由信号延迟要求，在10BASE5以太网规范中，有5-4-3规则，即4个中继器串联的5个通信段中，只有3段可以挂接计算机，其余两端只能作为通信范围扩展的链路段。</span></p><p><span>放大器和中继器都能放大，但放大器针对模拟电路 ，中继器则是整形再生，一个网络具有存储转发功能才可能连接两个不同协议，中继器不可以，两端网段必须是同一个协议。</span></p><h3><a name="2集线器" class="md-header-anchor"></a><span>2.集线器</span></h3><p><span>Hub集线器，实质上是多端口中继器，允许一个输入，信号整形再生后转发给其余端口，只起信号转发和放大功能。Hub组网灵活，一般使用双绞线，是各类连接的最经济方式，组成的是共享式网络，在逻辑上是一个总线网，每个端口连接的是不同网段，只能半双工运行，吞吐率会受影响，如8台计算机在10Mbps的集线器连接，则实际带宽仅为1.25Mbps，集线器不能分割碰撞域，多台机器同时通信还会导致信息碰撞，所以工作效率较差。</span></p><h1><a name="三数据链路层" class="md-header-anchor"></a><span>三、数据链路层</span></h1><h2><a name="一数据链路层的功能" class="md-header-anchor"></a><span>（一)数据链路层的功能</span></h2><ol start='' ><li><p><span>为网络层提供服务：</span></p><ol start='' ><li><span>无确认的无连接服务：源机器不需要建立链路连接，丢失帧交给上层处理，适合实时通信和误码率较低的通信信道，如以太网。</span></li><li><span>有确认的无连接服务：不需要建立链路，但需要ACK确认信号，适合误码率较高的通信信道，如无线通信。</span></li><li><span>有确认的有连接服务：传输分为三个阶段，每一帧还要给出确认信号，确认后源机器才发出下一帧，服务可靠性最高，适用于可靠性实时性要求高的场合。</span></li></ol></li><li><p><span>链路管理：连接的建立、管理和释放过程称为链路管理，主要用于面向连接服务。在共享同一物理信道的情况下，还要负则分配和管理信道。</span></p></li><li><p><span>帧界定、帧同步、透明传输：将信息封装成帧，还要对数据添加首部和尾部，首部和尾部的一个重要功能就是帧定界，帧同步则是接收方能从二进制比特流中区分出帧的起始和终止。如HDLC通信规程中，使用标识为F（01111110）来识别帧的开始和结束。HDLC标准帧如下：</span></p><figure><table><thead><tr><th><span>标志</span></th><th><span>地址</span></th><th><span>控制</span></th><th><span>信息</span></th><th><span>帧校验序列</span></th><th><span>标志</span></th></tr></thead><tbody><tr><td><span>F</span></td><td><span>A</span></td><td><span>C</span></td><td><span>I</span></td><td><span>FCS</span></td><td><span>F</span></td></tr><tr><td><span>01111110</span></td><td><span>8位</span></td><td><span>8位</span></td><td><span>N位（可变)</span></td><td><span>16位</span></td><td><span>01111110</span></td></tr></tbody></table></figure></li><li><p><span>流量控制：发送端的速率可能大于接收端，可能导致数据淹没，所以流量控制实际上就是限制发送方的数据流量，整个过程需要一定的反馈机制。但流量控制并不是数据链路层特有的功能，高层协议中也有类似功能，但数据链路层指控制相邻两点间数据链路上的流量。</span></p></li><li><p><span>差错控制：通常使用循环冗余校验CRC，通过自动重传请求（Automatic Repeat reQuest，ARQ）来重传，也称为ARQ法。只需要返回很少的控制信息就能有效确认数据帧是否正确接收。</span></p></li></ol><h2><a name="二组帧" class="md-header-anchor"></a><span>（二)组帧</span></h2><p><span>数据链路层之所以以帧为单位，是为了在出错时只重发出错的帧，从而提高效率，所以需要组帧，即按照一定规则把网络层提交的分组封装成帧，主要需要解决帧定界、帧同步、透明传输等问题。组帧需要同时添加首部和尾部，而分组（即IP数据报）是包含在帧当中的数据部分，所以不需要加尾部定界。</span></p><ol start='' ><li><span>字符计数法：在帧头部使用计数字段标明帧内字符数，通过这一数值确定帧结束的位置。最大的问题是如果计数字段出错，就是去边界划分依据，可能会失去同步，造成灾难性后果。</span></li><li><span>字符填充的首尾定界符：使用一些特定字符来界定，即DLE STX和DLE ETX，DLE是ASCII中的转义字符，属于控制字符，STX和ETX是定义的开始信息，如果帧的数据段内出现DLE字符，则需要在DLE前填充一个DLE再次转义。</span></li><li><span>零比特填充的首尾标志法：使用一个特定的比特模式，如01111110来标志首尾，容易由硬件实现，性能优于字符填充法。</span></li><li><span>违规编码法：采用不符合编码规定的编码定界，在局域网802标准中就采用了这种方法，只适合采用冗余编码的特殊编码环境。</span></li></ol><p><span>由于字符计数的脆弱性和字符填充的复杂性和不兼容性，目前常用（零）比特填充法和违规编码。</span></p><h2><a name="三差错控制" class="md-header-anchor"></a><span>（三)差错控制</span></h2><p><span>传输差错有很多种，主要讨论比特差错，即0变成1.差错控制主要有两类编码技术：自动重传请求ARQ和前向纠错FEC，ARQ是出现差错就通知发送端重发，FEC则是通过纠错编码纠错。</span></p><h3><a name="1检错编码奇偶校验crc循环冗余校验" class="md-header-anchor"></a><span>1.检错编码：奇偶校验、CRC循环冗余校验</span></h3><h3><a name="2纠错编码海明码" class="md-header-anchor"></a><span>2.纠错编码：海明码</span></h3><h2><a name="四流量控制与可靠传输机制" class="md-header-anchor"></a><span>（四)流量控制与可靠传输机制</span></h2><h3><a name="1流量控制可靠传输与滑轮窗口机制" class="md-header-anchor"></a><span>1.流量控制、可靠传输与滑轮窗口机制</span></h3><p><span>流量控制主要涉及对帧的发送速率控制，使接收方有足够的缓冲空间来接收每个帧。</span></p><p><span>可靠传输则通常使用确认和超时重传两种机制完成，有些情况不单独使用确认，而是捎带在一个回复帧中，称为捎带确认。自动重传请求（Auto Repeat reQuest，ARQ）分为三种，停止-等待AQR（Stop-and-Wait），后退N帧（Go-Back-N）ARQ，和选择性重传（Selective Repeat）ARQ。后两种是滑动窗口技术和请求重发技术的结合，窗口尺寸足够大时，帧可以连续流动，所以也称为连续ARQ协议。</span></p><p><span>滑动窗口机制：任意时刻发送方都维持一组连续的允许发送的帧序号，称为发送窗口，接收方维持一组接收窗口。发送窗口W</span><sub><span>T</span></sub><span>的大小代表在未收到对方确认信息的情况下，可以发送几个数据帧，接收方则只有收到的数据帧序号落入窗口内，才收下帧。发送方每收到一个帧就像前滑动一个帧的位置，当发送窗口内没有可以发送的帧时，就停止发送。接收方收到数据后，向前移动一个位置并发回确认帧，收到的数据落在窗口外的，直接丢弃。故有如下特性：</span></p><ol start='' ><li><span>只有接受窗口向前滑动（同时发送了确认帧），发送窗口才会向前滑动</span></li><li><span>从窗口概念看，三种协议只是在窗口大小上有所差别，停等接收发送都=1，后退N帧，发送窗口&gt;1，接受窗口=1；选择重传发送接收都&gt;1。</span></li><li><span>窗口大小为1时，可以保证帧的有序接收。</span></li><li><span>窗口大小在传输过程中固定。</span></li></ol><h3><a name="2停止-等待协议" class="md-header-anchor"></a><span>2.停止-等待协议</span></h3><p><span>停止等待相当于发送接收窗口大小均为1的滑动窗口协议。可能出现三种错误，数据帧丢失、数据帧出错、ACK破坏导致数据帧重复。</span></p><p><span>针对前两种错误 ，使用超时重传机制，发送方设置计时器，计时器满仍未收到确认，则再次发送相同的帧，如此重复直到收到ACK。</span></p><p><span>对于重复，在接受方收到同样的数据帧时，会丢弃新帧，并重传对应ACK，确认帧中包含序号，出现相同序号确认帧表明接收端收到重复帧。</span></p><p><span>为了超时重传和判定重复的需要，发送和接受都需要设置帧缓冲区，发送完数据后保留帧数据副本，在收到ACK后才可以清除。停等协议对于信道的利用率较低，所以产生了GBN和SR两种算法。</span></p><h3><a name="3后退n帧协议gbn" class="md-header-anchor"></a><span>3.后退N帧协议(GBN)</span></h3><p><span>发送方可以连续发送帧，接收方检测出失序的信息帧后，要求发送方重发最后一个确认的信息帧之后的所有未被确认的帧，即发送了N个帧后，发现N个帧的前一个未确认，则Go-Back-N，重发这些帧，也即接收方只允许顺序接受帧。为了减少开销，GBN协议还规定不用每个帧都返回ACK，而实可以连续接收几个正确帧后，对最后一个帧返回确认信息，或在有数据要发送时才捎带确认。ACK</span><sub><span>n</span></sub><span>表示对第n号帧的确认，即正确接受n及其之前的帧。</span></p><p><span>接收窗口为1时，可以保证按序接收，若采用n比特对帧编号，则发送窗口W</span><sub><span>T</span></sub><span>必须在1-2</span><sup><span>n</span></sup><span>-1之间，若大于等于2</span><sup><span>n</span></sup><span>，则接收方无法分辨新旧帧。GBN协议因为连续发送提高了信道利用率，但重传时必须连同已传送正确的帧一起重传，导致效率降低，尤其在传输质量差导致误码率较高时，GBN不一定优于停等协议。</span></p><h3><a name="4选择重传协议sr" class="md-header-anchor"></a><span>4.选择重传协议(SR)</span></h3><p><span>只重传出错或计时器超时的数据帧，加大接收窗口以便收下序号不连续但在窗口中的数据帧，每个发送缓冲区依然设置计时器，超时重传，接收方怀疑数据出错时，发送否定帧NAK给发送方，要求对NAK中指定的帧重传。</span></p><p><span>一般情况下，发送接收窗口大小是相同的，但为了保证不出现错误，对于n位编号的数据帧来说，接收窗口W</span><sub><span>R</span></sub><span>+发送窗口W</span><sub><span>T</span></sub><span>&lt;=2</span><sup><span>n</span></sup><span>，即窗口不超过序号范围的一半。缓冲区所需的大小时接收窗口的大小，而不是序号数目。</span></p><p><span>发送方发送数据到收到第一个确认帧称为一个发送周期，设为T，发送周期内发送L比特数据，发送方数据传输率C，则发送数据的有效时间为L/C，信道利用率即为(L/C)/T。信道吞吐率=信道利用率×发送速率。</span></p><h2><a name="五介质访问控制" class="md-header-anchor"></a><span>（五)介质访问控制</span></h2><p><span>介质访问控制的主要任务是为使用介质的每个结点隔离来自同一信道上其他结点传送的数据，以协调活动结点的传输，这一协议也称为介质访问子层（Medium Access Control，MAC）子层。常用控制方法有信道划分、随机访问、轮询访问。无论哪种方式，在逻辑上广播信道都变成点对点的信道，所以说数据链路层是针对点对点通信。</span></p><h3><a name="1信道划分" class="md-header-anchor"></a><span>1.信道划分</span></h3><p><span>信道划分介质访问控制将介质的每个设备与同一通信信道上的其他设备的通信隔离开，即多路复用技术，在传输介质的带宽高于传输单个信号所需的带宽时，通过在一条介质上同时携带多个传输信号的方法来提高传输信道利用率。通过分时、分频、分码等方式，将原本的一条广播信道，在逻辑上分为几条互不干扰的子信道，即将广播信道变为点对点信道。</span></p><ol start='' ><li><span>频分多路复用（FDM）：将多路基带信号调制到不同频率载波上，叠加形成复合信号，每个子信道分配的带宽可以不相同，但是总和不能超过信道总带宽，实际应用中，还需要再相邻信道之间加入“保护频带”，优点在于充分利用了介质的带宽，系统效率高，技术成熟、实现容易。</span></li><li><span>时分多路复用（TDM）：将物理信道分为若干时间片，轮流分配给多个信号使用，但由于计算机数据的突发性，一个用户对已分配到的子信道一般利用率不高。所以有了统计时分多路复用（STDM，又称异步时分多路复用），采用STDM帧，不固定分配时隙，而是动态的按需分配，单个用户的最高速率可以达到信道最高速率。</span></li><li><span>波分多路复用（WDM）：即光的频分多路复用，再光纤中传输不同波长的信号，用波长分解复用器分解，因为光波处于高频段，带宽高，所以可以实现多路波分复用。</span></li><li><span>码分多路复用（CDM）：采用不同编码来区分原始信号，既共享频率又共享时间。码分多址（Code Division Multiple Access，CDMA）是码分复用的一种方式，将每比特时间划分为m个更短的时间槽，称为码片（Chip），每个站点指定一个唯一的m为代码或码片序列，多个站点发送时，数据在信道中线性相加，为了便于分离，要求各个站点的码片序列相互正交。码分多路复用技术有频谱利用率高、抗干扰能力强、保密性强、语音质量好等特点，还能减少投资和降低运行成本，主要用于无线通信系统。</span></li></ol><h3><a name="2随机访问" class="md-header-anchor"></a><span>2.随机访问</span></h3><p><span>随机访问协议中，不采用集中控制方式解决发送信息的次序问题，所有用户根据自己的意愿随机发送信息，直到发生碰撞（冲突、相互干扰），每个用户需要按照一定规则反复重传直到成功传达。所以也称为争用型协议，核心思想是胜利者通过争用获得信道，从而可以发送信息。随机介质访问控制实质上也是将广播信道转化成点对点信道。</span></p><ol start='' ><li><p><span>ALOHA协议：Additive Link On-line HAwaii system，夏威夷大学早期研制的随机接入系统，分为纯ALOHA和时隙ALOHA两种：</span></p><ol start='' ><li><span>纯ALOHA：一段时间未收到确认，就认为发生了冲突，随机等待一段时间后，再次发送。假设帧长是定长的，发送这个帧所需的时间为T</span><sub><span>0</span></sub><span>，假设网络负载（即T</span><sub><span>0</span></sub><span>时间内所有站点发送成功和未成功而重传的帧数）为G，G=0.5时，S=0.5e</span><sup><span>-1</span></sup><span>≈0.184，这是吞吐量S的极大值。可见网络吞吐量很低。</span></li><li><span>时隙ALOHA，各站在时间上同步，将时间划分为等长的时隙Slot，规定旨在时隙开始时可以发送帧，重传策略和ALOHA一致，此时依然是S=Ge</span><sup><span>-1</span></sup><span>，在G=1时，S约等于0.368，吞吐量极值大了一倍。</span></li></ol></li><li><p><span>CSMA协议：载波侦听多路访问（Carrier Sense Multiple Access，CSMA）协议则在发送前侦听共享信道，在信道空闲后发送数据，就降低了冲突的可能，提高了信道利用率，相比ALOHA多了一个载波侦听部分。根据侦听到信号忙后的处理方式 ，又分为三种CSMA：</span></p><ol start='' ><li><span>1-坚持CSMA：（1-persistent CSMA）信道忙则等待，同时继续侦听直到信道空闲，信号空闲后，发送帧的概率为1，立即发送，如果冲突则随机等待一段时间后重新侦听。</span></li><li><span>p-坚持CSMA：主要用于十分信道，基本思想是信道忙则继续侦听，侦听到空闲后，以概率p发送数据，以概率1-p延迟到下一个时隙，是一种折中方案。</span></li><li><span>非-坚持CSMA：信道忙则放弃侦听，等待一个随机时间后，继续侦听，降低了冲突概率，但是增加了平均延迟，可见信道利用率的提高以增加数据的延迟时间为代价。</span></li></ol></li><li><p><span>CSMA/CD协议：（CSMA with Collision Detections，CSMA/CD），适用于总线形网络或半双工网络环境，可以理解为先听后发，边听边发，冲突停发，随机重发。检测到冲突后，传输一个48bit的拥塞信号，中止后，采用截断二进制指数退避算法等待一段随机时间后，继续侦听。总线传播时延对于CSMACD影响较大，设τ为传播时延，发送帧后，至多经过2τ时间就能知道是否发生碰撞，所以将2τ作为争用期（冲突窗口、碰撞窗口），经过争用期还未检测到冲突，才确定不会发生冲突。所以为了确保能够检测到冲突，帧的传播时延至少要两倍于信号传播时延，即最小帧长=总线传播时延×数据传输率×2，以太网规定51.2μs为争用期长度，则对于10Mbps的以太网，最短帧长为64B。如果数据小于64B，则需要填充，如果收到短于64B的则为冲突产生的无效帧。二进制指数退避算法思路如下：</span>1️⃣<span>确定基本退避时间，一般取两倍的总线端到端传播时延2τ，</span>2️⃣<span>定义参数k=min(10，重传次数)，即最大不超过10，</span>3️⃣<span>从离散的整数集合[0,1,2……2</span><sup><span>k</span></sup><span>-1]中随机取出一个数r，重传需要退避的时间就是2rτ，</span>4️⃣<span>当重传达到16次还不成功，则抛弃帧，并向高层报告。二进制指数退避算法使重传需要推迟的时间随重传次数的增大而增大，即动态退避，从而降低碰撞概率，有利于整个系统的稳定。</span></p></li><li><p><span>CSMA/CA协议：（CSMA with Collision Avoidance，CSMA/CA），无线信道中，信号强度随距离衰减块，检测需要多个天线等原因导致冲突检测实现开销较大，且不一定可靠，还有隐蔽站问题，所以只能采用冲突避免。冲突避免使用三种机制，预约信道、ACK帧、RTS/CTS帧，其中RTS/CTS帧可选。预约信道需要在发送数据的同时，通知其他站点数据传输时间，让其他站点在这一事件内沉默；ACK帧使在正确接收后返回确认帧。RTS/CTS主要用于解决隐蔽站，一般CTS也包含了信道利用时间。</span></p></li></ol><p><span>CD/CA区别：</span></p><ol start='' ><li><span>CD检测冲突、无法避免，CA尽量避免，CD线路上没有碰撞就不会冲突，CA本结点没有冲突不意味着接收结点没有冲突。</span></li><li><span>CD检测到冲突后，立即停止，但CA即使检测到冲突，还是要继续把帧传完。</span></li><li><span>传输介质不同，CD用于总线形以太网，CA用于802.11 a/b/g/n等。</span></li><li><span>检测方式不同，CD只需要检测电压，CA采用能量检测、载波检测和能量载波混合检测三种方式。</span></li></ol><h3><a name="3轮询访问" class="md-header-anchor"></a><span>3.轮询访问</span></h3><p><span>对于负载很高的广播信道而言，随机介质访问会大概率产生冲突，从而降低利用率和效率，所以需要使用轮询方式，限定各站点轮流发送数据。网络中用户不能随意发送信息，而要通过集中控制的监控站，轮询决定信道分配，典型是令牌环局域网和令牌传递协议。</span></p><p><span>令牌传递协议：网络在逻辑拓扑上是一个环状（在物理拓扑上不必是环），网内计算机都不发送数据时，令牌以固定次序在网络上游荡，计算机只有拿到令牌才能将数据帧装入令牌内传递，无论结点是否是数据帧目的地，都对数据帧进行转发，目的站在帧的尾部设置“响应比特”，表示收到后继续转发，直到帧回到始发站后，由始发站撤销帧，并释放令牌。</span></p><h2><a name="六局域网" class="md-header-anchor"></a><span>（六)局域网</span></h2><h3><a name="1局域网的基本概念与体系结构" class="md-header-anchor"></a><span>1.局域网的基本概念与体系结构</span></h3><p><span>局域网，（Local Area Network，LAN），在一个比较小的地理范围内，设备有限地组网，主要特点有：1.为一个单位拥有，站点有限，2.所有站点共享较高的总带宽，3.实验和误码率较低，4.平等关系，5.能进行广播和组播。局域网特性主要由拓扑结构、传输介质、介质访问控制方式决定，尤其是介质访问控制方式。常见拓扑有星形环形总线形和复合型，使用双绞线作为主流传输介质。介质访问控制方式主要有CSMA/CD，令牌总线和令牌环。</span></p><p><span>有三种特殊的局域网拓扑：</span></p><ul><li><span>以太网（目前适用范围最广），逻辑拓扑为总线形结构，物理拓扑是星形或拓展星形。</span></li><li><span>令牌环（Token Ring，IEEE 802.5）逻辑拓扑是环形，物理拓扑是星形。</span></li><li><span>FDDI（光纤分布数字接口，IEEE 802.8）逻辑是环形，物理拓扑是双环形。</span></li></ul><p><span>IEEE定义的802标准的局域网参考模型只对应OSI的数据链路层和物理层，并将数据链路层拆分为LLC（链路逻辑控制子层）和MAC（媒体接入控制子层），与接入媒体有关内容都放在MAC子层，他对上层屏蔽物理层访问差异，返回统一接口。LLC层则与媒体无关，负则提供无连接、面向连接、带确认无连接、高速传送四种不同的连接服务类型，由于以太网占据垄断地位，LLC子层作用不大，所以网卡一般只有MAC而没有LLC协议。</span></p><h3><a name="2以太网与ieee-8023" class="md-header-anchor"></a><span>2.以太网与IEEE 802.3</span></h3><p><span>802.3是一种基带总线型的局域网标准，描述物理层和数据链路的MAC子层的实现方法，逻辑上采用总线形拓扑结构，信息以广播方式发送，使用CSMA/CD方式控制。严格来说以太网要符合DIX Ethernet V2标准，但因为跟IEEE802.3标准差别小，所以也将802.3局域网简称为以太网。以太网在两方面简化通信：无连接的工作方式；无需ACK确认，尽最大努力交付，提供不可靠服务，由高层完成差错纠正。</span></p><ol start='' ><li><p><span>传输介质：</span></p><figure><table><thead><tr><th><span>参数</span></th><th><span>10BASE5</span></th><th><span>10BASE2</span></th><th><span>10BASE-T</span></th><th><span>10BASE-FL</span></th></tr></thead><tbody><tr><td><span>媒介</span></td><td><span>基带同轴电缆（粗）</span></td><td><span>基带同轴电缆（细</span></td><td><span>双绞线（UTP/STP）</span></td><td><span>光纤</span></td></tr><tr><td><span>拓扑结构</span></td><td><span>总线</span></td><td><span>总线</span></td><td><span>星形</span></td><td><span>点对点</span></td></tr><tr><td><span>最大段长</span></td><td><span>500m</span></td><td><span>185m</span></td><td><span>100m</span></td><td><span>2000m</span></td></tr><tr><td><span>最多结点数目</span></td><td><span>100</span></td><td><span>30</span></td><td><span>2</span></td><td><span>2</span></td></tr></tbody></table></figure><p><span>10BASE-T物理拓扑为星形，中心为集线器（Hub），但在逻辑上仍然是总线网，属于一个冲突域。计算机和外键网络连接通过网卡实现，也称网络适配器（Adapter）或网络接口卡（Network Interface Card，NIC），网卡式计算机和传输媒介的接口，每块网卡有全球唯一的介质访问控制MAC地址，数据链路层设备只是用网卡的MAC地址，网卡工作在物理层，只关注比特。</span></p></li><li><p><span>MAC帧：MAC地址长6B，由12个16进制数表示，高24位为厂商代码，低24位为厂商自行分配的网卡序列号。总线上广播通信，所以网卡收到MAC帧后，需要检查MAC地址决定收下还是丢弃，MAC帧有两种标准，以太网V2标准和802.3标准，下述为V2标准：</span></p><p><img src="https://img-blog.csdn.net/20180506181030854?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hocGluZ3llYXI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" referrerpolicy="no-referrer" alt="以太网MAC帧格式"></p><p><span>| 8字节前导码 | 6字节目的地址 | 6字节源地址 | 2字节类型 | 46-1500字节IP数据报 |4字节FCS |。前导码分为7字节前同步码（101010……）和1字节帧定界符（01111110），地址48bitMAC地址，类型指出数据采用哪个协议，CSMA/CD要求最短帧64B，所以数据帧至少46B，最大的1500B是规定，不足46的，需要填充。校验码FCS，4字节，32位循环冗余校验，检验除前导码外的整个MAC帧。</span></p><p><span>802.3标准相比DIX以太帧区别在于用长度域代替了类型域，实践中两种机制并存。以太网MTU1500B。</span></p></li><li><p><span>高速以太网：速度达到或超过100Mbps的以太网，</span></p><ol start='' ><li><span>100BASE-T以太网，在半双工下使用CSMA/CD，全双工下不适用，星形拓扑结构。</span></li><li><span>吉比特以太网，即千兆以太网，允许在1Gbps的速度下使用全双工和半双工两种工作方式，使用802.3协议的帧格式，与10BASE-T和100BASE-T向后兼容。</span></li><li><span>10吉比特以太网，帧格式完全相同，但只在全双工模式下工作，只使用光纤作为传输媒体。以上升级说明了以太网是可扩展的，可演进的，稳健性好。</span></li></ol></li></ol><h3><a name="3ieee-80211" class="md-header-anchor"></a><span>3.IEEE 802.11</span></h3><p><span>无线局域网的系列标准，主要包括了访问协调问题、错误控制（克服通信固有的不可靠）、适宜寻址、关联规程（可携带和移动性）、互联过程（扩展无线通信范围），允许用户移动通信。使用CSMA/CA协议进行介质访问控制，无线局域网中，即使冲突，也要将帧发送完，而有线中则是立即停止。无线局域网分为两大类，有固定基础设施和无固定基础设施（Ad Hoc网络）。</span></p><p><span>有固定基础设施：最小构件是基本服务集（Basic Service Set，BSS），一个基本服务集包括一个基站和若干移动站，所有站在本BSS内可以直接通信，基站也称为接入点AP（Access Point），作用和网桥类似。一个基本服务集可以孤立，也可以通过AP连接到主干分配系统（Distribution System，DS），然后接入其他基本服务集，从而构成扩展服务及（Extended Service Set，ESS），扩展服务集还可以通过门桥（Portal）为无线设备连接到非802.11无线局域网。</span></p><p><span>无固定基础设施无线局域网自组织网，可以不和因特网连接，有自己的组网和路由选择协议，各节点之间地位平等，中间结点都是转发节点，都具有路由器功能，网络中没有AP，与移动IP不相同。</span></p><h3><a name="4令牌环网的基本原理" class="md-header-anchor"></a><span>4.令牌环网的基本原理</span></h3><p><span>令牌环网的每一站与环接口干线耦合器（TCU）相连，TCU的主要作用是传递所有经过的帧，TCU有两个状态，收听和发送，媒体介入控制采用分布式控制模式的循环方法，有一个令牌（Token）沿着环形总线在节点间依次传递，Token是一个特殊格式的MAC控制帧，仅控制信道使用，因而能保证同一时刻只有一个结点能独占信道，不会发生碰撞，由于依次访问，所以网络各节点是公平的。物理上使用星型拓扑结构，逻辑上环形拓扑，标准为802.5。</span></p><h2><a name="七广域网" class="md-header-anchor"></a><span>（七)广域网</span></h2><h3><a name="1广域网的基本概念" class="md-header-anchor"></a><span>1.广域网的基本概念</span></h3><p><span>通常指覆盖范围广的长距离网络，是因特网的核心部分，任务是长距离运送主机所发送的数据，中间链路都是高速链路，如光缆、卫星 ，首要问题是通信容量足够大。广域网不等于互联网，互联网连接不同类型网络，使用路由器连接。广域网由节点交换机连接，节点交换机在单个网络中转发分组。广域网和局域网的联系：两者都是互联网重要组成部分，在互联网关系中，两者平等（而不是包含）；同一个网内的主机通信时，只需要使用物理地址，而不需要使用网际IP地址。</span></p><p><span>广域网和局域网区别：</span></p><figure><table><thead><tr><th>&nbsp;</th><th><span>广域网</span></th><th><span>局域网</span></th></tr></thead><tbody><tr><td><span>覆盖范围</span></td><td><span>很广，通常跨区域</span></td><td><span>较小，通常在区域内</span></td></tr><tr><td><span>连接方式</span></td><td><span>结点之间点对点连接，但是为了提高可靠性，一个结点交换机与多个节点交换机相连。</span></td><td><span>普遍采用多点接入技术</span></td></tr><tr><td><span>OSI层次</span></td><td><span>三层：物理、数据链路、网络层（主要工作在网络层）</span></td><td><span>两层：物理、数据链路层（主要工作在数据链路层）</span></td></tr><tr><td><span>着重点</span></td><td><span>资源共享</span></td><td><span>数据传输</span></td></tr></tbody></table></figure><p><span>广域网的一个重要问题是路由选择和分组转发，路由选择协议搜索最佳传输路由，构建路由表，并由此构建分组转发表，分组是通过转发表转发的。最常用协议是PPP和HDLC协议。</span></p><h3><a name="2ppp协议" class="md-header-anchor"></a><span>2.PPP协议</span></h3><p><span>PPP协议，（Point-to-Point Protocol），是使用串行线路通信的面向字节的协议，应用在直连两个结点的链路上，设计目的是用来通过拨号或专线方式建立点对点连接发送数据，是在SLIP协议基础上发展来的，可以在异步和同步线路上使用，不仅用于Modem链路，也可以用于路由器到路由器之间。相较SLIP增加了寻址、数据校验、分组类型识别、数据压缩等功能，只能传送IP分组。</span></p><p><span>PPP协议有三个组成部分：</span></p><ol start='' ><li><span>链路控制协议（LCP）：一种扩展链路控制协议，用于建立、配置、测试和管理数据链路。</span></li><li><span>网络控制协议（NCP）：允许同时采用多种网络协议，每个不同的网络层协议都需要一个相应的NCP配置，为网络层协议建立和配置逻辑链接。</span></li><li><span>将IP数据报封装到串行链路的方法，IP数据报就是PPP帧当中的信息部分，受最大传送单元MTU的限制。</span></li><li><img src="https://img-blog.csdn.net/20160204105742700" referrerpolicy="no-referrer" alt="这里写图片描述"></li></ol><p><span>PPP帧格式：|1字节界定符F（7E） | 1字节地址字段A（FF）| 1字节控制C（03） |2字节协议 | 信息部分 | 2字节FCS | 1字节界定符F（7E）|。所有PPP帧的长度都是整数个字节，因为是点对点而不是CSMA/CD，所以信息段没有最小长度，范围是0-1500B。数据部分出现和标志位一样的比特组合式，需要采用措施来实现透明传输。地址字段A、字节控制字段C固定，协议部分是PPP特有的，指明网络协议，0x0021表示IP数据报，FCS循环冗余，校验除了界定符以外的整个帧。</span></p><p><span>Notes：</span></p><ol start='' ><li><span>PPP提供差错检测，但不提供纠错功能，只保证无差错接收，所以是不可靠的传输协议，不使用序号和确认机制。</span></li><li><span>只支持点对点链路，不支持多点链路</span></li><li><span>只支持全双工链路</span></li><li><span>两端可以运行不同的网络层协议，可以用同一个PPP进行通信</span></li><li><span>面向字节，在信息字段出现和标志字段一致的比特组合时，异步线路下，默认采用字节填充法，在SONET/SDH等同步线路中，则采用硬件完成比特填充。</span></li></ol><p>&nbsp;</p><h3><a name="3hdlc协议" class="md-header-anchor"></a><span>3.HDLC协议</span></h3><p><span>高级链路控制协议（High-level Data Link Control）是ISO指定的面向比特的数据链路层协议（PPP面向字节），不依赖任何一种字符编码集，数据报文透明传输，用于实现透明传输的“0比特插入法”由硬件实现，全双工通信，有较高的数据链路传输效率，所有帧采用CRC校验，对信息帧顺序编号，传输可靠性高，传输控制和处理功能分离，灵活性强。适用于链路的两种基本配置，平衡和非平衡，非平衡的特点是由一个主站控制整个链路的工作，平衡则是链路两端都是复合站，平等传输。</span></p><ol start='' ><li><p><span>站：HDLC由三种类型的站，主站、从站、复合站，主站负则控制链路操作，发出命令帧，从站受控，回复响应帧，有些站兼有两者功能，即复合站，可以发出命令帧和响应帧。</span></p></li><li><p><span>数据操作方式：正常响应方式，非平衡结构操作方式，从站只有主站发出命令后才可以响应；异步平衡方式；异步响应方式，从站即使未受允许，也可以进行传输。</span></p></li><li><p><span>HDLC帧：| 8位标志F | 8位地址A | 8位控制C | 信息Info | 16位FCS | 8位标志F |，零比特填充法实现透明传输，5个连续的1后面填充0，接收端先定界，而后对信息字段检查删除填充的0。地址A在非平衡传送时，始终是从站地址，在平衡时，则是应答站的地址。控制C是最复杂的字段，根据前三位取值，分为三类：</span></p><ol start='' ><li><span>信息帧（I），第一位是0，用来传输数据，可以捎带确认</span></li><li><span>监督帧（S），第一位1，第二位0，用来流量控制和差错控制，对信息帧确认、请求重发和暂停发送等。</span></li><li><span>无编号帧（U），前两位都是1，提供链路建立、拆除等多种控制功能。</span></li></ol><p><span>HDLC使用了编号和确认机制，能够提供可靠传输，（而PPP不可靠）。</span></p></li></ol><h4><a name="关于mtu" class="md-header-anchor"></a><span>关于MTU：</span></h4><p><span>在物理层中，时钟同步信号必须在固定的时隙发出，所以需要限制MTU的大小，所以有如下常见MTU大小：FDDI（光纤局域）4352B，以太网1500B，PPPoE（ADSL）1492B，X.25（互联网）576B，PPP4470B。而上层数据包的实际大小依赖于下层的MTU大小。</span></p><h2><a name="八数据链路层设备" class="md-header-anchor"></a><span>（八)数据链路层设备</span></h2><h3><a name="1网桥的概念和基本原理" class="md-header-anchor"></a><span>1.网桥的概念和基本原理</span></h3><p><span>多个以太网通过网桥连接以后，就能成为一个更大的以太网，原本的每个以太网就成为一个网段。网桥工作在数据链路层的MAC子层，所以可以是各个网段成为隔离的碰撞域，但不隔离广播域。网段的故障也不会影响其他网段的工作。网桥处理数据的对象是帧所以是工作在数据链路层的。网桥收到某个网络发送的数据帧后，判断地址，如果是其他网络的地址，则相应转发给其他网络，如果是网段内地址，则丢弃。网桥连接的网段，数据的最大吞吐量是叠加的，而集线器或转发器没有这样的性质。</span></p><p><span>网桥的基本特点：</span></p><ol start='' ><li><span>具备寻址和路径选择能力，能确定帧的传输方向</span></li><li><span>能接收帧，并以目的网络的介质访问控制协议向目的网络转发，即可以在不同或相同的LAN之间进行存储转发（一般情况下，存储转发类设备都有协议转换、连接不同类型网络的能力）</span></li><li><span>一般对帧不做任何修改，或只对封装格式做很少的修改</span></li><li><span>可以通过帧翻译互联不同类型的LAN</span></li><li><span>应该有足够大的缓存空间</span></li></ol><p><span>优点：</span></p><ol start='' ><li><span>能过滤通信</span></li><li><span>扩大了物理范围</span></li><li><span>可以使用不同的物理层</span></li><li><span>可以互联不同类型的LAN</span></li><li><span>提高了可靠性</span></li><li><span>改善了性能</span></li></ol><p><span>缺点 ：</span></p><ol start='' ><li><span>增大时延</span></li><li><span>MAC子层没有流量控制功能（流量控制需要使用编号机制，这部分在LLC子层实现。）</span></li><li><span>不同MAC子层的网段桥接在一起时，需要进行帧格式的转换</span></li><li><span>只适合用户数不多通信量不大的局域网，否则可能因为传播过多广播信息导致拥塞，即广播风暴。</span></li></ol><p><span>网桥根据路径选择算法的不同，分为透明网桥和源路由网桥两种：</span></p><ol start='' ><li><span>透明网桥：以混杂方式工作，接收每一帧，如果源LAN和目的LAN相同，则丢弃，如果不同则转发，如果目的LAN未知，则扩散这个帧。网桥刚连接到以太网时，转发表是空的，按照自学习算法处理，即从A站达到网桥的某个端口，则这个端口也一定能将帧送到A站。所以每收到一个帧就记录源地址和端口号，作为转发表表项。为了避免帧在环中重复，还使用了生成树算法，保证每个源到任何一个目的地路径唯一，使整个扩展局域网在逻辑上形成树状结构，但一般生成树不是最佳路由。</span></li><li><span>源路由网桥（最佳路由）：路由选择由发送数据帧的原站负则，主机必须知道网桥标识和连接的网段，源站会以广播方式向目的站发送一个发现帧（Discovery Frame），每个网桥都会转发这个帧，目的站也会对所有收到的帧意义发送应答，收到所有应答后，源站选择一个RTT最短的最佳路由，发送帧还可以确定整个网络能通过的帧的最大长度，但由于发现帧的数量指数型增加，也可能会使网络严重拥塞。</span></li><li><span>比较：源路由可以利用最佳路由，还能将通信量平均分配给每个网桥，进行负载均衡，透明网桥对源站透明，但是不保证生成树产生的是最佳路由。</span></li></ol><h3><a name="2局域网交换机及其工作原理" class="md-header-anchor"></a><span>2.局域网交换机及其工作原理</span></h3><p><span>桥接器主要限制是在任一时刻只能执行一帧的转发操作，于是出现了局域网交换机，也叫以太网交换机，本质上说是一个多端口的网桥，工作在数据链路层，分割冲突域，为工作站提供更高的带宽。以太网交换机对于主机是透明的，管理开销低廉，简化了网络节点的增加、移动和网络变化，还能方便的实现虚拟局域网（Virtual LAN，VLAN），VLAN还能分隔广播域。</span></p><p><span>以太网交换机的原理是通过端口的源和目的MAC地址对比动态查找表，若不在查找表，则加入并转发。</span></p><p><span>特点如下：</span></p><ol start='' ><li><span>每个端口都与单台主机相连（网桥端口往往连接网段），而且一般是全双工方式</span></li><li><span>以太网交换机能同时联通许多对端口，每对主机都能像独占媒体那样无碰撞传输。</span></li><li><span>是一种即插即用设备，转发表是通过自学习算法建立的。</span></li><li><span>使用了专用的交换结构芯片，所以交换效率较高</span></li><li><span>独占传输媒体的全部带宽。即如果有N对端口，则交换总容量为N×带宽，这就是交换机的最大优点。</span></li></ol><p><span>交换机有两种交换模式，即直通式和存储转发式。直通式只检查目的地址，接收后马上转发，这种方式速度快，但是缺乏安全性和智能性，也不能支持不同速率的端口交换；存储转发式会检查数据是否正确，如果出错则丢弃，可靠性高，且支持不同速率端口的转换，缺点是延迟较大。</span></p><h1><a name="四网络层" class="md-header-anchor"></a><span>四、网络层</span></h1><h2><a name="一网络层的功能" class="md-header-anchor"></a><span>（一)网络层的功能</span></h2><h3><a name="1异构网络互联" class="md-header-anchor"></a><span>1.异构网络互联</span></h3><p><span>异构网络就是结构不同的网络，网络互联就是两个以上的计算机网络能通过一定方法，有中间设备连接器起来构成更大的网络，中间设备也称为中间系统或中继系统，根据层次，中继系统分为以下四类：</span></p><ol start='' ><li><span>物理层：中继器、集线器</span></li><li><span>数据链路层：网桥、交换机</span></li><li><span>网络层：路由器</span></li><li><span>网络层以上：网关</span></li></ol><p><span>物理层或数据链路层中继系统只是将网络扩大，在网络层角度看仍然是同一个网络，所以一般网络互连指用路由器进行网络互联和路由选择，路由器是一种专用计算机，用于路由选择。</span></p><p><span>TCP/IP体系在网络互联上，采用的是在网络层即IP层，采用标准化协议，即都使用网际协议（Internet Protocol），因此可以把互联后的计算机网络视为一个虚拟IP网络，虚拟互联网络也就是逻辑互联网络，使用IP的虚拟互联网络可以简称为IP网络。好处是主机通信时，不需要了解网络异构细节。</span></p><h3><a name="2路由与转发" class="md-header-anchor"></a><span>2.路由与转发</span></h3><p><span>路由器主要完成两个功能，即路由选择和分组转发，前者还要根据路由选择协议构造路由表，还要经常性的和邻接路由器交换路由表进行更新和维护，后者处理通过路由器的数据流，关键操作是转发表查询、转发和相关任务队列管理和调度，将用户的IP数据报从合适的端口转发出去。</span></p><h3><a name="3拥塞控制" class="md-header-anchor"></a><span>3.拥塞控制</span></h3><p><span>在通信子网中，由于过量分组导致网络性能下降的现象称为拥塞。在分组速率接近链路带宽时，平均时延急剧增加、缓冲有限导致大量分组被丢弃，吞吐量骤降，平均时延近乎无穷大。所以网络利用率太高也不一定是好事。</span></p><p><span>对于拥塞状态的判断，主要通过观察网络吞吐量和负载的关系，负载增加导致吞吐量明显小于正常吞吐，则可能已经进入轻度拥塞，吞吐量随负载增大而下降，则可能进入拥塞，而吞吐量下降到0，意味着网络可能进入死锁状态。</span></p><p><span>拥塞控制是一个全局的行为，涉及到各方面，单一的增加资源并不能解决拥塞。拥塞和流量控制不同，流量控制往往是链路中点对点通信量的控制，流量控制只需要抑制发送端的发送速率，而拥塞需要保证通信子网能够传送待传送的数据，是一个全局问题。</span></p><p><span>拥塞控制主要有开环控制和闭环控制两种，开环时静态控制，在设计网络之处就考虑好所有因素，力求不发生拥塞。而闭环控制是通过反馈控制，设置监控网络间时网络情况，对拥塞进行检测，并传递拥塞信息，动态调整网络运行，基于反馈环路的概念，是动态方法。</span></p><h2><a name="二路由算法" class="md-header-anchor"></a><span>（二)路由算法</span></h2><h3><a name="1静态路由与动态路由" class="md-header-anchor"></a><span>1.静态路由与动态路由</span></h3><p><span>静态路由算法，由网路管理员手工配置路由信息，在网络拓扑或链路状态变化时，需要管理员手工修改相关静态信息，不适用于大型和复杂的网络，因为一方面管理员很难了解整个拓扑结构，另一方面，路由信息可能需要大范围调整，这一工作难度和复杂度都很高。</span></p><p><span>动态路由算法，也叫自适应路由算法，是通过相互连接的路由器之间彼此交换信息，按照一定算法优化，路由信息在一定时隙内更新，随时获得最有的寻路效果。</span></p><p><span>静态算法的优点是简便、可靠，在负荷稳定、拓扑变化不大的网络中运行效果很好，广泛应用于高度安全的军事系统和较小的商业网络，动态路由算法能改善网络性能，并有助于流量控制，但是算法复杂，会增加网络负担，优势还会因为对动态变化的反映太快导致震荡，或反映太慢影响网络路由的一致性，常用的动态路由算法分为距离-向量路由和链路状态路由算法两种。</span></p><h3><a name="2距离-向量路由算法" class="md-header-anchor"></a><span>2.距离-向量路由算法</span></h3><p><span>所有结点定期将整个路由表和相邻结点交换，包括目的地和路径距离（距离是一种抽象概念，可以用跳数等具象描述）。所有节点都必须参与距离向量交换，保证路由的有效性和一致性，所有节点监听路由选择信息，在被告知新路由或距离更短的路由时，更新自己的路由表。</span></p><p><span>距离向量的算法实质是迭代计算一条路由中的站段数或延迟时间（距离）从而得到一个最小距离的通路，主要发问题在于全部路由表都要发给相邻结点，更新的报文大小和通信子网节点个数正比，这一信息可能会很大。</span></p><p><span>最常见的是RIP算法，采用“跳数”即经过的路由器个数作为距离度量。</span></p><h3><a name="3链路状态路由算法" class="md-header-anchor"></a><span>3.链路状态路由算法</span></h3><p><span>要求每个结点都具有完全的网络拓扑信息，主动测试所有邻接节点状态，定期将链路状态传播给其他所有节点（或路由节点），结点不只是发给相邻节点，而是将相邻链路发送给所有节点，每个节点收到状态信息后，利用最短路径算法重新计算路由，去更新网络拓扑和状态“视野图”。常见的有OSPF协议。</span></p><p><span>主要有以下三个特征：</span></p><ol start='' ><li><span>向本自治系统中的所有路由器发送信息，即泛洪法</span></li><li><span>发送的信息是相邻路由器的链路状态，链路状态主要说明和相邻链路的“度量”（如费用、距离、时延、带宽）</span></li><li><span>只有在链路发生变化时，路由器才向所有路由器发送消息。</span></li></ol><p><span>由于链路状态只涉及相邻路由器，所以报文与互联网规模无关，所以可以用于大型的或路由信息变化聚敛的互联网环境。主要优点时每个节点用同样的原始状态数据独立计算路径，而不依赖中间结点的计算；链路状态报文不加改变的传播，易于查找故障；结点收到报文后，在本地直接计算正确的通路，保证一步汇聚；报文大小与网络规模无关，规模可伸展性好。</span></p><p><span>距离向量算法每个结点和邻居交换信息，链路状态中通过广播和所有其他结点交谈，所以距离向量算法更有可能遇到路由环路问题。</span></p><h3><a name="4层次路由" class="md-header-anchor"></a><span>4.层次路由</span></h3><p><span>网络规模扩大时，路由器需要更多的CPU时间扫描路由表、更大的带宽交换路由状态信息，所以要按照层次方式进行。</span></p><p><span>因特网将互联网划分成许多较小的自治系统，一个自治系统中，包含很多的局域网，每个自治系统有权自主决定本系统内采用何种路由选择协议，一个自治系统内部的称为内部网关协议（IGP），也称域内路由选择，具体的有RIP和OSPF，自治系统之间的称为外部网关协议（EGP），也称域间路由选择，具体协议有BGP，在层次路由中，一个OSPF将一个自治系统再划分为若干区域Area，每个路由器知道本区域内的路由细节，但不知道其他区域的内部结构，采用分层次的方法会使交换信息的种类增多，也使OSPF协议复杂，但是能大大减小路由信息通信量，因此OSPF能用在规模很大的自治系统中。</span></p><h2><a name="三ipv4" class="md-header-anchor"></a><span>（三)IPv4</span></h2><h3><a name="1ipv4分组" class="md-header-anchor"></a><span>1.IPv4分组</span></h3><p><span>IPv4即目前普遍使用的IP版本，IP定义了数据传送的基本单元IP分组，IP还包含了非可靠投递的思想，以及相关分组路由选择。</span></p><p><img src="https://upload-images.jianshu.io/upload_images/3130736-7d489f45692e1b79?imageMogr2/auto-orient/strip|imageView2/2/format/webp" referrerpolicy="no-referrer" alt="IP数据报首部"></p><p><span>首部前一部分长度固定为20B，后面是可选字段，长度可变，用来检错和提供安全机制。</span></p><ol start='' ><li><span>版本：目前为4</span></li><li><span>首部长度：4位，单位为4B，最大值60B，20B时不使用任何选项（可选字段）</span></li><li><span>总长度：16位，单位字节，最大表示长度64KB（65535B），实际上一个IP数据报封装成帧后总长度不能超过MTU的值。</span></li><li><span>标识：占16位，每个产生一个数据报就+1，并不是序号，但每个数据报拥有同一标识</span></li><li><span>标志：最高位暂时无用，中间DF（Don‘t Fragment）=1表示不允许分片，最低位MF（More Fragment）=1表示还有后续数据。</span></li><li><span>片偏移：占13位，表示较长的分组在分片后，片的相对位置，以8B为偏移单位。</span></li><li><span>生存时间（TTL），占8位，表示可通过的路由器最大值（最大255），每通过一个就-1，为0时丢弃。</span></li><li><span>协议，占8位，表示交付给哪个传输层协议，6为TCP，17为UDP，89为OSPF。</span></li></ol><figure><table><thead><tr><th><span>协议号</span></th><th><span>1</span></th><th><span>2</span></th><th><span>4</span></th><th><span>5</span></th><th><span>6</span></th><th><span>8</span></th><th><span>9</span></th><th><span>17</span></th><th><span>41</span></th><th><span>89</span></th></tr></thead><tbody><tr><td><span>协议</span></td><td><span>ICMP</span></td><td><span>IGMP</span></td><td><span>IP</span></td><td><span>ST</span></td><td><span>TCP</span></td><td><span>EGP</span></td><td><span>IGP</span></td><td><span>UDP</span></td><td><span>IPv6</span></td><td><span>OSPF</span></td></tr></tbody></table></figure><ol start='9' ><li><span>首部校验和，16位，只校验首部。</span></li><li><span>源地址字段：4B，发送方IP。</span></li><li><span>目的地址字段：4B，接收方IP。</span></li></ol><p><span>首部中有三个长度表示，首部长度（4B），总长度（1B），片偏移（8B）</span></p><p><span>分片：链路层承载的最大数据量为最大传送单元MTU，MTU严格限制IP数据报长度，在数据报超过MTU承载长度是，组要分片，分装在多个较小的数据报中，这些包称为片（Chip）。分片在目的网络层重组，使用标识、标志、片偏移完成重组，每个片都有标识号，MF=1时，还有后续分片，MF=0表示数据报结尾。片偏移字段决定片放在原始IP数据报中的位置，分片时，还要考虑首部长度，对于一个1500B的MTU，IP数据报最大长度应为1480B（此时TCP段中最大数据量为1460B）</span></p><p><span>分组转发流程：</span></p><ol start='' ><li><span>首部提取目的主机地址D，得出网络地址N。</span></li><li><span>N与路由器直接相连，则交给主机D，即直接交付；否则称为间接交付，执行下一步。</span></li><li><span>路由表中有目的地址为D的特定主机路由，则传给路由表中对应的下一跳路由器，否则进行下一步。</span></li><li><span>若有达到网络N的路由，则传给对应的下一跳路由器，否则下一步。</span></li><li><span>若路由表中有默认路由，则将数据报传给默认路由，否则报告转发分组出错。</span></li></ol><p><span>注意：在得到下一跳的IP地址后，不是直接填入，而实转换成MAC地址，而后填入MAC帧的首部，路由器在转发中会改变MAC帧的源地址和目的地址、网桥转发时，不改变源地址。</span></p><h3><a name="2ipv4地址与nat" class="md-header-anchor"></a><span>2.IPv4地址与NAT</span></h3><p><span>连接到因特网的每台主机都分配一个32比特的全球唯一标识符，即IP地址。</span></p><p><span>无论哪种IP地址，都由网络号和主机号两部分组成，网络号和网络中的主机号是唯一的，因此一个IP地址在因特网范围内时唯一的，一般分为A、B、C、D、E类网络：</span></p><figure><table><thead><tr><th><span>网络类别</span></th><th><span>特征、网络号位数</span></th><th><span>可用网络数</span></th><th><span>第一个网络号</span></th><th><span>最后一个网络号</span></th><th><span>主机位数</span></th><th><span>最大主机数</span></th></tr></thead><tbody><tr><td><span>A类</span></td><td><span>首位0、8位</span></td><td><span>2</span><sup><span>7</span></sup><span>-2（全0保留，表示本网络，127为环回测试地址</span></td><td><span>1</span></td><td><span>126</span></td><td><span>24</span></td><td><span>2</span><sup><span>24</span></sup><span>-2</span></td></tr><tr><td><span>B类</span></td><td><span>前两位10、16位</span></td><td><span>2</span><sup><span>14</span></sup><span>-1(128.0全零不可指派)</span></td><td><span>128.1</span></td><td><span>191.255</span></td><td><span>16</span></td><td><span>2</span><sup><span>16</span></sup><span>-2</span></td></tr><tr><td><span>C类</span></td><td><span>前三位110、24位</span></td><td><span>2</span><sup><span>21</span></sup><span>-1(192.0.0全零不可指派)</span></td><td><span>192.0.1</span></td><td><span>233.255.255</span></td><td><span>8</span></td><td><span>2</span><sup><span>8</span></sup><span>-2</span></td></tr><tr><td><span>D类</span></td><td><span>前四位1110</span></td><td><span>多播地址</span></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><span>E类</span></td><td><span>前四位全1</span></td><td><span>保留今后使用</span></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr></tbody></table></figure><p><span>特殊网络地址：</span></p><ul><li><span>主机号全0，表示网络本身，如202.98.174.0</span></li><li><span>主机号全1，表示网络内广播地址，也叫直接广播地址，如202.98.174.255</span></li><li><span>127.0.0.0保留为环路自检（Loopback Test）地址，表示任意主机本身，不会出现在任何网络上</span></li><li><span>32位全0，即0.0.0.0表示本网络上的本主机</span></li><li><span>32位全1即255.255.255.255表示整个TCP/IP网络的广播地址，也称受限广播地址，但因为路由器对广播域的隔离，等效为本网广播地址</span></li></ul><p><span>IP地址特点有：</span></p><ol start='' ><li><span>每个地址由网络号和主机号两部分组成，是一种分等级的地址结构，好处是</span>1️⃣<span>IP地址管理机构只分配网络号，主机号自行分配，方便管理，</span>2️⃣<span>路由器仅根据网络号转发分组，减小了路由表的存储空间。</span></li><li><span>IP地址是标志一台主机（路由器）和一条链路的接口，一个主机连接到多个网络就需要多个IP地址，每个地址的网络号必须与所在网络相同</span></li><li><span>用转发器或桥接器（网桥等）连接的若干个LAN仍属于同一个网络（同一个广播域），同一个LAN网络号相同，主机号必须不同。</span></li><li><span>IP地址中，所有分配到的网络号都是平等的。</span></li><li><span>同一个局域网上的网络号是一样的，路由器总是有两个及以上的IP地址，路由器的每个端口都有一个不同网络号的IP地址。</span></li></ol><p><span>NAT：</span></p><p><span>网络地址转换（NAT）利用软件，将专用网络地址（Intranet）转换成公用地址（Internet），从而对外隐藏内部管理的IP地址，使一个专用网络只需要一个外部IP地址即可，专用网络的IP地址是可重用的，由此大大节省了IP地址的消耗，隐藏了内部网络结构，降低了内部网络收到攻击的危险。</span></p><p><span>此外设置了私有地址，私有地址只用于LAN，路由器不会转发，采用私有地址的称为专用互联网或本地互联网，需要网关用NAT将私有IP转换位全球IP，有以下私有地址：</span></p><ul><li><span>A类：1个A类网段，10.0.0.0-10.255.255.255，（网络号10）</span></li><li><span>B类：16个B类网段，172.16.0.0-172.31.255.255，（网络号172.16-172.31）</span></li><li><span>C类：256个C类网段，192.168.0.0-192.168.255.255，（网络号192.168.0-192.168.255）</span></li></ul><p><span>私有IP地址也称为可重用地址，NAT路由器至少有一个有效的外部全球地址，NAT转换表存放着{本地IP地址:端口}到{全球IP地址:端口}，这样只要一个全球地址就能让多台主机同时访问互联网，普通路由器在转发IP数据报时，不改变IP地址，NAT路由器则还需要更换源IP目的地址或目的IP地址，普通路由器工作在网络层，NAT路由器还需要查看和转换端口号（传输层）。</span></p><h3><a name="3子网划分与子网掩码cidr" class="md-header-anchor"></a><span>3.子网划分与子网掩码、CIDR</span></h3><p><span>子网划分：</span></p><p><span>两级地址导致IP地址的空间利用率有时候很低，不够灵活。1985年增加了一个“子网号字段”，是两级变成了三级IP地址，这种做法称为子网划分。基本思路如下：</span></p><ol start='' ><li><span>子网划分是一个单位内部的事情，对外表现为没有划分子网的网络</span></li><li><span>从主机号借用若干位比特作为子网号，主机也减少了相应的比特，结构如下：IP地址={&lt;网络号&gt;,&lt;子网号&gt;,&lt;主机号&gt;}。</span></li><li><span>凡是从其他网络发来的IP数据报仍然是根据网络号找到本单位网络路由器，而后转发给对应子网，最后由子网交付给目的主机。</span></li><li><span>即划分子网只是对主机号进行再划分，不改变网络号，因此外部无法判断是否进行了子网划分，子网号不能为全0或全1，但CIDR支持。</span></li></ol><p><span>子网掩码：为了告诉主机或路由器进行了子网划分，需要子网掩码来表达对原来主机号的借位。子网掩码是一个和IP对应的，4B的二进制串，IP地址和掩码逐位与（AND逻辑运算）就能得出对应子网网络号。由于子网掩码是网络重要属性，所以再路由器相互交换路由信息是，需要告知自己的子网掩码，路由表的每个条目也要给出对应子网掩码。使用子网掩码的情况如下：</span></p><ol start='' ><li><span>主机设置IP时，必须设置子网掩码</span></li><li><span>同属一个子网的所有主机路由器都需要设置相同的子网掩码。</span></li><li><span>路由表中主要内容必须有网络地址、子网掩码、下一跳地址。</span></li></ol><p><span>使用子网掩码时，分组转发改为，将目的地址与路由表中的子网掩码相与，结果和路由表中的网络号相匹配，得出网络地址后直接或间接交付。</span></p><h4><a name="cidr路由聚合2021考纲新增）" class="md-header-anchor"></a><span>CIDR、路由聚合（2021考纲新增）</span></h4><p><span>无分类域间路由选择（Classless Inter-Domain Routing，CIDR）无分类域间路由选择是在变长子网掩码的基础上提出的消除传统ABC类网络划分，且在软件支持下可以实现超网构建的一种IP地址划分方法。主要特点有：</span></p><ol start='' ><li><span>取消了传统的ABC类地址，采用网络前缀的概念代替子网，IP的无分类两级编制为IP::={&lt;网络前缀&gt;,&lt;主机号&gt;}，采用斜线记法（CIDR记法），即IP地址/前缀长度（所占比特数），网络前缀直接截取相应前缀长度。仍然使用掩码一次，不使用子网指的是没有指明若干位作为子网字段，但是分配到一个CIDR地址块的组织仍然可以根据需要划分子网。允许使用全0和全1的主机号地址，但一般不使用。</span></li><li><span>网络前缀相同的连续IP地址可以组成CIDR地址块，一个CIDR地址块可以表示很多地址，这也称为路由聚合或构成超网。</span></li></ol><p><span>路由聚合将一些网络构成一个更大的地址块，将他们的路由聚合成一条路由。地址块中的地址数是一定是2的整数次幂，实际可指派的地址数通常为2</span><sup><span>N</span></sup><span>-2，N表示主机号位数，主机号全0表示网络号，全1表示广播地址，前缀越短，包含地址越多。优点在于前缀长度的灵活性，能使上层网络的前缀较短、对应路由表项较少，内部则可以通过延长网络前缀灵活的划分子网。</span></p><p><span>最长前缀匹配（最佳匹配）：在CIDR中，每个路由表表项由网络前缀和下一跳地址组成，因此查找时可能由多个匹配结果，需要选择最长前缀的路由，因为前缀越长地址块越小，对应的路由越具体。因此CIDR查找路由表的方法，将无分类编址的路由表存放在层次数据结构中（如二叉线索树）自上而下按层次进行查找（树的层序遍历）。</span></p><h3><a name="4arp协议dhcp协议与icmp协议" class="md-header-anchor"></a><span>4.ARP协议、DHCP协议与ICMP协议</span></h3><ol start='' ><li><p><span>IP和硬件地址：MAC地址在MAC帧首部，IP地址在IP数据报首部，数据链路层看不见数据报中的IP地址，但由于路由器的隔离，无法通过广播方式用MAC地址完成跨网络的寻址，只能在网络层使用IP地址来寻址，路由器依据路由表项选择目标表网络的需要转发的下一跳，IP分组在多次转发后在目标LAN中通过MAC地址广播寻址提高路由选择效率。于是有：</span></p><ol start='' ><li><span>在IP层抽象的互联网上只有IP数据报</span></li><li><span>路由器只根据目的IP进行路由选择</span></li><li><span>局域网的链路层能看见MAC帧，IP分组在每个路由器中都被解封和重新封装，所以在转发时MAC地址不断改变，决定了无法使用MAC地址进行跨网络通信。</span></li><li><span>IP层抽象的互联网屏蔽了下层细节，在网络层上能用统一的IP地址研究通信</span></li></ol></li><li><p><span>ARP：地址解析协议（Address Resolution Protocol，ARP），完成IP地址到MAC地址的映射，每台主机都有ARP高速缓存，存放本LAN中主机和路由器的IP和MAC地址映射表，也称ARP表，使用ARP来动态维护ARP表。ARP工作在网络层，（因为NAT看到端口，可以组成套接字即传输层SAP，所以工作在传输；ARP知道IP地址和MAC地址，所以在网络层）。ARP在本地缓存中没有找到对应MAC时，使用全1的MAC地址广播ARP请求分组，同一个LAN内所有主机都能收到，拥有目的IP地址的主机B向主机A发送响应ARP分组，响应分组普通单播，主机A收到后写入缓存并发送MAC帧。同网络中，ARP直接获取目的主机MAC，不同LAN时，ARP获取对应网络的网关MAC，并发送给对应路由器，由网关完成剩余工作。</span></p></li><li><p><span>DHCP：动态主机配置协议（Dynamic Host Configuration Protocol，DHCP），常用于给主机动态分配IP地址，提供即插即用的联网机制，DHCP是一个基于UDP的应用层协议，使用C/S方式，需要IP地址的主机在启动时向DHCP服务器广播发送发现报文，主机此时成为DHCP客户，所有主机都能收到，但只有DHCP服务器会回复，DHCP服务器先查找计算机配置信息，找不到则从IP池中取一个地址分配给计算机，回复提供报文。具体交换过程如下：</span></p><ol start='' ><li><span>DHCP客户机广播“DHCP发现”消息，</span></li><li><span>DHCP收到DHCP发现消息后，向网络中广播DHCP提供消息，包括提供的IP地址和相关配置信息，</span></li><li><span>DHCP客户机收到DHCP提供消息后，如果接受，就广播DHCP请求消息，向DHCP服务器请求提供。</span></li><li><span>DHCP广播DHCP确认消息，将IP地址分配给DHCP客户机。</span></li></ol><p><span>网络允许配置多台DHCP服务器，在收到多个DHCP提供时，用户只选一个，通常是最先到达的。DHCP分配的IP地址是临时的，使用时间为租用期，租用期由服务器决定，DHCP客户也可以在报文中提出要求。DHCP需要全程广播来进行交互，因为DHCP执行期间，客户没有自己的IP地址表示身份，所以也不可能采用基于套接字连接的TCP协议。</span></p></li><li><p><span>ICMP，网际控制报文协议（Internet Control Message Protocol），属于IP层协议，在IP数据报中，协议号为1，主要分为两种报文类型，差错报告和ICMP询问报文。主要有以下五种类型：</span></p><ol start='' ><li><span>终端不可达：不能交付数据时向源发送</span></li><li><span>源点抑制：拥塞导致数据报丢弃时，向源点发送源点抑制报文，以减慢发送速率。</span></li><li><span>时间超过，TTL（生存时间）为0的数据丢弃，并向源点发送时间超过；或重点在预定时间内没有收到全部数据报，就丢弃已经收到的部分，并向源点发送时间超过。</span></li><li><span>参数问题：路由器或主机发现IP数据包首部字段不正确是，丢弃并向源点发送参数问题</span></li><li><span>改变路由（重定向），路由器把改变路由的报文发送给主机，让主机下次使用更优的路由。</span></li></ol><p><span>不能发送差错报文的情况如下：</span></p><ol start='' ><li><span>对于ICMP差错报告报文不再发送ICMP差错报告报文。</span></li><li><span>对第一个分片数据报的所有后续分片都不再发送差错报告报文</span></li><li><span>对具有组播地址的数据报都不发送ICMP差错报文</span></li><li><span>对于特殊地址（127.0.0.0）或（0.0.0.0）不发送</span></li></ol><p><span>询问报文分为四类：回送请求和回答报文、时间戳请求和回答报文、掩码地址请求和回答报文、路由器询问和通告报文，前两类最常用。</span></p><p><span>ICMP的两个最常见应用是分组网间探测PING，和Traceroute/tracert，Traceroute在UNIX而tracert在Windows，用来追踪分组经过的路由，PING使用了回送请求和回答报文，Traceroute使用了ICMP时间超过报文，且PING工作在应用层，而Traceroute/Tracert工作在网络层。</span></p></li></ol><h2><a name="四ipv6" class="md-header-anchor"></a><span>（四)IPv6</span></h2><h3><a name="1ipv6的主要特点" class="md-header-anchor"></a><span>1.IPv6的主要特点</span></h3><p><span>为了解决IP地址耗尽问题，主要有</span>1️⃣<span> 采用无类别编址CIDR，</span>2️⃣<span> 采用网络地址转换（NAT），</span>3️⃣<span> 采用具有更大地址空间的IPv6，只有IPv6能从根本上解决问题。</span></p><p><span>主要特点有：</span></p><ol start='' ><li><span>更大的地址空间，从32位增大到128位，字节数16是v4的平方。</span></li><li><span>扩展的地址层次结构</span></li><li><span>灵活的首部格式</span></li><li><span>改进的选项</span></li><li><span>允许协议继续扩充。</span></li><li><span>支持自动配置和即插即用。</span></li><li><span>支持资源的预分配。</span></li><li><span>只有在源节点允许分片，是端到端的，路径中的路由器不允许分片。一般意义上，不允许分片。</span></li><li><span>首部长度必须是8B的整数倍，而v4是4B的整数倍。</span></li><li><span>增大了安全性，身份验证和保密功能是IPv6的关键特征。</span></li></ol><p><span>虽然IPv6和v4不互相兼容，但和其他因特网协议（如TCP、UCP、ICMP、IGMP、OSPF、BGP、DNS）兼容，而且很好的满足了预定目标，首先有绝对够用的地址；简化了IP分组头，包含8个域（v4有12个），让路由器更快处理从而改善吞吐率；更好地支持选项，能够加快分组处理速度。</span></p><h3><a name="2ipv6地址" class="md-header-anchor"></a><span>2.IPv6地址</span></h3><p><span>目的地地址有三种基本类型：</span></p><ol start='' ><li><span>单播，即点对点通信</span></li><li><span>多播，一点对多点的通信，分组被交付到一组中的每台计算机</span></li><li><span>任播，目的是一组计算机，但交付时只交付其中一台，通常是距离最近的一台。</span></li></ol><p><span>采用冒号16进制表示法，每4我i用一个16进制数表示，冒号分隔每16位，还有缩写形式，将多个0缩写为一个0，有相继的0值域时，还可以进一步缩写，用双冒号（::）表示多个0，但在一个地址中只能出现一次。</span></p><p><span>IPv6采用3个等级，第一级（顶级）指明全球都知道的公共拓扑，第二级（场点级）指明单个场点，第三级指明单个网络接口，多级体系主要为了更快查找路由。</span></p><p><span>过渡采用逐步眼睛的方法，IPv6系统能够接受和转发IPv4分组，并能选择路由，过渡中使用双协议栈和隧道技术两种策略，双协议栈时同时又v4和v6的协议，能同时和v4和v6网络通信，隧道技术是将v6的整个数据报封装到v4的数据报数据部分，并通过v4的网络隧道传输。</span></p><h2><a name="五路由协议" class="md-header-anchor"></a><span>（五)路由协议</span></h2><h3><a name="1自治系统" class="md-header-anchor"></a><span>1.自治系统</span></h3><p><span>自治系统（Autonomous System，AS），单一技术管理下的一组路由器，使用AS内部的路由选择协议和共同的度量来确定分组在AS内的路由，使用AS之间的路由选择协议进行分组在AS间的路由，一般一个AS内部的网络由一个行政单位管辖，所有路由器在本AS内都必须是连通的。</span></p><h3><a name="2域内路由与域间路由" class="md-header-anchor"></a><span>2.域内路由与域间路由</span></h3><p><span>域内路由即内部网关协议，（Interior Gateway Protocol，IGP），如RIP和OSPF，目前使用最多。</span></p><p><span>域间路由即外部网关协议，（External Gateway Protocol，EGP），目前使用最多的是BGP-4。</span></p><h3><a name="3rip路由协议" class="md-header-anchor"></a><span>3.RIP路由协议</span></h3><p><span>路由信息协议（Routing Information Protocol，RIP）是IGP中最先得到广泛应用的协议，是一种分布式的基于距离向量的路由选择协议，最大优点是简单。规定：</span></p><ol start='' ><li><span>每个路由器维护到其他每个目的的距离记录，也称为距离向量。</span></li><li><span>距离使用跳数定义，（Hop Count），每经过一个路由器，跳数加一。</span></li><li><span>RIP优先选择跳数少的路由。</span></li><li><span>一条路径最多15跳，距离等于16表示网络不可达。只适用于小型互联网，规定最高跳数是为了防止循环，减少网络拥塞的可能性。</span></li><li><span>默认在两个使用RIP的路由器之间每30s广播一次RIP路由更新信息，一边自动建立并维护路右边（动态维护）。</span></li><li><span>RIP中不支持子网掩码的RIP广播，需要使用定长子网掩码，但RIP2中支持变长子网掩码和CIDR。</span></li></ol><p><span>特点：之和相邻路由器交换信息；交换全部路由表；固定时间间隔交换。</span></p><p><span>经过若干次RIP广播后，每个路由器都能知道整个网络的路由表，最终收敛，收敛后到每个目标网络的路由都是距离最短的。</span></p><p><span>距离向量算法：每个路由表项保存三个关键数据，&lt;目的网络N，距离d，下一条路由器X&gt;。对于每个相邻路由器的RIP报文，操作如下：</span></p><ol start='' ><li><p><span>对于相邻的路由器X的RIP报文，先将报文中的所有d++，并把所有下一跳字段改为X。</span></p></li><li><p><span>对比报文和本地路由表，</span></p><ol start='' ><li><span>本地没有的网络N，添加</span></li><li><span>本地有的网络N，下一跳是X时，用收到的项目更新</span></li><li><span>本地有的网络N，下一跳距离大于报文中的d，则替换。</span></li></ol></li><li><p><span>如果180s（默认180s）没有收到相邻路由器的更新路由表，将之设置为不可达路由器，距离设为16。</span></p></li><li><p><span>返回。</span></p></li></ol><p><span>最大的优点时简单、开销小、收敛过程快，缺点如下：</span></p><ol start='' ><li><span>限制了网络规模，即最大15跳，</span></li><li><span>交换完整路由表，网络越大，开销越大。</span></li><li><span>网络故障时，会出现慢收敛，需要很长时间才能传送到所有路由器，即“坏消息传得慢”</span></li></ol><p><span>RIP是应用层协议，使用UDP传送数据，端口520，选择路径不一定是时间最短的，但一定是跳数最少的</span></p><h3><a name="4ospf路由协议" class="md-header-anchor"></a><span>4.OSPF路由协议</span></h3><p><span>基本特点：开放最短路径优先协议是使用分布式链路状态路由算法的代表，与RIP的主要区别有：</span></p><ol start='' ><li><span>OSPF向本AS内的所有路由器发送信息，使用洪泛法，而RIP只和邻居交换信息</span></li><li><span>发送的信息是相邻所有路由器的链路状态，链路状态说明邻接关系和链路代价，RIP交换整个路由表。</span></li><li><span>链路状态变化时，OSPF才洪泛法向所有路由器发送此消息，更新收敛快，没有坏消息传得慢的问题，交换信息量少。</span></li><li><span>OSPF是网络层协议，使用IP数据报89号协议直接发送，RIP基于UDP。</span></li></ol><p><span>此外，OSPF还有以下特点：</span></p><ol start='' ><li><span>可以根据IP分组的不同服务类型（TOS）设置成不同的代价，对于不同类型的业务可以计算不同的路由，灵活。</span></li><li><span>如果有多条最小代价路径，可以多路径间的负载平衡。</span></li><li><span>分组具有鉴别功能，仅在可信赖的路由器之间交换链路状态信息。</span></li><li><span>支持可变长度的子网划分和无分类编址CIDR。</span></li><li><span>每个链路状态带一个32位的序号，序号越大，状态越新。</span></li></ol><p><span>基本工作原理：每个路由器都能建立一个链路状态数据库，全网范围一致（链路状态数据库同步），每个路由器格局这一全网拓扑结构图，使用Dijkstra算法计算最短路径，本地构造路由表，链路状态变化时，本地重新计算；虽然计算出的是完整最优路径，路由表中只存储下一跳地址。OSPF能用于规模很大的网络，所以也将一个AS划分为若干更小的范围，称为区域，泛洪法交换链路信息的范围则局限于区域，区域内了解本区域完整网络拓扑，对其他区域透明，区域也有层次之分，上层为主干区域，负责通知下层并连接其他自治域。</span></p><p><span>OSPF有5种分组类型：</span></p><ol start='' ><li><span>问候分组（HELLO报文），发现和维持邻站的可达性。</span></li><li><span>数据库描述分组（DataBase Description），向邻站给出自己链路状态数据库（LSDB）的摘要信息，</span></li><li><span>链路状态请求分组（Link-State Request），请求对方发送某些链路状态项的详细信息。</span></li><li><span>链路状态更新分组（Link-State Update），洪泛法对全网更新链路状。</span></li><li><span>链路状态确认分组（Link-State Ack，LSack），对链路更新分组的确认。</span></li></ol><p><span>链路状态广播（Link-State Advertisement，LSA）是链接状态协议使用的一个分组，它包括有关邻居和通道成本的信息。 OSPF共有11种（常用7种）LSA。每隔10s，相邻路由器交换问候，路由器刚开始工作时，还需要使用DBD和相邻路由器交换LSDB的摘要信息，使用LSR请求缺少的链路详细信息，邻居用LSA回复所需信息。出现新情况时，LSU在全网泛洪，并用LSack相互确认。为了保持全网一致，每30min，路由器需要刷新一次链路状态。互联网规模较大时，OSPF比RIP好很多，也没有坏消息传得慢的问题。</span></p><h3><a name="5bgp路由协议" class="md-header-anchor"></a><span>5.BGP路由协议</span></h3><p><span>边界网关协议（Border Gateway Protocol，BGP）是不同自治系统路由器之间交换路由信息的协议，是一种EGP，常用于互联网网关之间，路由表包含已知路由器列表、路由器能到达的地址、每个路由器路径的代价（跳数），对于BGP而言环境较差，主要原因有：</span>1️⃣<span> 互联网规模太大，AS之间路由选择变得困难，</span>2️⃣<span> AS间的路由寻找最佳路由是不现实的，</span>3️⃣<span> AS之间的路由选择需要考虑有关策略（如层次化）。所以边界网关协议（BGP）力求找到一条可达且网络较好，而非最佳路由，采用路径向量路由选择协议，与距离向量（RIP）和链路状态（OSPF）有较大区别，是应用层协议，基于TCP。</span></p><p><span>具体工作原理：每个AS的 管理员至少选择1个路由器作为该AS的BGP发言人，发言人之间建立TCP连接，交换BGP报文建立BGP会话，使用BGP会话交换路由信息。所有BGP发言人呼唤网络可达性信息后，可以找出较好路由。每个发言人不仅运行BGP协议，还需要运行AS的内部网关协议。BGP一般可以分为主干网BGP、地区ISP的BGP、本地ISP的BGP等不同等级。并有如下特点：</span></p><ol start='' ><li><span>BGP交换路由信息的结点数量是AS的数量级，比网络数要少得多。</span></li><li><span>每个AS的BGP发言人（边界路由器）的数目很少，AS之间的路由选择不会过于复杂。</span></li><li><span>BGP支持CIDR，路由表包括目的网络前缀、下一跳路由器，以及达到网络所需经过的AS序列。</span></li><li><span>BGP刚运行时，BGP邻站交换整个BGP表，之后再变化时更新变化部分，对于节省网络带宽和节省路由器开销都有好处。</span></li></ol><p><span>BGP使用如下4种报文：</span></p><ol start='' ><li><span>Open打开报文，与相邻BGP建立关系。</span></li><li><span>Update更新报文，发送某一路由信息，列出需要撤销的多条路由。</span></li><li><span>Keepalive保活报文，确认打开报文，并周期性证实邻站关系。</span></li><li><span>Notification通知报文，用来发送检测到的差错。</span></li></ol><p>&nbsp;</p><p><span>上述三种协议对比：</span></p><figure><table><thead><tr><th><span>协议</span></th><th><span>RIP</span></th><th><span>OSPF</span></th><th><span>BGP</span></th></tr></thead><tbody><tr><td><span>类型</span></td><td><span>IGP</span></td><td><span>IGP</span></td><td><span>EGP</span></td></tr><tr><td><span>算法</span></td><td><span>距离-向量</span></td><td><span>链路状态</span></td><td><span>路径-向量</span></td></tr><tr><td><span>传递协议</span></td><td><span>UDP</span></td><td><span>IP</span></td><td><span>TCP</span></td></tr><tr><td><span>路径选择</span></td><td><span>跳数最少</span></td><td><span>代价最低</span></td><td><span>较好，非最佳</span></td></tr><tr><td><span>交换结点</span></td><td><span>邻站</span></td><td><span>所有</span></td><td><span>邻站</span></td></tr><tr><td><span>交换内容</span></td><td><span>路由表</span></td><td><span>邻站链路状态</span></td><td><span>首次整个路由表，之后只传有变化的部分</span></td></tr></tbody></table></figure><p>&nbsp;</p><h2><a name="六ip组播" class="md-header-anchor"></a><span>（六)IP组播</span></h2><h3><a name="1组播的概念" class="md-header-anchor"></a><span>1.组播的概念</span></h3><p><span>源计算机一次发送的单个分组可以抵达用同一个组地址表示的若干目标主机，并被正确接收。组播一定仅应用于UDP，源主机发送给组播地址后，由网络把分组的副本投递给该组中的每台主机。IP组播使用组播组的概念，每个组有一个特别分配的地址，在D类地址空间内分配。</span></p><p><span>主机使用因特网组管理协议（Internet Group Management Protocol，IGMP）的协议加入组播组，使用协议通知本地路由器关于接收发送给某个组播组的分组的愿望，通过扩展路由选择和转发功能，可以在路由器互联支持支持硬件组播的网络上实现组播。组播需要路由器支持，能运行组播协议的路由器称为组播路由器。</span></p><h3><a name="2ip组播地址" class="md-header-anchor"></a><span>2.IP组播地址</span></h3><p><span>组播使用D类地址，前四位1110，范围是224.0.0.0-239.255.255.255，每个D类地址标志一个组播组。组播使用D类IP地址作为目的地址，首部协议字段号为2，需要注意：</span></p><ol start='' ><li><span>组播数据报尽最大努力交付</span></li><li><span>组播地址只能用于目的地址，不能用于源地址</span></li><li><span>组播数据报不产生ICMP差错报文，PING后使用组播地址永远没有响应。</span></li><li><span>不是所有的D类都能作为组播地址</span></li></ol><p><span>组播分为两类，本局域网进行硬件组播，和互联网范围内组播。因特网组播的最后阶段，还是要通过硬件组播将分组交付给局域网内组播组的所有成员。</span></p><p><span>IANA拥有的以太网组播地址范围是01-00-5E-00-00-00到01-00-5E-7F-FF-FF，即只有后23位可以映射对应IP，所以IP地址前5位不参与映射，后23位映射到MAC地址。（如224.128.64.32（E0-80-40-20）和224.0.64.32转换成以太网硬件组播地址都是01-00-5E-00-40-20，），即组播IP地址和硬件地址的映射不唯一，因此收到组播数据报的主机，还要再IP层利用软件进行过滤，丢弃不需要的数据报。</span></p><p><span>IGMP不是在因特网范围内对所有组播组成员进行管理的协议，不知道IP组播组包含的成员数和分布，IGMP让连接到本地局域网上的组播路由器直到本局域网是否有主机参加或推出了某个组播组，是TCP/IP协议栈的一部分，工作分为两个阶段，第一阶段，某台主机加入新的组播组，主机向组播地址发送一个IGMP报文，本地组播路由器收到报文后，将组成员关系转发给其他组播路由器；第二阶段，本地组播路由器周期性探询本地局域网上的主机，只要某组有一台主机响应，就认为组活跃，几次探询后仍然没有响应，则不再将组成员关系转发。</span></p><p><span>组播路由选择就是查找以源主机位根节点的组播转发树，不同的多播组对应不同的多播转发树，同一组对于不同的根节点也有不同的多播转发组。路由器互联的支持硬件多点传送的网络上实现组播是，主要有三种路由算法，链路状态、基于距离向量和建立在任何路由协议上的，即协议无关的组播（PIM）</span></p><h2><a name="七移动ip" class="md-header-anchor"></a><span>（七)移动IP</span></h2><h3><a name="1移动ip的概念" class="md-header-anchor"></a><span>1.移动IP的概念</span></h3><p><span>支持移动性的因特网体系结构与协议共称为移动IP，是指移动节点以固定的网络IP地址实现跨越不同网段的漫游功能，保证基于网络IP的网络权限再漫游过程中不改变，使用移动IP则一个移动节点可以在不改变IP地址的情况下改变驻留位置。</span></p><p><span>基于IPv4的移动IP定义三种功能实体，移动结点、归属代理（本地代理）和外埠代理（外部代理），归属代理和外埠代理统称移动代理。</span></p><ol start='' ><li><span>移动结点，具有永久IP地址的移动结点。</span></li><li><span>本地代理，一个移动节点永久的居所称为“归属网络”，归属网络中代表移动节点执行移动管理功能的实体称为归属代理（本地代理），根据移动用户的转交地址，采用隧道技术转交移动节点的数据报。</span></li><li><span>外埠代理，帮助移动节点完成移动管理功能的实体。</span></li></ol><p><span>移动IP不同于移动自组网络，移动IP技术使漫游的主机可以多种方式连接到因特网，核心网络功能仍是基于固定互联网的各种路由选择协议，而移动自组网络是将移动性扩展到无线领域的自治系统，具有独特的路由选择协议，可以不连接因特网。</span></p><p><span>移动IP也不同于动态IP，动态IP是局域网中的计算机可以通过网络中的DHCP动态获得一个IP地址，移动IP和DHCP也经常应用在我们的实际工作环境中。</span></p><h3><a name="2移动ip的通信过程" class="md-header-anchor"></a><span>2.移动IP的通信过程</span></h3><p><span>对于移动IP，每个结点都有一个本地代理维护位置信息，移动结点再外部网络链路上是，转交地址用来标识移动节点所处位置，以便进行路由选择，移动节点的本地地址和转交地址的联合称为移动绑定或简称绑定。移动结点获得一个新的转交地址时，就通过绑定向本地代理注册，基本通信流程如下：</span></p><ol start='' ><li><span>在本地时时使用传统TCP/IP通信</span></li><li><span>漫游到外部网络时，仍然使用固定IP地址通信，但需要向本地代理注册当前转交地址（可以是外埠代理地址或动态配置的地址）</span></li><li><span>本地代理收到转交地址注册后，构建通向转交地址的隧道，将截获的分组通过隧道送到转交地址处</span></li><li><span>在转交地址处（可能是路由器也可能是本机）解除隧道封装，恢复原始IP分组，送到移动节点。</span></li><li><span>移动节点在外网时，使用外网路由器或外埠代理向通信端发送IP数据包</span></li><li><span>到另一个外网时，只需要向本地代理更新注册的转交地址</span></li><li><span>回到本地网时，注销转交地址。</span></li></ol><p><span>移动IP为移动主机提供了两个地址，即主地址和辅地址（转交地址），主地址始终不变。</span></p><p>&nbsp;</p><h2><a name="八网络层设备" class="md-header-anchor"></a><span>（八)网络层设备</span></h2><h3><a name="1路由器的组成和功能" class="md-header-anchor"></a><span>1.路由器的组成和功能</span></h3><p><span>路由器是一种具有多个IO端口的专用计算机，任务是连接异构网络并完成路由转发，在多个逻辑网络（多个广播域）互相连接时必须使用路由器。</span></p><p><span>源主机向目标主机发送数据时，路由器检查两者是否在同一个网络内，在则直接交付，无需通过路由器，否则路由器按照转发表指出的路由将数据转发给下一跳路由器，也称为间接交付，路由器可以连接不同的LAN，隔绝了广播域。</span></p><p><span>路由器由路由选择和分组转发两部分功能组成，是网络层设备，实现了网络模型的下三层，即物理层、数据链路层、网络层。网桥实现了物理层和链路层，可以连接两个物理层和数据链路层不同的网段；中继器虽然实现了物理层，但作为直通式设备没有存储转发功能，所以不能互联物理层不同的网段，但是可以互联媒介不同的网络。</span></p><p><span>路由选择部分也称为控制部分，核心构件是路由选择处理机，任务是根据路由选择协议构建路由表，定期更新维护路由表。</span></p><p><span>分组转发部分由三部分组成，交换结构、一组输入端口和一组输出端口。输入端口在物理层收到的比特流中提取出链路层帧，从帧中提出网络成数据报，输出端口则执行封装。交换结构是路由器关键部件，常用三种交换方法，通过存储器交换、通过总线交换、和通过互联网络交换，交换结构本身就是一个网络。</span></p><p><span>路由器主要完成两个功能，路由计算和分组转发，路由器和网桥的区别是网桥和高层协议无关，而路由器是面向协议的，根据网络地址进行操作，并能进行路径选择、分片、帧格式转换、对数据包生存时间和流量进行控制等，路由器提供对于OSI、TCP/IP、IPX等多种协议支持。</span></p><h3><a name="2路由表与路由转发" class="md-header-anchor"></a><span>2.路由表与路由转发</span></h3><p><span>路由表由路由选择算法得出，主要用途是路由选择，路由表项一般包括目的IP地址、子网掩码、下一跳IP、接口。</span></p><p><span>转发表由路由表得出的，表项和路由表直接对应，但格式不同，结构适应于查找过程，转发表中含有目的地址和分组下一跳，为了减少转发表重复项目，还可以使用默认路由来代替具有相同下一跳的项目，并将优先级设置得比其他项低，路由表总是用软件实现，但转发表可以用软件也可以用特殊的硬件实现。转发是路由器根据转发表把收到的IP数据报从合适的端口转发出去，只涉及一个路由器；路由选择则涉及很多路由器，路由表是多个路由器协同工作的结果。</span></p><p><span>在讨论路由选择原理时，不区分路由表和转发表，但路由表不等于转发表，分组转发靠直接查找转发表而不是路由表。</span></p><h1><a name="五传输层" class="md-header-anchor"></a><span>五、传输层</span></h1><h2><a name="一传输层提供的服务" class="md-header-anchor"></a><span>（一)传输层提供的服务</span></h2><h3><a name="1传输层的功能" class="md-header-anchor"></a><span>1.传输层的功能</span></h3><p><span>传输层向上应用层提供服务，使用网络层的服务，属于面向通信的最高层，也是面向用户的最底层，为进程提供了逻辑通信，使用网络层提供的主机通信。传输层只存在于通信子网以外的主机中，而路由器等只是用下三层功能。传输层具体功能如下：</span></p><ol start='' ><li><span>为进程提供逻辑通信，应用进程通信也叫端到端的逻辑通信，好像沿水平方向传送数据。</span></li><li><span>复用和分用，复用指不同进程可以使用同一个传输层协议进行数据传输；分用则是传输层剥去报文首部后，能将数据正确交付到应用进程。（网络层的复用指不同协议数据可以封装成IP数据报发送，分用则是剥去首部后交付给不同的协议）</span></li><li><span>传输层还要对首部和数据部分进行差错检测，而网络层只检查IP数据报首部。</span></li><li><span>提供两种不同协议，即面向连接的TCP和无连接的UDP，TCP在逻辑上等效一条全双工的可靠信道，UDP仍是不可靠信道。</span></li></ol><h3><a name="2传输层寻址与端口" class="md-header-anchor"></a><span>2.传输层寻址与端口</span></h3><p><span>端口是传输层的SAP（Service Access Point，服务访问点），而IP地址是网络层的SAP，MAC地址是数据链路层的SAP，不同于后两者标识的主机，端口标识主机中的进程。但传输层使用的是在协议栈层间抽象的协议端口，是软件端口而不是硬件端口。</span></p><p><span>应用程序通过端口号进行标识，长度为16bit，（即能表示65536个不同的端口号），端口号只具有本地意义。端口号主要分为两类：</span></p><ol start='' ><li><p><span>服务端使用的端口号，最重要的是熟知端口号，0—1023，由IANA（互联网地址指派机构）分给了一些重要的应用程序，常用如下：</span></p><figure><table><thead><tr><th style='text-align:right;' ><span>应用</span></th><th style='text-align:center;' ><span>FTP</span></th><th style='text-align:center;' ><span>FTP</span></th><th style='text-align:center;' ><span>SSH</span></th><th style='text-align:center;' ><span>TELNET</span></th><th style='text-align:center;' ><span>SMTP</span></th><th style='text-align:center;' ><span>DNS</span></th><th style='text-align:center;' ><span>TFTP</span></th><th style='text-align:center;' ><span>HTTP</span></th><th style='text-align:center;' ><span>POP3</span></th><th style='text-align:center;' ><span>SNMP</span></th><th style='text-align:center;' ><span>HTTPS</span></th><th style='text-align:center;' ><span>RIP</span></th></tr></thead><tbody><tr><td style='text-align:right;' ><span>协议</span></td><td style='text-align:center;' ><span>TCP</span></td><td style='text-align:center;' ><span>TCP</span></td><td style='text-align:center;' ><span>TCP</span></td><td style='text-align:center;' ><span>TCP</span></td><td style='text-align:center;' ><span>TCP</span></td><td style='text-align:center;' ><span>UDP</span></td><td style='text-align:center;' ><span>UDP</span></td><td style='text-align:center;' ><span>TCP</span></td><td style='text-align:center;' ><span>TCP</span></td><td style='text-align:center;' ><span>UDP</span></td><td style='text-align:center;' ><span>TCP</span></td><td style='text-align:center;' ><span>UDP</span></td></tr><tr><td style='text-align:right;' ><span>端口号</span></td><td style='text-align:center;' ><span>20</span></td><td style='text-align:center;' ><span>21</span></td><td style='text-align:center;' ><span>22</span></td><td style='text-align:center;' ><span>23</span></td><td style='text-align:center;' ><span>25</span></td><td style='text-align:center;' ><span>53</span></td><td style='text-align:center;' ><span>69</span></td><td style='text-align:center;' ><span>80</span></td><td style='text-align:center;' ><span>110</span></td><td style='text-align:center;' ><span>161</span></td><td style='text-align:center;' ><span>443</span></td><td style='text-align:center;' ><span>520</span></td></tr></tbody></table></figure><p><span>另一类为登记端口号，1024-49151，供没有熟知端口号的应用程序使用，必须在IANA等级，防止重复。（ICMP网际控制报文协议，没有端口号，协议号是1，PING使用这一协议）</span></p></li><li><p><span>客户端使用的端口号：数值为49152-65535，仅在客户端启动时动态选择，也称短暂端口号、临时端口号，通信结束后端口号就可以回收。</span></p></li></ol><p><span>套接字（Socket）用来标识端点，即套接字=主机IP，端口，唯一标识主机和其上的一个进程，网络中的报文段包括目的端口号和源端口号。</span></p><h3><a name="3无连接服务与面向连接服务" class="md-header-anchor"></a><span>3.无连接服务与面向连接服务</span></h3><p><span>面向连接服务在通信之前需要先建立连接，通信结束后释放，无连接则是直接将信息发送到网络，网络尽最大努力交付。</span></p><p><span>TCP增大了协议数据单元的头部，还要占用更多的处理机资源，适用于可靠性更重要的场合，如文件传输协议FTP、超文本传输协议HTTP、远程登陆TELNET等。</span></p><p><span>UDP无连接非可靠，优点是简单、执行速度快、实时性好，主要包括小文件传送（TFTP），DNS、SNMP和实时传输协议RTP，以及直播、视频等应用。</span></p><p><span>IP数据报经过路由存储转发，UDP数据报在传输层的逻辑信道中传输，对路由不可见；虚电路和TCP的关系类似，此外，TCP可以在无连接服务的网络层上使用，但虚电路不能提供无连接服务。</span></p><h2><a name="二udp协议" class="md-header-anchor"></a><span>（二)UDP协议</span></h2><h3><a name="1udp数据报" class="md-header-anchor"></a><span>1.UDP数据报</span></h3><p><span>RFC768定义了UDP只做传输协议能做的最少工作，仅在IP数据报服务的基础上增加了复用分用以及差错检测，程序员几乎直接和IP打交道。UDP主要优点如下：</span></p><ol start='' ><li><span>无需建立连接，无连接时延</span></li><li><span>无连接状态，不需要维护连接状态所以能支持更多的活动客户机。</span></li><li><span>分组首部开销小，TCP需要20B，然而UDP仅需</span><em><span>B</span></em></li><li><span>应用层能更好地控制发送数据和发送时间，没有拥塞控制所以网络拥塞不会影响主机的发送效率，对于实时应用而言，需要以稳定的速度发送，可以忍受丢包，但不能有太大的时延，UDP恰好满足。</span></li></ol><p><span>UDP常用于一次传输较少数据的网络应用，以及多媒体应用，尽最大努力交付，但应用实体可以根据应用需要灵活设计自己的可靠性机制，UDP面向报文，报文时UDP数据报处理的最小单位，不可分割。</span></p><p><span>首部格式： </span></p><figure><table><thead><tr><th style='text-align:center;' ><span>16位源端口号</span></th><th style='text-align:center;' ><span>16位目的端口号</span></th></tr></thead><tbody><tr><td style='text-align:center;' ><span>16位UDP长度</span></td><td style='text-align:center;' ><span>16位UDP校验和</span></td></tr></tbody></table></figure><ol start='' ><li><span>源端口：需要回信时选用，可以不用，不用则设置全0。</span></li><li><span>目的端口：必须使用，在终点交付时需要。终点主机UDP协议发现目的端口号不正确（不存在该对应进程）则丢弃报文，并由ICMP回复端口不可达差错报文给发送方。</span></li><li><span>长度，最小8B（即仅有首部），UDP允许不发送数据，最大值64KB。（事实上属于冗余信息，主要为了凑足首部8B长度）</span></li><li><span>校验和（字段可选，不需要计算时，字段全0）</span></li></ol><h3><a name="2udp校验" class="md-header-anchor"></a><span>2.UDP校验</span></h3><p><span>校验之前需要添加12B的伪首部，伪首部包括了4B源IP地址、4B目的IP地址，1B全0，1B协议17标识UDP，和2B的UDP长度。伪首部只做校验用，不向下或向上传送，校验方法和IP数据报首部校验方法相似，使用二进制反码运算求和再取反。校验时将UDP数据报视作许多16位的字连接起来的，如果数据部分长度不是偶数字节，则在末尾补一个全0字节进行校验（这一字节不进行发送），校验和字段先用全0填充，按反码求出这些16位字的和，并将喝的魏晋至反码写入校验字段，接收方在校验时，也要加上伪首部并补零，按照2进制反码计算这些16位字的和，如无差错，则结果应该是全1。</span></p><p><span>UDP在数据出错时，可以丢弃也可以交付上层并附上错误报告，通过伪首部可以检查IP数据报的源和目的地址，这种简单的差错检验方式检错能力不强，但好处是简单、快速。</span></p><h2><a name="三tcp协议" class="md-header-anchor"></a><span>（三)TCP协议</span></h2><p><span>TCP是在不可靠的IP层之上实现的可靠数据传输协议，主要解决传输的可靠、有序、无丢失和不重复，是一个非常复杂的协议，主要特点如下：</span></p><ol start='' ><li><span>面向连接</span></li><li><span>只能有两个端点，即每条TCP连接都是点对点一对一的。</span></li><li><span>提供可靠的交付服务，保证无差错不丢失无重复且有序。</span></li><li><span>全双工通信，两端都设有发送和接收缓存，发送缓存用来存放准备发送的数据和以发送但未确认的数据，接受缓存用来存放按需到达但未被读取的数据和不按序到达的数据。</span></li><li><span>TCP面向字节流，应用程序和TCP一次一数据块交互，但是TCP把应用程的交付的数据是做无结构的字节流。</span></li></ol><h3><a name="1tcp段tcp-segment）" class="md-header-anchor"></a><span>1.TCP段（TCP segment）</span></h3><p><span>TCP传送的数据单元称为报文段，一个TCP报文段分为首部和TCP数据两部分。整个TCP报文作为IP数据报的数据部分封装在IP数据报中，TCP报文段的首部最短未20B，后面有4N字节可以根据需要而增加，但增加的长度必须是4B的整数倍，TCP报文可以用来运载数据，也能建立和释放连接以及应答。</span></p><p><img src="https://img-blog.csdnimg.cn/2019031717512915.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1d1MDAwOTk5,size_16,color_FFFFFF,t_70" referrerpolicy="no-referrer" alt="TCP首部"></p><ol start='' ><li><span>源端口和目的端口，各16位，共4B，端口是运输层的SAP，</span></li><li><span>序号字段：TCP是面向字节流的，即传送时时逐个字节传送的，每个字节都有一个序号，序号字段是本次发送数据的第一个字节的序号，第一个包的首字节是一个随机数，例如62，本次发送100B，则本次发送序号为62，下次发送的序号为162.</span></li><li><span>确认号字段：是期望收到对方下一个报文段数据的第一个字节序号，收到确认号表明确认号之前的数据都正确接收</span></li><li><span>数据偏移（首部长度）：占4位，标识首部长度，单位是4B，值为15时有最大长度60B。</span></li><li><span>保留字段：6位，今后使用，目前置0。</span></li><li><span>紧急位URG：=1表明高优先级，紧急指针字段有效，需要跟紧急指针配套。</span></li><li><span>确认位ACK：ACK=1时，确认号字段有效</span></li><li><span>推送位PSH：尽快交付给接受应用程序，而不是等缓存填满后再向上交付。</span></li><li><span>复位位RST：RST=1表明出现严重错误，必须释放连接并重新建立</span></li><li><span>同步位SYN：连接请求或连接接收报文，ACK=0&amp;SYN=1表明是连接请求，ACK=1则是连接响应报文。</span></li><li><span>终止位FIN：释放连接</span></li><li><span>窗口字段：占2B，指允许对方发送的数据量，单位是字节</span></li><li><span>校验和：占2B，计算校验和时，需要加上12B的伪首部（4B源IP，4B目的IP，1B全0，1B协议号6，2B长度），校验范围包括首部和数据。</span></li><li><span>紧急指针字段：占2B，指出本报文段中有多少紧急数据，单位是字节，（紧急数据在本报文段数据最前面）。</span></li><li><span>选项字段：长度可变，最初只有最大报文长度（Maximum Segment Size，MSS），即TCP中的数据字段最大长度，默认为1460/536.</span></li><li><span>填充字段：保证首部长度是4B的整数倍。</span></li></ol><p><span>关于长度：TCP最大负载65535-40=65495B（即IP数据报最大长度），对于MTU=1500B的以太网，TCP的MSS=1460B，对以太网则是536B，一般都需要装入数据，故没有最小长度限制。MSS如果过小，经过传输层和网络层两次封装后，网络利用率就很低，但如果过大，则在网络层还需要分片传输，差错重传的开销也会过大，所以一般MSS设置为MTU减去上两层首部大小。</span></p><p>&nbsp;</p><h3><a name="2tcp连接管理" class="md-header-anchor"></a><span>2.TCP连接管理</span></h3><p><span>连接建立的三个问题：</span></p><ol start='' ><li><span>确定对方的存在</span></li><li><span>协商一些参数</span></li><li><span>运输实体资源（缓存、连接表项）进行分配。</span></li></ol><p><span>连接的端口为套接字（Socket），即端口拼接到IP地址后，主动发起连接建立的称为客户机（Client），被动等待连接建立的称为服务器（Server）。</span></p><p><span>三次握手建立连接：</span></p><ol start='' ><li><span>SYN，seq=x。第一步，客户机发出连接请求报文段，随机选择其实序号x，不携带数据但消耗一个序号</span></li><li><span>SYN，ACK，seq=y，ack=x+1。第二步，服务器向客户发回确认，确认号为x+1，随机产生序号y（不携带但消耗），服务器端分配资源</span></li><li><span>ACK，seq=x+1，ack=y+1。第三步，客户端向服务器确认，客户端分配缓存资源 ，确认号y+1，可以携带数据，不携带则不消耗序号。</span></li></ol><p><span>提供全双工通信、因为服务器端资源分配比客户端早，服务器容易受到洪泛攻击。</span></p><p><span>四次握手释放连接：</span></p><ol start='' ><li><span>FIN，seq=u。第一步，客户机发送连接释放报文，停止发送数据，seq=u，即前面传送数据的最后一字节序号加一（不携带但消耗）</span></li><li><span>ACK，seq=v，ack=u+1。第二步，服务器发送连接释放确认，但此时服务器端还可以继续发送数据，客户端方向连接已经释放，TCP半关闭</span></li><li><span>FIN，ACK，seq=w，ack=u+1。第三步，服务器没有数据需要发送，通知TCP释放连接，发送连接释放报文段（不携带但消耗）</span></li><li><span>ACK，seq=u+1，ack=w+1。第四步，客户端响应连接释放报文段，返回确认号w+1，序号u+1（不携带但消耗），再经过计时等待2MSL后，连接彻底释放。</span></li></ol><p><span>总结：三次握手建立，因为两次握手可能因为网络滞留使服务器端为失效请求建立连接分配资源而导致浪费；四次握手释放并等待2MSL为了保证报文段不丢失而能使服务器正常关闭，也防止网络滞留使服务器为失效的连接继续保持资源导致浪费，所以服务器端完全结束TCP连接时间要比客户机早一点。</span></p><h3><a name="3tcp可靠传输" class="md-header-anchor"></a><span>3.TCP可靠传输</span></h3><p><span>主要使用校验、序号、确认和重传机制保证数据一致从而提供可靠连接。校验机制与UDP一致。</span></p><ol start='' ><li><p><span>序号：通过首部的序号字段保证数据有序的交付给应用层，序号建立早字节流的基础上 ，而不是报文段。TCP为传送数据流的每一个字节都编上序号，首部序号字段的值是本报文段发送的第一个字节的序号。TCP每次建立连接时选择的序号一定要和前面的连接用过的序号不同，因此不同的TCP连接不能使用相同的初始序号，应用中采用随机的初始化序列号（Initial Sequence Number，ISN），初始化序号的范围在0-2</span><sup><span>32</span></sup><span>-1.</span></p></li><li><p><span>确认：确认号字段收到的是期望收到的对方下一个报文数据的第一个字节序号。发送方缓存回继续存储发送单位确认的报文段。TCP使用累计确认，即只确认到第一个丢失字节为止的字节。TCP的差错控制机制，可以视作GBN和SR协议的混合，只需重传丢失的报文段，但使用类似GBN的累计确认。</span></p></li><li><p><span>重传：两种时间导致重传，超时和冗余ACK，</span></p><ol start='' ><li><span>超时：每发送一个报文段就设置一次计时器，计时器到期后还未确认就重传，超时重传计时器的时间采用自适应算法，首先记录报文段发出时间和确认时间之间的差（Round-Trip Time，RTT），并计算加权平均RTT</span><sub><span>s</span></sub><span>，超时重传时间（Retransmission Time-Out，RTO）应略大于RTT</span><sub><span>s</span></sub><span>，但也不能太大防止重传时间过慢。</span></li><li><span>冗余ACK（冗余确认）：超时重传的周期太长，接收方通过再次确认某个报文段的ACK，即接收方每当收到比期望序号大的失序报文段是，就发送冗余ACK指明下一个期待的字节序号，连发3次ACK，这种方式也叫快速重传，也用在拥塞控制中。如确认1号报文后，收到了345号报文，接收方就会连发三个对1号报文的冗余ACK，指明了期待收到的下一个报文是2号，即2号报文需要重传。</span></li></ol></li></ol><h3><a name="4tcp流量控制" class="md-header-anchor"></a><span>4.TCP流量控制</span></h3><p><span>TCP的流量控制是为了消除发送发使接收方缓存区溢出的可能，即速度匹配服务，将发送方的发送速率和接收方的接收速率相匹配。TCP也是用滑动窗口协议进行流量控制，不同于数据链路层的滑动窗口，窗口大小可以动态改变。</span></p><p><span>接收方根据接收缓存大小，动态调整接收窗口的大小，即接收窗口（rwnd），即调整报文中的窗口字段来限制速度，同时发送方也会根据网络拥塞程度确定一个窗口值，即拥塞窗口（cwnd），这一窗口和网络带宽、时延相关。A的发送窗口会选择接收窗口和拥塞窗口中的最小值。</span></p><p><span>传输层定义端到端用户的流量控制，数据链路层定义两个相邻结点在链路上的流量控制，传输层的窗口大小可以动态变化。</span></p><h3><a name="5tcp拥塞控制" class="md-header-anchor"></a><span>5.TCP拥塞控制</span></h3><p><span>防止过多数据注入网络导致链路或路由器过载，端点不了解拥塞发生的细节，而只表现为通信时延增加。拥塞控制和流量控制都控制发送方的发送速率，但拥塞控制是让网络能够承受现有负荷，是一个全局性的过程，相反，流量控制是点对点通信量的控制。</span></p><p><span>TCP协议要求发送方维护两个窗口：</span></p><ol start='' ><li><span>接收窗口rwnd：接收方根据缓存大小许诺的最新窗口值，接收方会放在窗口字段通知发送方。</span></li><li><span>拥塞窗口cwnd：发送方根据自己估算的网络拥塞程度设置，反映网络当前容量。</span></li></ol><p><span>发送窗口的上限值取两者中较小的一个=min[rwnd，cwnd]。一般发送窗口往往等同于拥塞窗口。</span></p><ol start='' ><li><p><span>慢开始和拥塞避免：</span></p><ol start='' ><li><span>刚建立连接时cwnd=1，即一个最大报文段长度MSS，每收到一个报文段的确认就将cwnd+1，增大一个MSS，即每经过一个RTT（也称每经过一个传输轮次）后，cwnd拥塞窗口就会加倍，cwnd的大小呈指数增长，直到达到规定的慢开始门限ssthresh（阈值），而后改用拥塞避免算法。</span></li><li><span>拥塞避免算法的cwnd每经过一个往返时延RTT，就增加一个MSS而不是加倍，按照线性规律增加（加法增大），而出现一次超时（网络拥塞）后，就令慢开始门限等于当前cwnd的一般（乘法减小），在cwnd==ssthresh时，一般使用拥塞避免（也可以慢开始）</span></li><li><span>拥塞处理：只要拥塞，就将ssthresh设置为cwnd的一一半（但不能小于2），然后把cwnd重新设置为1，执行慢开始。从而迅速减小主机发送的分组数，使拥塞路由器有足够时间处理队列中的挤压分组。拥塞避免不可能完全避免拥塞，但能在拥塞避免阶段把拥塞窗口控制为线性增长，使网络不容易出现拥塞（也即防止网络过早拥塞）。</span></li></ol></li><li><p><span>快重传和快恢复：对慢开始和拥塞避免的改进</span></p><ol start='' ><li><span>快重传使用冗余ACK技术检测丢包，丢包也意味着网络拥塞，快重传没有取消重传计时器，而是尽可能早的重传丢失报文段。即发送方收到三个重复ACK时，直接重传下一个报文段，而不必等待超时。</span></li><li><span>快恢复同样执行乘法减小，即将慢开始门限设置为cwnd的一般，但是同时将cwnd值设置成慢开始门限改变后的数值，直接继续执行拥塞避免算法，即加法增大，跳过了从cwnd从1开始的指数慢开始过程，所以称为快恢复。</span></li></ol></li></ol><p>&nbsp;</p><p><img src="https://img-blog.csdn.net/20160529140813320?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" referrerpolicy="no-referrer" alt="分层数据包"></p><p>&nbsp;</p><h1><a name="六应用层" class="md-header-anchor"></a><span>六、应用层</span></h1><h2><a name="一网络应用模型" class="md-header-anchor"></a><span>（一)网络应用模型</span></h2><h3><a name="1客户服务器模型" class="md-header-anchor"></a><span>1.客户/服务器模型</span></h3><p><span>有一个总是打开的主机称为服务器，服务于其他来自客户机的主机请求。服务器处于请求状态，客户机发出请求服务，等待接受结果，服务器收到请求后分析并进行必要处理，并将结果发给客户机。客户机必须直到服务机程序的地址，服务机上运行专门提供服务的程序，服务机被动接受请求，所以不需要事先知道客户程序地址。客户是服务请求方，服务器是服务提供方。主要特点还有：</span></p><ol start='' ><li><span>地位不平等，管理工作由少数服务器进行，集中方便</span></li><li><span>客户机之间互相不直接通信</span></li><li><span>可扩展性不佳，收服务器硬件和网络带宽的限制，服务器支持的客户机数量有限。</span></li></ol><h3><a name="2p2p模型" class="md-header-anchor"></a><span>2.P2P模型</span></h3><p><span>在C/S模型中，服务器成为系统瓶颈。P2P模型中，每个节点都具有下载、上传功能，没有固定的客户和服务器划分，任意一对计算机称为对等方（Peer）直接互相通信，主要优点有：</span></p><ol start='' ><li><span>减轻服务器计算压力，消除了对于服务器的完全依赖，可以将任务分配到各个节点提高了系统效率和资源利用率</span></li><li><span>多个客户机之间可以直接共享文档</span></li><li><span>可扩展性好</span></li><li><span>网络健壮性强</span></li></ol><p><span>缺点主要由，需要给其他结点提供服务，导致内存占用大、影响主机速度，还会对硬盘造成损伤。目前各大ISP都对P2P应用持反对态度。</span></p><h2><a name="二dns系统" class="md-header-anchor"></a><span>（二)DNS系统</span></h2><p><span>域名系统（Domain Name System，DNS）是因特网使用的命名系统，用来把便于记忆的主机名转换成IP地址，采用C/S模型，基于UDP，使用53号端口。</span></p><h3><a name="1层次域名空间" class="md-header-anchor"></a><span>1.层次域名空间</span></h3><p><span>任何一个连接到主机或路由器都有一个唯一的层次结构名称，即域名，域（Domain）是名字空间中一个可以被管理的划分，域可以分为子域，每个域名由“.”隔开，.com是顶级域名，taobao是二级域名，www是三级域名，域名有以下几点注意：</span></p><ol start='' ><li><span>英文不区分大小写</span></li><li><span>除了连字符（-）以外不能有其他符号</span></li><li><span>每个标号不超过63个字符，完整域名不超过255个字符</span></li><li><span>级别最低的域名在最左，最高在最右。</span></li></ol><p><span>顶级域名（Top Level Domain，TLD）分为三类：</span></p><ol start='' ><li><span>国家顶级域名（nTLD）：.cn</span><span>	</span><span>.us</span><span>	</span><span>.uk</span></li><li><span>通用顶级域名（gTLD）：.com .net .org .gov</span></li><li><span>基础结构域名：只有一个arpa，用于反向域名解析，也称为反向域名</span></li></ol><p><span>每个域由不同的组织管理，管理CN域的中国将EDU.CN授权给中国教育和科研计算机网（CERNET）管理</span></p><h3><a name="2域名服务器" class="md-header-anchor"></a><span>2.域名服务器</span></h3><p><span>域名系统被设计为联机分布式的数据库系统，一个服务器管辖的范围为“区”，每个区设置相应的权限域名服务器，DNS采用层次方式组织，有以下4类：</span></p><ol start='' ><li><span>根域名服务器：最高层次，直到所有顶级域名服务器的IP地址，最重要的服务器，一共有13个，每个服务器实际上是冗余服务器的集群，用来管辖顶级域。</span></li><li><span>顶级域名服务器：负责管理所有二级域名，收到DNS查询请求时，就给出相应回答，可能是最后结果，也可能是下一步查询的域名服务器IP地址</span></li><li><span>授权域名服务器（权限域名服务器）：每台主机都在授权域名服务器等级，能将管辖的主机名转换成IP地址</span></li><li><span>本地域名服务器：每个ISP或大学、组织都可以拥有一个本地域名服务器，本地连接需要配置本地DNS服务器</span></li></ol><h3><a name="3域名解析过程" class="md-header-anchor"></a><span>3.域名解析过程</span></h3><p><span>把域名映射成IP地址或把IP地址映射成域名的过程</span></p><ol start='' ><li><span>主机向本地DNS服务器递归查询</span></li><li><span>本地DNS向根域名服务器采用迭代查询。</span></li></ol><p><span>域名解析过程如下：</span></p><ol start='' ><li><span>客户机向本地DNS发出请求</span></li><li><span>查询本地缓存，没有则以DNS客户身份向根DNS服务器发起解析请求</span></li><li><span>根域名服务器收到请求后查询本地缓存，将.com域对应的dns.com的IP地址返回给本地服务器</span></li><li><span>本地DNS向dns.com发起解析请求报文</span></li><li><span>dns.com判断域名属于abc.com域，将dns.abc.com的IP地址返回给本地DNS</span></li><li><span>本地DNS向dns.abc.com发起解析请求</span></li><li><span>dns.abc.com将结果返回给本地DNS</span></li><li><span>本地DNS保存到缓存，并将结果返回给客户机</span></li></ol><p><span>DNS中广泛使用高速缓存，但因为主机和IP映射不永久，一段时间后将丢弃其中内容。</span></p><h2><a name="三ftp" class="md-header-anchor"></a><span>（三)FTP</span></h2><h3><a name="1ftp协议的工作原理" class="md-header-anchor"></a><span>1.FTP协议的工作原理</span></h3><p><span>文件传输协议（File Transfer Protocol，FTP）是因特网最广泛应用的文件传输协议，提供交互式的访问，允许用户指明文件类型与格式，并允许文件有存取权限，屏蔽细节，适合在异构网络间传输文件。</span></p><p><span>提供功能有：</span></p><ol start='' ><li><span>提供不同种类主机之间的文件传输能力</span></li><li><span>用户权限管理方式管理提供用户对于FTP服务器上的文件管理力</span></li><li><span>以匿名FTP的方式提供公用文件共享的能力</span></li></ol><p><span>FTP采用C/S模型，使用TCP可靠传输服务，FTP服务器有两类进程，一个主进程，负责接收新请求；若干从进程，负责处理单个请求，工作步骤如下：</span></p><ol start='' ><li><span>打开熟知端口号21（控制端口），使用户可以连接</span></li><li><span>等待用户进程发送连接请求</span></li><li><span>启动从属进程处理用户进程请求，主从进程并发，从进程处理完请求后终止</span></li><li><span>回到等待状态</span></li></ol><p><span>FTP服务器必须在整个会话器件保持用户状态信息，服务器需要追踪用户在远程目录树上的当前位置，进行账户控制</span></p><h3><a name="2控制连接与数据连接" class="md-header-anchor"></a><span>2.控制连接与数据连接</span></h3><p><span>FTP使用两个并行的TCP连接，控制连接（端口号21），数据连接（端口号20）</span></p><p><span>服务器监听21端口，等待用户连接，建立控制连接，控制信息使用7位ASCII格式传送，控制连接不用来传送文件，在会话期间保持打开状态</span></p><p><span>控制进程创建从进程，即“数据传送进程”以及数据连接，FTP使用了分离的控制连接，也称控制信息是带外传送的（Out-of-band），网络文件系统NFS允许进程打开一个远程文件，并在远程文件特定位置读写数据，可以使用户复制一个大文件中的一个很小片段。</span></p><h2><a name="四电子邮件" class="md-header-anchor"></a><span>（四)电子邮件</span></h2><h3><a name="1电子邮件系统的组成结构" class="md-header-anchor"></a><span>1.电子邮件系统的组成结构</span></h3><p><span>电子邮件是一种异步通信方式，具有三个主要的组成构件，用户代理（User Agent）、邮件服务器和邮件协议。</span></p><p><span>用户代理（UA）是用户和电子邮件系统之间的接口，让用户有好的收发邮件。</span></p><p><span>邮件服务器是核心部分，主要负责收发邮件、报告邮件传送状态</span></p><p><span>邮件协议，主要有发送协议SMTP，读取协议POP2（或IMAP等）SMTP采用Push推的通信方式，POP3采用Pull拉的通信方式。</span></p><h3><a name="2电子邮件格式与mime" class="md-header-anchor"></a><span>2.电子邮件格式与MIME</span></h3><p><span>电子邮件主要分为信封和内容两个部分，内容分为首部和主体，RFC822规定了首部格式，包含一些首部行，由关键字后根冒号何止，最重要的是To：和Subject：。To必选，还有一个必选是From：，一般有邮件系统自动填入。</span></p><p><span>MIME：多用途网络邮件扩充（Multipurpose Internet Mail Extensions，MIME），没有改动SMTP，主要定义了非ASCII编码的规则，主要包括5个新的邮件首部字段，MIME版本、内容描述、内容表示、传送编码、内容类型等；定义了邮件格式对于多媒体电子邮件的表示进行了标准化；定义了传送编码，可以对任何内容格式进行转换。</span></p><h3><a name="3smtp协议与pop3协议" class="md-header-anchor"></a><span>3.SMTP协议与POP3协议</span></h3><p><span>SMTP（Simple Mail Transfer Protocol，SMTP），提供一种可靠且有效的电子邮件传输协议，使用C/S方式，TCP连接，25号端口。主要有三个过程</span></p><ol start='' ><li><span>连接建立：发送人邮件到发送服务器缓存后，发送方的SMTP客户定时扫描，扫描到邮件后使用25端口和接收方SMTP服务器建立连接，接收方服务器发送220Service Ready（服务就绪），然后客户向服务器发送HELO命令，附上发送方主机名，SMTP不使用中间邮件服务器，在收发双方之间直接建立。故障不能建立时，等待一段时间后再次尝试。</span></li><li><span>邮件传送：从MAIL命令开始，如MAIL FROM：</span><a href='mailto:hoopdog@hust.edu.cn' target='_blank' class='url'>hoopdog@hust.edu.cn</a><span>，若SMTP服务器做好接收准备，发送250 OK。SMTP客户发送多个RCPT命令（recipients），格式RCPT TO：&lt;收件人地址&gt;，每一个RCPT，都有相应信息信息如250 OK，550 No such user here。RCPT作用是先确定已经做好接收准备，避免浪费通信资源。获得OK后，使用DATA命令，表示开始传输，SMTP回复354 Start mail input；end with </span><CRLF><span>.</span><CRLF><span>。CRLF表示回车换行，邮件内容结束后，用两个回车换行中间一个点表示结束。</span></li><li><span>连接释放：发送完毕后，客户发送QUIT命令，SMTP服务器返回221（服务关闭），通信结束。</span></li></ol><p><span>POP3：邮局协议（Post Office Protocol，POP）是一个简单但功能有限的邮件读取协议，使用TCP协议，端口号110，有两种工作模式，下载并保留和下载并删除。</span></p><p><span>IMAP因特网报文存取协议，为用户提供了创建文件夹、在不同文件夹之间移动邮件、在远程文件夹中查询邮件的命令。并允许用户代理只获取报文的某些部分，适用于低带宽的情况，尤其是包含很多音视频的大邮件。</span></p><p><span>目前出现了很多基于WWW的电子邮件，如Gmail、Hotmail，用户浏览器和邮件服务器之间使用HTTP，邮件服务器之间才使用SMTP。</span></p><h2><a name="五www" class="md-header-anchor"></a><span>（五)WWW</span></h2><h3><a name="1www的概念与组成结构" class="md-header-anchor"></a><span>1.WWW的概念与组成结构</span></h3><p><span>World Wide Web，万维网是一个资料空间，在这个空间中，一个有用的事物被视作“资源”，使用全域“统一资源定位符”（Uniform Resource Locator，URL），这些资源通过超文本传输协议（Hyper Text Transport Protocol，HTTP）传送给使用者，使用者单击链接获取资源。超文本标记语言（HyperText Markup Language，HTML）让万维网设计者能设计资源的显示形式。</span></p><p><span>万维网的三个内核就是三个标准，URL负责标识文档，每个文档都有唯一的URL，HTTP使用TCP可靠传输，让万维网客户程序和服务器可靠交互，HTML是一种文档结构的标记语言，对页面信息进行描述。URL的一般形式&lt;协议&gt;://&lt;主机&gt;:&lt;端口&gt;/&lt;路径&gt;。不区分大小写，端口路径有时可以省略。浏览器指定URL和Web服务器建立连接，发送浏览请求；Web服务器把URL转换成文件路径，并返回信息给Web浏览器；通信完成，关闭连接。</span></p><h3><a name="2http协议" class="md-header-anchor"></a><span>2.HTTP协议</span></h3><p><span>HTTP是面向事物的（Transaction-oriented）应用层协议，规定了浏览器和服务器之间的请求和响应的格式和规则，是万维网上能可靠交换文件的重要基础。操作过程如下：</span></p><p><span>每个万维网站点都有服务器，不断监听TCP的80端口，监听到连接请求后边建立连接，连接后服务器发送请求，服务器收到请求后，处理构建Web所需信息，通过HTTP响应返回浏览器，浏览器对HTML进行解释，将Web页面显示给用户，最后TCP连接释放。可见HTTP有两类报文，请求报文和响应报文，用户单机鼠标后发生事件如下：</span></p><ol start='' ><li><span>浏览器分析链接指向页面（</span><a href='http://www.fyj.ink/os/index.htm' target='_blank' class='url'>http://www.fyj.ink/os/index.htm</a><span>)。</span></li><li><span>浏览器向DNS请求解析fyj.ink的IP地址。</span></li><li><span>域名系统DNS解析出IP</span></li><li><span>浏览器与服务器建立TCP连接。（默认端口号为80）</span></li><li><span>浏览器发出HTTP请求：GET：/os/index.htm。</span></li><li><span>服务器通过HTTP响应将文件index.htm发送给浏览器</span></li><li><span>TCP连接释放</span></li><li><span>浏览器解释index.htm，显示给用户。</span></li></ol><p><span>HTTP特点：无状态，服务器不记得用户，所以需要Cookie加数据库来跟踪用户活动，Cookie是一个存储在用户主机中的文本文件，里面有识别码用于Web服务识别用户。</span></p><p><span>HTTP采用TCP作为运输层协议保证可靠传输，但是HTTP本身是无连接的，使用了TCP，但是在发送HTTP报文前不需要先建立HTTP连接。但是HTTP/1.1开始支持持久连接，对于非持久连接，每个网页元素对象都需要单独建立TCP连接，则请求一个HTML所需时间是文档传输时间加上两倍RTT（第三次握手时客户捎带发送请求）。持久连接则是在发送响应后，保持连接，又分为流水线和非流水线两种，非流水线中，用户收到前一个响应后才可以发送下一个响应，而默认是流水线形式，可以逐个连续发送对各个引用对象的请求，所有对象共经历1个RTT延迟，而不是非流水线一样每个引用一个RTT延迟。</span></p><p><span>报文结构：</span></p><p><span>请求：</span><img src="https://oscimg.oschina.net/oscnet/c1e3fde69a1a96de96f3bf994628868db2e.jpg" referrerpolicy="no-referrer" alt="HTTP请求报文结构"></p><p><img src="http://www.2cto.com/uploadfile/Collfiles/20160921/20160921092902556.jpg" referrerpolicy="no-referrer" alt="HTTP请求报文"></p><p><img src="https://oscimg.oschina.net/oscnet/2119a4aa3d9511edc2777b94ea5b971bd96.jpg" referrerpolicy="no-referrer" alt="HTTP响应报文结构"></p><p><img src="C:\Users\tjf12\Desktop\20160921092902557.jpg" referrerpolicy="no-referrer" alt="HTTP响应报文"></p><p><span>开始为请求行，响应报文的开始为状态行，之后为首部行，以字段名：值 CRLF的格式，请求行有三个内容，方法、资源URL，HTTP版本。响应也有三个，版本、状态码和短语，之后跟首部行，每个行需要回车换行（‘\r\n’）常见请求：</span></p><figure><table><thead><tr><th><span>方法</span></th><th><span>意义</span></th></tr></thead><tbody><tr><td><span>GET</span></td><td><span>请求URL标识的信息</span></td></tr><tr><td><span>HEAD</span></td><td><span>获取报文首部</span></td></tr><tr><td><span>POST</span></td><td><span>传输实体主体</span></td></tr><tr><td><span>PUT</span></td><td><span>传输文件</span></td></tr><tr><td><span>CONNECT</span></td><td><span>用于代理服务器</span></td></tr><tr><td><span>OPTIONS</span></td><td><span>询问支持的方法</span></td></tr><tr><td><span>TRACE</span></td><td><span>追踪路径</span></td></tr></tbody></table></figure><p><span>常见状态信息：</span></p><figure><table><thead><tr><th><span>状态码</span></th><th><span>意义</span></th><th><span>举例</span></th></tr></thead><tbody><tr><td><span>1xx</span></td><td><span>通知信息</span></td><td>&nbsp;</td></tr><tr><td><span>2xx</span></td><td><span>成功</span></td><td><span>200 OK、204NoContent、206PartialContent</span></td></tr><tr><td><span>3xx</span></td><td><span>重定向</span></td><td><span>301MovedPermanently、302Found（临时重定向）、303（同302但需要用GET访问）、304NotModified（GET报文的IF条件不满足，不包含响应主体）</span></td></tr><tr><td><span>4xx</span></td><td><span>客户端出错</span></td><td><span>400BadRequest、401Unauthorized、403Forbidden、404NotFound</span></td></tr><tr><td><span>5xx</span></td><td><span>服务器出错</span></td><td><span>500InternalServerError、503 ServiceUnavailable、504GatewayTimeout</span></td></tr></tbody></table></figure><p>&nbsp;</p><p>&nbsp;</p><h3><a name="层次协议设备汇总" class="md-header-anchor"></a><span>层次协议、设备汇总：</span></h3><figure><table><thead><tr><th><span>协议</span></th><th><span>协议全称/中文名</span></th><th><span>工作层次/基于</span></th><th><span>服务层次</span></th><th><span>概述</span></th></tr></thead><tbody><tr><td><span>HTTP</span></td><td><span>HyperText Transfer Protocol/超文本传输协议</span></td><td><span>应用层/基于TCP</span></td><td><span>应用层</span></td><td>&nbsp;</td></tr><tr><td><span>SMTP</span></td><td><span>Simple Mail Transfer Protocol/简单邮件传输协议</span></td><td><span>应用层/基于TCP</span></td><td><span>应用层</span></td><td>&nbsp;</td></tr><tr><td><span>POP3</span></td><td><span>Post Office Protocol /邮局协议</span></td><td><span>应用层/基于TCP</span></td><td><span>应用层</span></td><td>&nbsp;</td></tr><tr><td><span>IMAP</span></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><span>FTP</span></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><span>DNS</span></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><span>TCP</span></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><span>UDP</span></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><span>IP</span></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><span>ARP</span></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><span>DHCP</span></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><span>ICMP</span></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><span>IGMP</span></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><span>RIP</span></td><td>&nbsp;</td><td><span>应用层/基于UDP</span></td><td><span>网络层</span></td><td><span>相邻交换路由表，获取路由信息。</span></td></tr><tr><td><span>OSPF</span></td><td>&nbsp;</td><td><span>网络层/基于IP，协议号89</span></td><td><span>网络层</span></td><td><span>广播邻接状况，本地生成路由。</span></td></tr><tr><td><span>BGP</span></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><span>PPP</span></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><span>HDLC</span></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><span>ALOHA</span></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><span>CSMA</span></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><span>CSMA/CD</span></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><span>CSMA/CA</span></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr></tbody></table></figure><p>&nbsp;</p><figure><table><thead><tr><th><span>设备名称</span></th><th><span>简称</span></th><th><span>工作层次</span></th><th><span>重点</span></th></tr></thead><tbody><tr><td><span>双绞线</span></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><span>同轴电缆</span></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><span>光纤</span></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><span>无线传输介质</span></td><td>&nbsp;</td><td><span>传输介质</span></td><td>&nbsp;</td></tr><tr><td><span>中继器</span></td><td>&nbsp;</td><td>&nbsp;</td><td><span>5-4-3规则，不隔绝任何域</span></td></tr><tr><td><span>放大器</span></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><span>集线器</span></td><td><span>Hub</span></td><td><span>物理</span></td><td><span>不隔绝任何域</span></td></tr><tr><td><span>网桥（源路由/透明路由）</span></td><td>&nbsp;</td><td><span>链路层</span></td><td><span>隔绝碰撞不隔绝广播域</span></td></tr><tr><td><span>交换机</span></td><td>&nbsp;</td><td><span>链路</span></td><td><span>隔绝碰撞不隔绝广播</span></td></tr><tr><td><span>路由器</span></td><td><span>Router</span></td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><span>网关</span></td><td><span>Gateway</span></td><td><span>网络层</span></td><td>&nbsp;</td></tr></tbody></table></figure><p>&nbsp;</p></div>
</body>
</html>